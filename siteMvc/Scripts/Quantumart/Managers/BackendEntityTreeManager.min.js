Quantumart.QP8.BackendEntityTreeManager=function(){Quantumart.QP8.BackendEntityTreeManager.initializeBase(this)};Quantumart.QP8.BackendEntityTreeManager.prototype={_treeGroups:{},initialize:function(){},generateTreeGroupCode:function(n,t){return String.format("{0}_{1}",n,t)},getTreeGroup:function(n){var t=null;return this._treeGroups[n]&&(t=this._treeGroups[n]),t},createTreeGroup:function(n){var t=this.getTreeGroup(n);return t||(t={},this._treeGroups[n]=t),t},removeTreeGroup:function(n){$q.removeProperty(this._treeGroups,n)},getTree:function(n){var i=null,r,t;for(r in this._treeGroups)if(t=this._treeGroups[r],t[n]){i=t[n];break}return i},createTree:function(n,t,i,r,u,f){var o=this.generateTreeGroupCode(t,i),e=null,s;return e=$q.isNullOrEmpty(u.virtualContentId)?new Quantumart.QP8.BackendEntityTree(o,n,t,i,r,u,f):new Quantumart.QP8.BackendVirtualFieldTree(o,n,t,i,r,u),e.set_treeManager(this),s=this.createTreeGroup(o),s[n]=e,e},removeTree:function(n){var r=this.getTree(n),t,i;r&&(t=r.get_treeGroupCode(),i=this.getTreeGroup(t),$q.removeProperty(i,n),$q.getHashKeysCount(i)==0&&this.removeTreeGroup(t))},destroyTree:function(n){var t=this.getTree(n);t!=null&&(this.removeTree(n),t.dispose&&t.dispose(),t=null)},refreshNode:function(n,t,i,r){var f=this.getTreeGroup(this.generateTreeGroupCode(n,t)),e,u,o;if(f)for(e in f)u=this.getTree(e),o=u.convertEntityIdToNodeCode(i),u.refreshNode(o,r)},refreshNodes:function(n,t,i,r){var o=this,u,f,e;if($q.isNullOrEmpty(i)){if(u=this.getTreeGroup(this.generateTreeGroupCode(n,t)),u)for(f in u)e=this.getTree(f),e.refreshTree()}else jQuery.each(i,function(i,u){o.refreshNode(n,t,u,r)})},removeNode:function(n,t,i){var u=this.getTreeGroup(this.generateTreeGroupCode(n,t)),f,r,e;if(u)for(f in u)r=this.getTree(f),e=r.convertEntityIdToNodeCode(i),r.removeNode(e)},removeNodes:function(n,t,i){var r=this;jQuery.each(i,function(i,u){r.removeNode(n,t,u)})},onActionExecuted:function(n){var t=n.get_entityTypeCode(),i=n.get_parentEntityId(),u=n.get_actionTypeCode(),r=n.get_entityId(),f=n.get_isMultipleEntities()?$o.getEntityIDsFromEntities(n.get_entities()):[r],e,o,s;n.get_isRemoving()||n.get_isArchiving()?this.removeNodes(t,i,f):(n.get_isUpdated()||n.get_isLoaded()||u==ACTION_TYPE_CODE_CANCEL||u==ACTION_TYPE_CODE_CHANGE_LOCK)&&t!=ENTITY_TYPE_CODE_VIRTUAL_ARTICLE?this.refreshNode(t,i,r,{loadChildNodes:!0,saveNodesSelection:!0}):n.get_isSaved()||u==ACTION_TYPE_CODE_COPY?(e=$o.getParentIdsForTree(t,f),this.refreshNodes(t,i,e,{loadChildNodes:!0,saveNodesSelection:!1})):n.get_isRestoring()&&t==ENTITY_TYPE_CODE_ARCHIVE_ARTICLE?(o=$o.getParentIdsForTree(ENTITY_TYPE_CODE_ARTICLE,f),this.refreshNodes(ENTITY_TYPE_CODE_ARTICLE,i,o,{loadChildNodes:!0,saveNodesSelection:!1})):n.get_isRestored()&&t==ENTITY_TYPE_CODE_ARTICLE_VERSION&&(s=$q.toInt($o.getParentEntityId(ENTITY_TYPE_CODE_ARTICLE,r),0),this.refreshNode(ENTITY_TYPE_CODE_ARTICLE,s,r,{loadChildNodes:!0,saveNodesSelection:!1}))},dispose:function(){if(Quantumart.QP8.BackendEntityTreeManager.callBaseMethod(this,"dispose"),this._trees){for(treeCode in this._trees)this.destroyTree(treeCode);this._trees=null}Quantumart.QP8.BackendEntityTreeManager._instance=null;$q.collectGarbageInIE()}};Quantumart.QP8.BackendEntityTreeManager._instance=null;Quantumart.QP8.BackendEntityTreeManager.getInstance=function(){return Quantumart.QP8.BackendEntityTreeManager._instance==null&&(Quantumart.QP8.BackendEntityTreeManager._instance=new Quantumart.QP8.BackendEntityTreeManager),Quantumart.QP8.BackendEntityTreeManager._instance};Quantumart.QP8.BackendEntityTreeManager.destroyInstance=function(){Quantumart.QP8.BackendEntityTreeManager._instance&&Quantumart.QP8.BackendEntityTreeManager._instance.dispose()};Quantumart.QP8.BackendEntityTreeManager.registerClass("Quantumart.QP8.BackendEntityTreeManager",Quantumart.QP8.Observable);