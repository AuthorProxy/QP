Quantumart.QP8.BackendLibraryManager=function(){Quantumart.QP8.BackendLibraryManager.initializeBase(this)};Quantumart.QP8.BackendLibraryManager.prototype={_libraryGroups:{},generateLibraryGroupCode:function(n,t){return String.format("{0}_{1}",n,t)},getLibraryGroupCode:function(n,t){var i=n==ENTITY_TYPE_CODE_SITE_FILE?ENTITY_TYPE_CODE_SITE_FOLDER:ENTITY_TYPE_CODE_CONTENT_FOLDER,r=n==ENTITY_TYPE_CODE_SITE_FILE?ACTION_CODE_SITE_LIBRARY:ACTION_CODE_CONTENT_LIBRARY,u=$o.getParentEntityId(i,t);return this.generateLibraryGroupCode(r,u)},getLibraryGroup:function(n){var t=null;return this._libraryGroups[n]&&(t=this._libraryGroups[n]),t},createLibraryGroup:function(n){var t=this.getLibraryGroup(n);return t||(t={},this._libraryGroups[n]=t),t},refreshLibraryGroup:function(n,t,i){var r=this.getLibraryGroup(this.getLibraryGroupCode(n,t)),u;if(r)for(u in r)this.refreshLibrary(u,i);r=null},resetLibraryGroup:function(n,t){var i=this.getLibraryGroup(n),r;if(i)for(r in i)this.resetLibrary(r,t);i=null},removeLibraryGroup:function(n){$q.removeProperty(this._libraryGroups,n)},getAllLibraries:function(){var t=[],i,n,r;for(i in this._libraryGroups){n=this._libraryGroups[i];for(r in n)t.push(n[r])}return t},getLibrary:function(n){var i=null,r,t;for(r in this._libraryGroups)if(t=this._libraryGroups[r],t[n]){i=t[n];break}return i},createLibrary:function(n,t,i,r,u){var e=this.generateLibraryGroupCode(i,t),f=new Quantumart.QP8.BackendLibrary(e,n,t,i,r,u),o;return f.set_libraryManager(this),o=this.createLibraryGroup(e),o[n]=f,f},refreshLibrary:function(n,t){var i=this.getLibrary(n);i&&i.refreshCurrentFileList(t);i=null},resetLibrary:function(n,t){var i=this.getLibrary(n);i&&i.resetCurrentFileList(t);i=null},removeLibrary:function(n){var r=this.getLibrary(n),t,i;r&&(t=r._libraryGroupCode,i=this.getLibraryGroup(t),$q.removeProperty(i,n),$q.getHashKeysCount(i)==0&&this.removeLibraryGroup(t))},destroyLibrary:function(n){var t=this.getLibrary(n);t!=null&&(t.dispose&&t.dispose(),t=null)},onActionExecuted:function(n){var t=n.get_entityTypeCode(),i=n.get_actionTypeCode();(t==ENTITY_TYPE_CODE_SITE_FILE||t==ENTITY_TYPE_CODE_CONTENT_FILE)&&(n.get_isSaved()||n.get_isUpdated()||n.get_isRemoving()||i==ACTION_TYPE_CODE_ALL_FILES_UPLOADED||i==ACTION_TYPE_CODE_FILE_CROPPED)&&this.refreshLibraryGroup(t,n.get_parentEntityId())},dispose:function(){if(Quantumart.QP8.BackendLibraryManager.callBaseMethod(this,"dispose"),this._libraryGroups){for(libraryGroupCode in this._libraryGroups){var n=this._libraryGroups[libraryGroupCode];for(libraryElementId in n)this.destroyLibrary(libraryElementId)}this._libraryGroups=null}Quantumart.QP8.BackendLibraryManager._instance=null;$q.collectGarbageInIE()}};Quantumart.QP8.BackendLibraryManager._instance=null;Quantumart.QP8.BackendLibraryManager.getInstance=function(){return Quantumart.QP8.BackendLibraryManager._instance==null&&(Quantumart.QP8.BackendLibraryManager._instance=new Quantumart.QP8.BackendLibraryManager),Quantumart.QP8.BackendLibraryManager._instance};Quantumart.QP8.BackendLibraryManager.destroyInstance=function(){Quantumart.QP8.BackendLibraryManager._instance&&Quantumart.QP8.BackendLibraryManager._instance.dispose()};Quantumart.QP8.BackendLibraryManager.registerClass("Quantumart.QP8.BackendLibraryManager",Quantumart.QP8.Observable);