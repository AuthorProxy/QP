Quantumart.QP8.BackendPopupWindowManager=function(){Quantumart.QP8.BackendPopupWindowManager.initializeBase(this);this._hostStateStorage=new Quantumart.QP8.BackendDocumentHostStateStorage;this._hostStateStorage._get_host_key=function(n){var t=n._hostStateStorage._get_host_key;return function(n){return n.entityId=0,t(n)}}(this)};Quantumart.QP8.BackendPopupWindowManager.prototype={_popupWindows:{},_hostStateStorage:null,generatePopupWindowId:function(){var t=1,i=this._popupWindows,n,r;if($q.getHashKeysCount(i)>0){n=[];for(r in i)Array.add(n,r);var u=n.sort(),e=u[u.length-1],f=e.match("[0-9]+");if(f.length==1)t=parseInt(f[0])+1;else return alert($l.PopupWindow.popupWindowIdGenerationErrorMessage),null}return String.format("win{0}",t)},generatePopupWindowTitle:function(n){return Quantumart.QP8.BackendDocumentHost.generateTitle(n,{isTab:!1})},getAllPopupWindows:function(){var n=this._popupWindows,t=[];for(var i in n)Array.add(t,n[i]);return t},getPopupWindow:function(n){var t=null;return this._popupWindows[n]&&(t=this._popupWindows[n]),t},getPopupWindowByEventArgs:function(n){return jQuery.grep(this.getAllPopupWindows(),function(t){return t.get_entityTypeCode()==n.get_entityTypeCode()&&t.get_entityId()==n.get_entityId()&&t.get_actionCode()==n.get_actionCode()})},createPopupWindow:function(n,t){var i=t?t.popupWindowId:"",r;return($q.isNullOrWhiteSpace(i)&&(i=this.generatePopupWindowId()),this._popupWindows[i])?(alert($l.PopupWindow.popupWindowIdNotUniqueErrorMessage),null):(jQuery.extend(t,{width:n.get_windowWidth(),height:n.get_windowHeight(),hostStateStorage:this._hostStateStorage}),r=new Quantumart.QP8.BackendPopupWindow(i,n,t),r.set_popupWindowManager(this),r.initialize(),this._popupWindows[i]=r,r)},openPopupWindow:function(n){var t=this.createPopupWindow(n,{});return t.openWindow(),t},removePopupWindow:function(n){$q.removeProperty(this._popupWindows,n)},destroyPopupWindow:function(n){var t=this._popupWindows[n];t!=null&&(t.dispose&&t.dispose(),t=null)},closeNotExistentPopupWindows:function(){for(var f,t,e,i,r=this.getAllPopupWindows(),u=0,h=r.length;u<h;u++){var n=r[u],o=n.get_entityTypeCode(),c=n.get_entityId(),s=n.get_actionTypeCode(),l=n.get_isMultipleEntities();if(s!=ACTION_TYPE_CODE_ADD_NEW)if(l&&s!=ACTION_TYPE_CODE_MULTIPLE_SELECT){for(f=n.get_entities(),t=0;t<f.length;t++)if(e=f[t],e&&(i=$o.checkEntityExistence(o,e.Id),!i)){n.closeWindow();break}}else i=$o.checkEntityExistence(o,c),i||n.closeWindow();n=null}r=null},onActionExecuted:function(n){(n.get_isRemoving()||n.get_isArchiving()||n.get_isRestoring())&&this.closeNotExistentPopupWindows()},onNeedUp:function(n,t){var i=this.getPopupWindow(t);i&&i.closeWindow()},hostExternalCallerContextsUnbinded:function(n){this.notify(EVENT_TYPE_HOST_EXTERNAL_CALLER_CONTEXTS_UNBINDED,n)},dispose:function(){if(Quantumart.QP8.BackendPopupWindowManager.callBaseMethod(this,"dispose"),this._popupWindows){for(var n in this._popupWindows)this.destroyPopupWindow(n);this._popupWindows=null}this._hostStateStorage&&(this._hostStateStorage.dispose(),this._hostStateStorage=null);Quantumart.QP8.BackendPopupWindowManager._instance=null;$q.collectGarbageInIE()}};Quantumart.QP8.BackendPopupWindowManager._instance=null;Quantumart.QP8.BackendPopupWindowManager.getInstance=function(n){return Quantumart.QP8.BackendPopupWindowManager._instance==null&&(Quantumart.QP8.BackendPopupWindowManager._instance=new Quantumart.QP8.BackendPopupWindowManager(n)),Quantumart.QP8.BackendPopupWindowManager._instance};Quantumart.QP8.BackendPopupWindowManager.destroyInstance=function(){Quantumart.QP8.BackendPopupWindowManager._instance&&Quantumart.QP8.BackendPopupWindowManager._instance.dispose()};Quantumart.QP8.BackendPopupWindowManager.registerClass("Quantumart.QP8.BackendPopupWindowManager",Quantumart.QP8.Observable);