var FILE_LIST_MODE_NAME_LIST="FILE_LIST_MODE_NAME_LIST",FILE_LIST_MODE_PREVIEW_LIST="FILE_LIST_MODE_PREVIEW_LIST",FILE_LIST_SELECT_MODE_MULTIPLE="FILE_LIST_SELECT_MODE_MULTIPLE",FILE_LIST_SELECT_MODE_SINGLE="FILE_LIST_SELECT_MODE_SINGLE",FILE_LIST_NAME_PAGE_SIZE=60,FILE_LIST_PREVIEW_PAGE_SIZE=24,FILE_LIST_ITEMS_PER_COLUMN=20,EVENT_TYPE_FILE_LIST_DATA_BOUND="OnFileListDataBound",EVENT_TYPE_FILE_LIST_ACTION_EXECUTING="OnFileListActionExecuting",EVENT_TYPE_FILE_LIST_SELECTED="OnFileNameSelected";Quantumart.QP8.BackendFileList=function(n,t,i,r,u,f){Quantumart.QP8.BackendFileList.initializeBase(this);this._listElementId=n;this._fileEntityTypeCode=t;this._contextMenuCode=r;this._viewMode=u;this._actionCode=i;$q.isNull(f)||($q.isNull(f.selectMode)||(this._selectMode=f.selectMode),f.zIndex&&(this._zIndex=f.zIndex));this._currentDataQueryOptions={pageNumber:0,pageSize:0,folderId:0,fileTypeId:"",fileNameFilter:""};this._viewMode==FILE_LIST_MODE_NAME_LIST?this._currentDataQueryOptions.pageSize=FILE_LIST_NAME_PAGE_SIZE:this._viewMode==FILE_LIST_MODE_PREVIEW_LIST&&(this._currentDataQueryOptions.pageSize=FILE_LIST_PREVIEW_PAGE_SIZE)};Quantumart.QP8.BackendFileList.prototype={_fileEntityTypeCode:0,_contextMenuCode:0,_viewMode:FILE_LIST_MODE_NAME_LIST,_selectMode:FILE_LIST_SELECT_MODE_MULTIPLE,_actionCode:"",_currentDataQueryOptions:null,_listElementId:"",_listElement:null,_allSelectorElement:null,_fileListContentElement:null,_contextMenuComponent:null,_pagerComponent:null,_listViewComponent:null,_zIndex:0,_onAllSelectorClicked:function(){this._listViewComponent.selectAll(jQuery(this._allSelectorElement).is(":checked"))},_onPageNumberChanged:function(n,t,i){this.rebind({pageNumber:i.get_PageNumber()})},_onListViewSelected:function(n,t,i){jQuery(this._allSelectorElement).prop("checked",this._listViewComponent.isAllSelected());this._raiseMultipleEventArgsEvent(EVENT_TYPE_FILE_LIST_SELECTED,i);action=null;eventArgs=null},_onContextMenuItemClicked:function(n,t,i){i.set_parentEntityId(this._currentDataQueryOptions.folderId);this.notify(n,i)},_loadData:function(){var n="",t;if(this._fileEntityTypeCode==ENTITY_TYPE_CODE_SITE_FILE)n=CONTROLLER_URL_SITE+"_FileList";else if(this._fileEntityTypeCode==ENTITY_TYPE_CODE_CONTENT_FILE)n=CONTROLLER_URL_CONTENT+"_FileList";else throw new Error("fileEntityTypeCode is unknown.");return $q.getJsonFromUrl("GET",n,{folderId:this._currentDataQueryOptions.folderId,pageSize:this._currentDataQueryOptions.pageSize,pageNumber:this._currentDataQueryOptions.pageNumber,fileTypeId:this._currentDataQueryOptions.fileTypeId,fileNameFilter:this._currentDataQueryOptions.fileNameFilter,fileShortNameLength:this._listViewComponent.shortNameLength},!1,!1,function(n){n.success?t=n.data:alert(n.message)},function(n){t=null;$q.processGenericAjaxError(n)}),t},_raiseMultipleEventArgsEvent:function(n,t){var r=$a.getBackendActionByCode(this._actionCode),i;r!=null&&(i=$a.getEventArgsFromAction(r),i.set_isMultipleEntities(!0),t&&i.set_entities(t.get_entities()),i.set_entityTypeCode(this._fileEntityTypeCode),i.set_parentEntityId(this._currentDataQueryOptions.folderId),this.notify(n,i));r=null;i=null},initialize:function(){var t=jQuery(this._listElementId),u,i,r,n;if(this._listElement=t.get(0),u=new $.telerik.stringBuilder,u.cat('<div class="fileList">').cat('<div class="fileListArea">').cat('<div class="fileListHeader">').catIf('<input type="checkbox" class="fileListAllSelector" />',this._selectMode==FILE_LIST_SELECT_MODE_MULTIPLE).catIf("<br />",this._selectMode==FILE_LIST_SELECT_MODE_SINGLE).cat("<\/div>").cat(String.format('<div class="fileListContent" id="{0}_fileListContent">{1}<\/div>',t.attr("id"),$l.FileList.noRecords)).cat("<\/div>").cat('<div class="fileListPager"><\/div>').cat("<\/div>"),t.html(u.string()),i=new Quantumart.QP8.BackendPager(t.find(".fileListPager").get(0)),i.initialize(),i.attachObserver(EVENT_TYPE_PAGE_NUMBER_CHANGED,jQuery.proxy(this._onPageNumberChanged,this)),this._pagerComponent=i,r=t.find(".fileListAllSelector"),r.click(jQuery.proxy(this._onAllSelectorClicked,this)),this._allSelectorElement=r.get(0),this._fileListContentElement=t.find(".fileListContent").get(0),n=null,this._viewMode==FILE_LIST_MODE_NAME_LIST)n=new Quantumart.QP8.BackendFileNameListView(this._fileListContentElement,this._contextMenuCode,this._selectMode,this._zIndex);else if(this._viewMode==FILE_LIST_MODE_PREVIEW_LIST)n=new Quantumart.QP8.BackendFilePreviewListView(this._fileListContentElement,this._contextMenuCode,this._selectMode,this._zIndex);else throw new Error("View Mode is unknown.");n.initialize();n.attachObserver(EVENT_TYPE_FILE_LIST_SELECTED,jQuery.proxy(this._onListViewSelected,this));n.attachObserver(EVENT_TYPE_FILE_LIST_ACTION_EXECUTING,jQuery.proxy(this._onContextMenuItemClicked,this));this._listViewComponent=n;i=null;n=null;r=null;t=null},rebind:function(n){$q.isObject(n)&&($q.isNull(n.pageSize)||(this._currentDataQueryOptions.pageSize=$q.toInt(n.pageSize)),$q.isNull(n.pageNumber)||(this._currentDataQueryOptions.pageNumber=$q.toInt(n.pageNumber)),$q.isNull(n.folderId)||(this._currentDataQueryOptions.folderId=$q.toInt(n.folderId)),$q.isNull(n.fileTypeId)||(this._currentDataQueryOptions.fileTypeId=n.fileTypeId),$q.isNull(n.fileNameFilter)||(this._currentDataQueryOptions.fileNameFilter=n.fileNameFilter));var t=this._loadData();t&&(this._listViewComponent.redraw(t,{folderId:this._currentDataQueryOptions.folderId,fileEntityTypeCode:this._fileEntityTypeCode}),this._pagerComponent.set({totalCount:t.TotalRecords,pageSize:this._currentDataQueryOptions.pageSize,currentPageNumber:this._currentDataQueryOptions.pageNumber}),this._currentDataQueryOptions.pageNumber=this._pagerComponent.get_pageNumber(),this._pagerComponent.redraw());this._raiseMultipleEventArgsEvent(EVENT_TYPE_FILE_LIST_DATA_BOUND)},dispose:function(){this._pagerComponent&&(this._pagerComponent.detachObserver(EVENT_TYPE_PAGE_NUMBER_CHANGED),this._pagerComponent.dispose());this._listViewComponent&&(this._listViewComponent.detachObserver(EVENT_TYPE_FILE_LIST_SELECTED),this._listViewComponent.detachObserver(EVENT_TYPE_FILE_LIST_ACTION_EXECUTING),this._listViewComponent.dispose());jQuery(this._allSelectorElement).unbind();jQuery(this._listElement).children().remove();this._listElement=null;this._allSelectorElement=null;this._fileListContentElement=null;this._contextMenuComponent=null;this._pagerComponent=null}};Quantumart.QP8.BackendFileList.registerClass("Quantumart.QP8.BackendFileList",Quantumart.QP8.Observable);Quantumart.QP8.IBackendFileListView=function(){};Quantumart.QP8.IBackendFileListView.prototype={initialize:function(){},redraw:function(){},selectAll:function(){},isAllSelected:function(){},dispose:function(){}};Quantumart.QP8.IBackendFileListView.registerInterface("Quantumart.QP8.IBackendFileListView");