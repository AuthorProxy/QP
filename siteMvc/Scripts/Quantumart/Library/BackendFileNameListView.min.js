Quantumart.QP8.BackendFileNameListView=function(n,t,i,r){Quantumart.QP8.BackendFileNameListView.initializeBase(this);this._fileListContentElement=n;this._contextMenuCode=t;this._selectMode=i;this._zIndex=r};Quantumart.QP8.BackendFileNameListView.prototype={_fileListContentElement:null,_contextMenuComponent:null,_contextMenuCode:0,_contextMenuActionCode:"",_currentContextMenuSelectedElement:null,SELECTED_CLASS:"fileItem-selected",_zIndex:0,_selectMode:"",shortNameLength:20,initialize:function(){var t=jQuery(this._fileListContentElement),n,i;t.html('<div class="fileListNameContainer"><\/div>');t.delegate(".fileItem input:checkbox","click",jQuery.proxy(this._onFileCheckBoxClickedHandler,this));t.delegate(".fileItem","click",jQuery.proxy(this._onFileContainerClickedHandler,this));$q.isNullOrWhiteSpace(this._contextMenuCode)||(n=new Quantumart.QP8.BackendContextMenu(this._contextMenuCode,String.format("{0}_ContextMenu",t.attr("id")),{targetElements:this._fileListContentElement,allowManualShowing:!0,zIndex:this._zIndex}),n.initialize(),n.addMenuItemsToMenu(!1),i=n.getContextMenuEventType(),t.delegate(".fileItem",i,jQuery.proxy(this._onContextMenuHandler,this)),n.attachObserver(EVENT_TYPE_CONTEXT_MENU_ITEM_CLICKING,jQuery.proxy(this._onNodeContextMenuItemClickingHandler,this)),n.attachObserver(EVENT_TYPE_CONTEXT_MENU_HIDDEN,jQuery.proxy(this._onNodeContextMenuHiddenHandler,this)),this._contextMenuComponent=n,n=null);t=null},redraw:function(n){var r=jQuery(this._fileListContentElement),u=r.find(".fileListNameContainer"),t=new $.telerik.stringBuilder,f=this,i;n.TotalRecords>0?(i=0,jQuery.each(n.Data,function(n,r){t.catIf('<div class="column"><ul>',i==0).cat(String.format('<li title="{0}"><div class="fileItem" data-file_name="{0}">',r.FullName)).catIf('<input type="checkbox" />',f._selectMode==FILE_LIST_SELECT_MODE_MULTIPLE).cat(String.format('<img src="{1}{2}" /><label>{0}<\/label><\/div><\/li>',r.Name,THEME_IMAGE_FOLDER_URL_SMALL_FILE_TYPE_ICONS,r.SmallIconLink));i==FILE_LIST_ITEMS_PER_COLUMN-1?(t.cat("<\/ul><\/div>"),i=0):i++}),t.catIf("<\/ul><\/div>",i>0)):t.cat($l.FileList.noRecords);u.html(t.string());u=null;r=null;t=null;this._raiseSelectEvent()},selectAll:function(n){var t=jQuery(this._fileListContentElement);t.find(".fileItem input:checkbox").prop("checked",n);t.find(".fileItem").addClass(this.SELECTED_CLASS);t=null;this._raiseSelectEvent()},isAllSelected:function(){var n=jQuery(this._fileListContentElement),t=n.find(".fileItem input::checkbox:not(:checked)").size()==0&&n.find(".fileItem").size()>0;return n=null,t},dispose:function(){var n=jQuery(this._fileListContentElement),t;n.undelegate(".fileItem input:checkbox","click");n.undelegate(".fileItem","click");this._contextMenuComponent&&(this._contextMenuComponent.detachObserver(EVENT_TYPE_CONTEXT_MENU_ITEM_CLICKING),this._contextMenuComponent.detachObserver(EVENT_TYPE_CONTEXT_MENU_HIDDEN),t=this._contextMenuComponent.getContextMenuEventType(),n.undelegate(".fileItem",t),this._contextMenuComponent.dispose());n=null;this._fileListContentElement=null;this._contextMenuComponent=null},_raiseSelectEvent:function(){var n=new Quantumart.QP8.BackendEventArgs;n.set_entities(this._getSelectedEntities());n.set_isMultipleEntities(!0);this.notify(EVENT_TYPE_FILE_LIST_SELECTED,n);n=null},_getSelectedEntities:function(){var n=[],t=jQuery(this._fileListContentElement);return t.find(".fileItem."+this.SELECTED_CLASS).each(function(t,i){var r=jQuery(i).data("file_name");Array.add(n,{Id:r,Name:r})}),t=null,n},_onFileCheckBoxClickedHandler:function(n){n.stopPropagation();var t=jQuery(n.currentTarget);t.is(":checked")?t.parent(".fileItem").addClass(this.SELECTED_CLASS):t.parent(".fileItem").removeClass(this.SELECTED_CLASS);this._raiseSelectEvent();t=null},_onFileContainerClickedHandler:function(n){var t=jQuery(n.currentTarget),i=jQuery(this._fileListContentElement);n.ctrlKey&&this._selectMode!=FILE_LIST_SELECT_MODE_SINGLE||(i.find("."+this.SELECTED_CLASS).removeClass(this.SELECTED_CLASS),i.find(".fileItem input:checkbox:checked").prop("checked",!1));t.toggleClass(this.SELECTED_CLASS);t.find("input:checkbox").prop("checked",t.hasClass(this.SELECTED_CLASS));this._raiseSelectEvent();t=null;i=null},_onContextMenuHandler:function(n){var t=jQuery(n.currentTarget);this._contextMenuComponent&&this._contextMenuComponent.showMenu(n,t.get(0));t=null;this._currentContextMenuSelectedElement=n.currentTarget;n.preventDefault()},_onNodeContextMenuItemClickingHandler:function(n,t,i){var r=jQuery(i.get_menuItem());$q.isNullOrEmpty(r)||(this._contextMenuActionCode=r.data("action_code"));r=null},_onNodeContextMenuHiddenHandler:function(){if(!$q.isNullOrEmpty(this._contextMenuActionCode)){var t=jQuery(this._currentContextMenuSelectedElement),n=new Quantumart.QP8.BackendEventArgs;n.set_actionCode(this._contextMenuActionCode);n.set_entityId(t.data("file_name"));n.set_entityName(t.data("file_name"));this._contextMenuActionCode=null;this.notify(EVENT_TYPE_FILE_LIST_ACTION_EXECUTING,n);t=null}}};Quantumart.QP8.BackendFileNameListView.registerClass("Quantumart.QP8.BackendFileNameListView",Quantumart.QP8.Observable,Quantumart.QP8.IBackendFileListView);