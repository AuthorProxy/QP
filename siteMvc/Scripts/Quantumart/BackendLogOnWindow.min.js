Quantumart.QP8.BackendLogOnWindow=function(){Quantumart.QP8.BackendLogOnWindow.initializeBase(this)};Quantumart.QP8.BackendLogOnWindow.prototype={_windowComponent:null,_isAuthenticated:null,_userName:null,FORM_SELECTOR:"form#auth",LOADING_SELECTOR:"#authLoading",USERNAME_SELECTOR:"#UserName",PASSWORD_SELECTOR:"#Password",CUSTOMERCODE_SELECTOR:"#CustomerCode",Z_INDEX:5e4,AJAX_EVENT:"AjaxEvent",_onLogonHandler:null,_onCloseWindowHandler:null,_getServerContent:function(n){return n.success?n.view:n.message},_createWindow:function(n){var t=this;this._isAuthenticated=!1;this._userName=null;this._windowComponent=$.telerik.window.create({title:$l.Common.ajaxUserSessionExpiredErrorMessage,html:n,width:500,height:265,modal:!0,resizable:!1,draggable:!1,visible:!0}).data("tWindow").center();this._onLogonHandler=function(n){t._disableWindow();n.preventDefault();var r,o=t._getGurrentUserName(),s=t._getGurrentCustomerCode(),h=$(t.USERNAME_SELECTOR).val(),c=$(t.PASSWORD_SELECTOR).val(),u=$(t.CUSTOMERCODE_SELECTOR).val(),f="GET",i=t._getUseAutoLogin(),l=t._getUrl(),e=!1;n.type=="submit"?f="POST":(e=i,i=!i);$q.getJsonFromUrl(f,l,{UseAutoLogin:i,UserName:h,Password:c,CustomerCode:u},!0,!1,function(n){if(n.isAuthenticated?(t._isAuthenticated=!0,t._userName=n.userName):r=t._getServerContent(n),t._isAuthenticated){t._closeWindow();var i=t._userName!=o||u!=s;i&&location.reload()}else t._updateWindow(r),e&&t._setDefaultValues()},function(n,i,r){t._updateWindow(r)})};this._onCloseWindowHandler=function(){t._triggerDeferredCallcacks(t._isAuthenticated);t.dispose()};jQuery(this._windowComponent.element).bind("close",this._onCloseWindowHandler)},_updateWindow:function(n){this._detachEvents();this._windowComponent.content(n);this._attachEvents();this._enableWindow()},_setDefaultValues:function(){var n=this._getGurrentUserName(),t=this._getGurrentCustomerCode();$(this.USERNAME_SELECTOR).val(n);$(this.CUSTOMERCODE_SELECTOR).val(t)},_showWindow:function(n){this._windowComponent||(this._createWindow(this._getServerContent(n)),this._attachEvents(),this._setDefaultValues(),this._enableWindow())},_getGurrentUserName:function(){return $("span.userName").text()},_getGurrentCustomerCode:function(){return $("span.t-in").first().text()},_getUrl:function(){var n=$(this.FORM_SELECTOR).attr("action");return n.endsWith("/")||(n+="/"),n},_updateZindex:function(){this._windowComponent&&$(this._windowComponent.element).css("z-index",this.Z_INDEX)},_getUseAutoLogin:function(){return $("input#UseAutoLogin").val().toUpperCase()=="TRUE"},_disableWindow:function(){$(this.LOADING_SELECTOR).show();$(this.FORM_SELECTOR).find(":input:not(:disabled)").prop("disabled",!0)},_enableWindow:function(){$(this.FORM_SELECTOR).find(":input:disabled").prop("disabled",!1);$(this.LOADING_SELECTOR).hide()},_closeWindow:function(){this._windowComponent.close()},_attachEvents:function(){$(this.FORM_SELECTOR).submit(this._onLogonHandler);$(this.FORM_SELECTOR).find("a").click(this._onLogonHandler)},_detachEvents:function(){$(this.FORM_SELECTOR).off();$(this.FORM_SELECTOR).find("a").off()},_triggerDeferredCallcacks:function(n){$(this).triggerHandler({type:this.AJAX_EVENT,value:n})},_addDeferredCallcack:function(n,t){this._updateZindex();$(this).on(this.AJAX_EVENT,function(i){var r=i.value;r?jQuery.ajax(t).done(n):n({success:!0})})},_clearDeferredCallcacks:function(){$(this).off(this.AJAX_EVENT)},showLogonForm:function(n,t,i){this._addDeferredCallcack(t,i);this._showWindow(n)},needLogon:function(n,t){return t.toUpperCase()==CONTROLLER_URL_LOGON.toUpperCase()||t.toUpperCase()==CONTROLLER_URL_WINLOGON.toUpperCase()?!1:n.getResponseHeader("QP-Not-Authenticated")?!0:!1},dispose:function(){if(Quantumart.QP8.BackendLogOnWindow.callBaseMethod(this,"dispose"),this._clearDeferredCallcacks(),this._windowComponent){this._detachEvents();var n=this._windowComponent,t=jQuery(n.element);t.unbind("close",this._onCloseWindowHandler);t=null;$c.destroyPopupWindow(n);n=null;this._windowComponent=null}Quantumart.QP8.BackendLogOnWindow._instance=null;$q.collectGarbageInIE()}};Quantumart.QP8.BackendLogOnWindow._instance=null;Quantumart.QP8.BackendLogOnWindow.deferredExecution=function(n,t,i,r){var u=Quantumart.QP8.BackendLogOnWindow.getInstance();return u.needLogon(t,r.url)?(u.showLogonForm(n,i,r),!0):!1};Quantumart.QP8.BackendLogOnWindow.getInstance=function(){return Quantumart.QP8.BackendLogOnWindow._instance==null&&(Quantumart.QP8.BackendLogOnWindow._instance=new Quantumart.QP8.BackendLogOnWindow),Quantumart.QP8.BackendLogOnWindow._instance};Quantumart.QP8.BackendLogOnWindow.destroyInstance=function(){Quantumart.QP8.BackendLogOnWindow._instance&&Quantumart.QP8.BackendLogOnWindow._instance.dispose()};Quantumart.QP8.BackendLogOnWindow.registerClass("Quantumart.QP8.BackendLogOnWindow",Quantumart.QP8.Observable);