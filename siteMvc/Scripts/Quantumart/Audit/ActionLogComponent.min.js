Quantumart.QP8.ActionLogComponent=function(n,t,i,r){this._filterElementId=n;this._gridElementId=t;this._onDataBindingHandler=jQuery.proxy(this._onDataBinding,this);this._onApplyFilterHandler=jQuery.proxy(this._onApplyFilter,this);this._onClearFilterHandler=jQuery.proxy(this._onClearFilter,this);this._actionTypes=i;this._entityTypes=r};Quantumart.QP8.ActionLogComponent.prototype={_filterElementId:"",_gridElementId:"",$filterCombo:null,$tilesContainer:null,_actionTypes:null,_entityTypes:null,_tiles:{},initialize:function(){var t=jQuery("#"+this._gridElementId),i=t.data("tGrid"),n=jQuery("#"+this._filterElementId);t.unbind("dataBinding",i.onDataBinding).bind("dataBinding",this._onDataBindingHandler);jQuery(".alSearchButton",n).click(this._onApplyFilterHandler);jQuery(".alResetButton",n).click(this._onClearFilterHandler);this.$filterCombo=n.find(".alFilterCombo").change(jQuery.proxy(this._onFilterSelected,this));this.$tilesContainer=n.find(".alTilesContainer");i.ajaxRequest();i=null;t=null;n=null},_onApplyFilter:function(){jQuery("#"+this._gridElementId).data("tGrid").ajaxRequest()},_onClearFilter:function(){var n=jQuery("#"+this._filterElementId);this._destroyAllTiles();jQuery(".alSearchButton",this.$filter).trigger("click");n=null},_onDataBinding:function(n){var t=this.get_filterData();jQuery.isEmptyObject(t)||(n.data=jQuery.extend(n.data,{searchQuery:JSON.stringify(t)}))},get_filterData:function(){var t={};for(var n in this._tiles)n&&this._tiles.hasOwnProperty(n)&&this._tiles[n].get_options().deriveFilterData(this._tiles[n],t);return t},_onFilterSelected:function(){var n=this.$filterCombo.find("option:selected");n.val()&&this._createTile({value:n.val(),text:n.text()});this.$filterCombo.val("");n=null},_onTileClose:function(n,t,i){this._destroyTile(i.type)},_createTile:function(n){var r=this,i,t;n&&n.value&&!this._tiles.hasOwnProperty(n.value)&&(i=$q.toInt(n.value,0),t=new Quantumart.QP8.ActionLogFilterTile(this.$tilesContainer,{type:n.value,title:n.text,type:i,windowSize:function(){switch($q.toInt(n.value,0)){case $e.ActionLogFilteredColumns.EntityStringId:case $e.ActionLogFilteredColumns.EntityTitle:case $e.ActionLogFilteredColumns.ParentEntityId:case $e.ActionLogFilteredColumns.EntityTypeName:return{w:350,h:65};case $e.ActionLogFilteredColumns.ActionTypeName:return{w:400,h:65};case $e.ActionLogFilteredColumns.ExecutionTime:return{w:350,h:112};default:return{w:350,h:125}}}(),createFilter:function(n){switch(i){case $e.ActionLogFilteredColumns.EntityStringId:case $e.ActionLogFilteredColumns.EntityTitle:case $e.ActionLogFilteredColumns.ParentEntityId:return new Quantumart.QP8.ActionLogTextFilter(n);case $e.ActionLogFilteredColumns.ExecutionTime:return new Quantumart.QP8.ActionLogDatetimeFilter(n);case $e.ActionLogFilteredColumns.ActionTypeName:return new Quantumart.QP8.ActionLogItemListFilter(n,r._actionTypes);case $e.ActionLogFilteredColumns.EntityTypeName:return new Quantumart.QP8.ActionLogItemListFilter(n,r._entityTypes);case $e.ActionLogFilteredColumns.UserLogin:return new Quantumart.QP8.ActionLogUserFilter(n);default:return new Quantumart.QP8.ActionLogFilterBase(n)}},deriveFilterData:function(n,t){var i=n.get_value();if(i)switch(n.get_options().type){case $e.ActionLogFilteredColumns.EntityStringId:t.entityStringId=i;break;case $e.ActionLogFilteredColumns.EntityTitle:t.entityTitle=i;break;case $e.ActionLogFilteredColumns.ParentEntityId:t.parentEntityId=i;break;case $e.ActionLogFilteredColumns.ExecutionTime:t.from=i.from;t.to=i.to;break;case $e.ActionLogFilteredColumns.ActionTypeName:t.actionTypeCode=i;break;case $e.ActionLogFilteredColumns.EntityTypeName:t.entityTypeCode=i;break;case $e.ActionLogFilteredColumns.UserLogin:jQuery.isArray(i)&&i.length>0&&(t.userIDs=i)}}}),t.attachObserver(EVENT_TYPE_FILTER_TILE_CLOSE,jQuery.proxy(this._onTileClose,this)),t.initialize(),this._tiles[n.value]=t,t=null)},_destroyTile:function(n){if(n&&this._tiles.hasOwnProperty(n)){var t=this._tiles[n];t.detachObserver(EVENT_TYPE_FILTER_TILE_CLOSE);t.dispose();$q.removeProperty(this._tiles,n);t=null}},_destroyAllTiles:function(){for(var n in this._tiles)this._destroyTile(n)},dispose:function(){this._destroyAllTiles();var t=jQuery("#"+this._gridElementId),n=jQuery("#"+this._filterElementId);t.unbind("dataBinding");this._onDataBindingHandler=null;jQuery(".alSearchButton",n).unbind();jQuery(".alResetButton",n).unbind();this._onApplyFilterHandler=null;this._onDataBindingHandler=null;this.$filterCombo.off("change");this.$filterCombo=null;this.$tilesContainer=null;t=null;n=null;$q.collectGarbageInIE()}};Quantumart.QP8.ActionLogComponent.registerClass("Quantumart.QP8.ActionLogComponent");