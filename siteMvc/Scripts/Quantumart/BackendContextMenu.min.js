var EVENT_TYPE_CONTEXT_MENU_SHOWING="OnContextMenuShowing",EVENT_TYPE_CONTEXT_MENU_HIDING="OnContextMenuHiding",EVENT_TYPE_CONTEXT_MENU_HIDDEN="OnContextMenuHidden",EVENT_TYPE_CONTEXT_MENU_ITEM_CLICKING="OnContextMenuItemClicking",EVENT_TYPE_CONTEXT_MENU_ITEM_HOVERING="OnContextMenuItemHoveringHandler";Quantumart.QP8.BackendContextMenu=function(n,t,i){Quantumart.QP8.BackendContextMenu.initializeBase(this);this._contextMenuCode=n;this._contextMenuElementId=t;$q.isObject(i)&&(i.targetElements&&(this._targetElements=i.targetElements),i.zIndex&&(this._zIndex=i.zIndex),$q.isNull(i.allowManualShowing)||(this._allowManualShowing=i.allowManualShowing),this._isBindToExternal=$q.toBoolean(i.isBindToExternal,!1));this._onContextMenuTuneHandler=jQuery.proxy(this._onContextMenuTune,this);this._onContextMenuHidingHandler=jQuery.proxy(this._onContextMenuHiding,this);this._onContextMenuHiddenHandler=jQuery.proxy(this._onContextMenuHidden,this);this._onContextMenuItemHoveringHandler=jQuery.proxy(this._onContextMenuItemHovering,this);this._onContextMenuItemClickingHandler=jQuery.proxy(this._onContextMenuItemClicking,this);this._onCustomActionChangedHandler=jQuery.proxy(this._onCustomActionChanged,this)};Quantumart.QP8.BackendContextMenu.prototype={_contextMenuCode:"",_contextMenuElementId:"",_contextMenuElement:null,_contextMenuComponent:null,_contextMenuContainerElementId:"",_targetElements:null,_allowManualShowing:!1,_contextMenuManagerComponent:null,_ctorOptions:null,_onContextMenuTuneHandler:null,_onContextMenuHidingHandler:null,_onContextMenuHiddenHandler:null,_onContextMenuItemHoveringHandler:null,_onContextMenuItemClickingHandler:null,_onCustomActionChangedHandler:null,_hideRefreshMenuItem:!1,_isBindToExternal:!1,_zIndex:0,get_contextMenuCode:function(){return this._contextMenuCode},set_contextMenuCode:function(n){this._contextMenuCode=n},get_contextMenuElementId:function(){return this._contextMenuElementId},set_contextMenuElementId:function(n){this._contextMenuElementId=n},get_contextMenuElement:function(){return this._contextMenuElement},get_contextMenuComponent:function(){return this._contextMenuComponent},set_targetElements:function(n){this._targetElements=n},get_targetElements:function(){return this._targetElements},set_allowManualShowing:function(n){this._allowManualShowing=n},get_allowManualShowing:function(){return this._allowManualShowing},get_contextMenuManager:function(){return this._contextMenuManagerComponent},set_contextMenuManager:function(n){this._contextMenuManagerComponent=n},initialize:function(){var t=this._contextMenuElementId,n,i,r;$q.isNullOrWhiteSpace(t)&&(t=this._contextMenuCode);n=jQuery("<ul />",{id:t,"class":"contextMenu"});this._zIndex&&n.css("z-index",this._zIndex+10);$q.isNullOrWhiteSpace(this._contextMenuContainerElementId)?jQuery("BODY:first").append(n):jQuery("#"+this._contextMenuContainerElementId).append(n);this._contextMenuElementId=t;this._contextMenuElement=n.get(0);i=this._getMenuComponentName();r=jQuery(this._targetElements).jeegoocontext({menuElementId:t,menuClass:"contextMenu",allowManualShowing:this._allowManualShowing,onTune:this._onContextMenuTuneHandler,onHide:this._onContextMenuHidingHandler,onHid:this._onContextMenuHiddenHandler,onHover:this._onContextMenuItemHoveringHandler,onSelect:this._onContextMenuItemClickingHandler}).data(i);Quantumart.QP8.BackendContextMenuManager.getInstance().attachObserver(EVENT_TYPE_CUSTOM_ACTION_CHANGED,this._onCustomActionChangedHandler);this._contextMenuComponent=r;n=null},_getMenuComponentName:function(){return"jeegoocontext_"+this._contextMenuElementId},showMenu:function(n,t){this._contextMenuComponent._menuElement.childNodes.length>0&&this._contextMenuComponent.show(n,t)},showMenuAt:function(n,t,i,r){this._contextMenuComponent._menuElement.childNodes.length>0&&this._contextMenuComponent.showAt(n,t,i,r)},hideMenu:function(n){this._contextMenuComponent.hide(n)},refresh:function(n,t,i){var r=Quantumart.QP8.BackendContextMenu.getCacheKey(this._contextMenuCode,!0,this._isBindToExternal),u=$cache.removeItem(r);this.addMenuItemsToMenu(n,t,i)},addMenuItemsToMenu:function(n,t,i){var r=this,u;this._hideRefreshMenuItem=n;u=jQuery(this._contextMenuElement);u.empty();Quantumart.QP8.BackendContextMenu.getContextMenuByCode(this._contextMenuCode,!0,this._isBindToExternal,function(i){var h=i,f,o,e,s,c;if(h!=null){if(f=h.Items,o=0,f!=null&&(f=jQuery.grep(f,function(t){return!n||t.ActionTypeCode!=ACTION_TYPE_CODE_REFRESH}),o=f.length),o>0){for(e=new $.telerik.stringBuilder,s=0;s<o;s++)c=f[s],r._getMenuItemHtml(e,c),c.BottomSeparator&&r._getSeparatorHtml(e);u.html(e.string());r._extendMenuItemElements(f);e=null}$q.clearArray(f)}h=null;$q.callFunction(t)},function(n){$q.processGenericAjaxError(n);$q.callFunction(i)})},tuneMenuItems:function(n,t,i){var r=this,u={menuCode:this._contextMenuCode,entityId:n,parentEntityId:t||0};this._isBindToExternal===!0&&(u=jQuery.extend(u,{boundToExternal:!0}));$q.getJsonFromUrl("GET",CONTROLLER_URL_CONTEXT_MENU+"GetStatusesList",u,!1,!1,function(n){var t=n,f,u,e,o;if(t){if(f=t.length,f>0)for(u=0;u<f;u++)e=t[u],o=r.getMenuItem(e.Code),$q.isNullOrEmpty(o)||r.setVisibleState(o,e.Visible);$q.clearArray(t)}r._tuneMenuSeparators();$q.callFunction(i)},function(n){$q.processGenericAjaxError(n);$q.callFunction(i)})},_tuneMenuSeparators:function(){jQuery("li.separator",this._contextMenuComponent._menuElement).each(function(){var n=jQuery(this),t=!0;n.nextAll("li.item, li.separator").each(function(){var n=jQuery(this);return n.hasClass("separator")==!0?!1:n.hasClass("item")&&n.css("display")!="none"?(t=!1,!1):void 0});t===!0?n.hide():n.show();n=null});var n=jQuery("li.separator",this._contextMenuComponent._menuElement).filter(function(){return $(this).css("display")!="none"}).first(),t=n.prevAll("li.item").filter(function(){return $(this).css("display")!="none"}).length==0;t&&n.hide();n=null},_getMenuItemHtml:function(n,t){n.cat('<li code="'+$q.htmlEncode(t.ActionCode)+'" class="item">\n').cat('  <div class="outerWrapper">\n').cat('      <div class="innerWrapper">\n').cat('          <span class="icon"').catIf(" style=\"background-image: url('"+THEME_IMAGE_FOLDER_URL_SMALL_ICONS+t.Icon+"')\"",!$q.isNullOrWhiteSpace(t.Icon)&&t.Icon.left(7).toLowerCase()!=="http://").catIf(" style=\"background-image: url('"+t.Icon+"')\"",!$q.isNullOrWhiteSpace(t.Icon)&&t.Icon.left(7).toLowerCase()==="http://").cat(">").cat('<img src="'+COMMON_IMAGE_FOLDER_URL_ROOT+'0.gif" width="16px" height="16px" />').cat("<\/span>\n").cat('          <span class="text">'+$q.htmlEncode(t.Name)+"<\/span>\n").cat("      <\/div>\n").cat("  <\/div>\n").cat("<\/li>\n")},_getSeparatorHtml:function(n){n.cat('<li class="separator"><\/li>\n')},_extendMenuItemElement:function(n,t){var i=this.getMenuItem(n);$q.isNullOrEmpty(i)||(i.data("action_code",t.ActionCode),i.data("action_type_code",t.ActionTypeCode))},_extendMenuItemElements:function(n){var t=this;jQuery.each(n,function(n,i){var r=t.getMenuItem(i.ActionCode);t._extendMenuItemElement(r,i)})},getMenuItemCount:function(){return jQuery("> LI",this._contextMenuElement).length},getMenuItem:function(n){var t=null;return $q.isObject(n)?$q.toJQuery(n):$q.isString(n)?(t=jQuery("LI[code='"+n+"']",this._contextMenuElement),t.length==0&&(t=null),t):void 0},getMenuItemValue:function(n){var t=this.getMenuItem(n),i="";if($q.isNullOrEmpty(t)){alert($l.ContextMenu.menuItemNotSpecified);return}return i=t.attr("code"),t=null,i},getMenuItemText:function(n){var t=this.getMenuItem(n),i="";return $q.isNullOrEmpty(t)||(i=jQuery("SPAN.text",t).text()),t=null,i},setVisibleState:function(n,t){var i=this.getMenuItem(n);t?i.show():i.hide()},setEnableState:function(n,t){var i=this.getMenuItem(n);t?i.removeClass("disabled"):i.addClass("disabled")},getContextMenuEventType:function(){return jQuery.fn.jeegoocontext.getContextMenuEventType()},_onContextMenuTune:function(n,t){var i=new Quantumart.QP8.BackendContextMenuEventArgs;return i.set_menu(this),i.set_targetElement(t),this.notify(EVENT_TYPE_CONTEXT_MENU_SHOWING,i),this.get_contextMenuManager()&&this.get_contextMenuManager().notify(EVENT_TYPE_CONTEXT_MENU_SHOWING,i),i=null,jQuery("LI.item",this._contextMenuElement).filter(function(){return $(this).css("display")!="none"}).length==0?!1:void 0},_onCustomActionChanged:function(){this.refresh(this._hideRefreshMenuItem)},_onContextMenuHiding:function(n,t){var i=new Quantumart.QP8.BackendContextMenuEventArgs;i.set_menu(this);i.set_targetElement(t);this.notify(EVENT_TYPE_CONTEXT_MENU_HIDING,i);this.get_contextMenuManager()&&this.get_contextMenuManager().notify(EVENT_TYPE_CONTEXT_MENU_HIDING,i);i=null},_onContextMenuHidden:function(n,t){var i=new Quantumart.QP8.BackendContextMenuEventArgs;i.set_menu(this);i.set_targetElement(t);this.notify(EVENT_TYPE_CONTEXT_MENU_HIDDEN,i);this.get_contextMenuManager()&&this.get_contextMenuManager().notify(EVENT_TYPE_CONTEXT_MENU_HIDDEN,i);i=null},_onContextMenuItemHovering:function(n,t){var i=new Quantumart.QP8.BackendContextMenuItemEventArgs;i.set_menu(this);i.set_targetElement(t);i.set_menuItem(n.currentTarget);this.notify(EVENT_TYPE_CONTEXT_MENU_ITEM_HOVERING,i);this.get_contextMenuManager()&&this.get_contextMenuManager().notify(EVENT_TYPE_CONTEXT_MENU_ITEM_HOVERING,i);i=null},_onContextMenuItemClicking:function(n,t){var i=new Quantumart.QP8.BackendContextMenuItemEventArgs;i.set_menu(this);i.set_targetElement(t);i.set_menuItem(n.currentTarget);this.notify(EVENT_TYPE_CONTEXT_MENU_ITEM_CLICKING,i);this.get_contextMenuManager()&&this.get_contextMenuManager().notify(EVENT_TYPE_CONTEXT_MENU_ITEM_CLICKING,i);i=null},dispose:function(){var n,i,t;Quantumart.QP8.BackendContextMenu.callBaseMethod(this,"dispose");this._contextMenuManagerComponent&&(n=this._contextMenuCode,$q.isNullOrWhiteSpace(n)||this._contextMenuManagerComponent.removeContextMenu(n),this._contextMenuManagerComponent=null);this._contextMenuComponent&&(this._contextMenuComponent.dispose(),this._contextMenuComponent=null);this._targetElements&&(i=this._getMenuComponentName(),jQuery(this._targetElements).each(function(n,t){jQuery(t).removeData(i)}),this._targetElements=null);this._contextMenuElement&&(t=jQuery(this._contextMenuElement),t.empty().remove(),t=null,this._contextMenuElement=null);Quantumart.QP8.BackendContextMenuManager.getInstance().detachObserver(EVENT_TYPE_CUSTOM_ACTION_CHANGED,this._onCustomActionChangedHandler);this._onContextMenuTuneHandler=null;this._onContextMenuHidingHandler=null;this._onContextMenuHiddenHandler=null;this._onContextMenuItemHoveringHandler=null;this._onContextMenuItemClickingHandler=null;this._onCustomActionChangedHandler=null;$q.collectGarbageInIE()}};Quantumart.QP8.BackendContextMenu.getCacheKey=function(n,t,i){return"contextMenuCachedData"+n+t+i};Quantumart.QP8.BackendContextMenu.getContextMenuByCode=function(n,t,i,r,u){var o=Quantumart.QP8.BackendContextMenu.getCacheKey(n,t,i),s=$cache.getItem(o),h,f,e;if(s)if($q.isFunction(r))r(s);else return s;else if(h=CONTROLLER_URL_CONTEXT_MENU+"GetByCode",f={menuCode:n,loadItems:t},i===!0&&(f=jQuery.extend(f,{boundToExternal:!0})),$q.isFunction(r))$q.getJsonFromUrl("GET",h,f,!1,!1,function(n,t,i){$cache.addItem(o,n);r(n,t,i)},u);else return e=null,$q.getJsonFromUrl("GET",h,f,!1,!1,function(n){$cache.addItem(o,n);e=n},function(n){e=null;$q.processGenericAjaxError(n)}),e};Quantumart.QP8.BackendContextMenu.registerClass("Quantumart.QP8.BackendContextMenu",Quantumart.QP8.Observable);Quantumart.QP8.BackendContextMenuEventArgs=function(){Quantumart.QP8.BackendContextMenuEventArgs.initializeBase(this)};Quantumart.QP8.BackendContextMenuEventArgs.prototype={_menuComponent:null,_targetElement:null,get_menu:function(){return this._menuComponent},set_menu:function(n){this._menuComponent=n},get_targetElement:function(){return this._targetElement},set_targetElement:function(n){this._targetElement=n}};Quantumart.QP8.BackendContextMenuEventArgs.registerClass("Quantumart.QP8.BackendContextMenuEventArgs",Sys.EventArgs);Quantumart.QP8.BackendContextMenuItemEventArgs=function(){Quantumart.QP8.BackendContextMenuItemEventArgs.initializeBase(this)};Quantumart.QP8.BackendContextMenuItemEventArgs.prototype={_menuItemElement:null,get_menuItem:function(){return this._menuItemElement},set_menuItem:function(n){this._menuItemElement=n}};Quantumart.QP8.BackendContextMenuItemEventArgs.registerClass("Quantumart.QP8.BackendContextMenuItemEventArgs",Quantumart.QP8.BackendContextMenuEventArgs);