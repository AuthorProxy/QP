Quantumart.QP8.BackendArticleSearchBlock.FieldSearchBlock=function(n,t){this._fieldSearchBlockElement=n;this._parentEntityId=t;this._elementIdPrefix=Quantumart.QP8.BackendSearchBlockBase.generateElementPrefix();this._fieldSearchContainerList={};this._onAddFieldClickHandler=jQuery.proxy(this._onAddFieldClick,this);this._onFieldSearchContainerCloseHandler=jQuery.proxy(this._onFieldSearchContainerClose,this)};Quantumart.QP8.BackendArticleSearchBlock.FieldSearchBlock.prototype={_fieldSearchBlockElement:null,_fieldSearchListElement:null,_fieldsComboElement:null,_addFieldSearchButtonElement:null,_parentEntityId:0,_elementIdPrefix:"",_fieldSearchContainerList:null,_onAddFieldClickHandler:null,_onFieldSearchContainerCloseHandler:null,initialize:function(){var t,n;$q.getJsonFromUrl("GET",CONTROLLER_URL_ARTICLE_SEARCH_BLOCK+"FieldSearchBlock",{parentEntityId:this._parentEntityId,elementIdPrefix:this._elementIdPrefix},!1,!1,function(n){n.success?t=n.view:alert(n.message)},function(n){t=null;$q.processGenericAjaxError(n)});$q.isNullOrWhiteSpace(t)||(n=jQuery(this._fieldSearchBlockElement),n.html(t),this._fieldSearchListElement=n.find("#"+this._elementIdPrefix+"_FieldSearchList").get(0),this._fieldsComboElement=n.find("#"+this._elementIdPrefix+"_FieldsCombo").get(0),this._addFieldSearchButtonElement=n.find("#"+this._elementIdPrefix+"_AddFieldSearchButton").get(0),this._attachFieldSearchBlockEventHandlers(),n=null)},get_searchQuery:function(){var t=[],n,i;for(n in this._fieldSearchContainerList)n&&this._fieldSearchContainerList[n]&&(i=this._fieldSearchContainerList[n].get_searchQuery(),i&&t.push(i));return t.length>0?t:null},get_blockState:function(){var n=jQuery.grep(jQuery.map(this._fieldSearchContainerList,function(n){return n?n.get_blockState():null}),function(n){return n});if(n&&n.length>0)return n},restore_blockState:function(n){if(n){var t=this,i=jQuery("option",this._fieldsComboElement);jQuery.each(n,function(n,r){var u,f;r.fieldID&&!t._fieldSearchContainerList[r.fieldID]&&(u=i.is(function(){var n=jQuery(this);return r.fieldID==n.data("field_id")&&r.fieldName==n.text()&&r.searchType==n.data("search_type")&&r.fieldColumn==n.data("field_column")}),u&&(f=t._createFieldSearchContainerInner(r.fieldID,r.contentID,r.searchType,r.fieldName,r.fieldColumn,r.fieldGroup,r.referenceFieldID),r.data&&f.restore_blockState(r.data)))})}},clear:function(){this._fieldsComboElement&&jQuery(this._fieldsComboElement).find("option:first").prop("selected",!0);this._destroyAllFieldSearchContainers()},_attachFieldSearchBlockEventHandlers:function(){if(this._fieldsComboElement){var n=jQuery(this._fieldsComboElement);n.bind("change",this._onAddFieldClickHandler);n=null}},_detachFieldSearchBlockEventHandlers:function(){if(this._fieldsComboElement){var n=jQuery(this._fieldsComboElement);n.unbind("change",this._onAddFieldClickHandler);n=null}},_createFieldSearchContainer:function(){var i=jQuery(this._fieldsComboElement),n=i.find("option:selected"),t;if(n){if(t=n.data("field_id"),t&&!this._fieldSearchContainerList[t]){var r=n.data("content_id"),u=n.text(),f=n.data("search_type"),e=n.data("field_column"),o=n.data("field_group"),s=n.data("reference_field_id");this._createFieldSearchContainerInner(t,r,f,u,e,o,s)}i.val("")}},_createFieldSearchContainerInner:function(n,t,i,r,u,f,e){var s=jQuery("<div />",{"class":"fieldSearchContainer"}),o;return jQuery(this._fieldSearchListElement).append(s),o=new Quantumart.QP8.BackendArticleSearchBlock.FieldSearchContainer(s.get(0),this._parentEntityId,n,t,r,i,u,f,e),o.initialize(),o.attachObserver(EVENT_TYPE_CONRETE_FIELD_SEARCH_CONTAINER_CLOSE,this._onFieldSearchContainerCloseHandler),this._fieldSearchContainerList[n]=o,s=null,o},_destroyFieldSearchContainer:function(n){if(this._fieldSearchContainerList[n]){var t=this._fieldSearchContainerList[n],i=jQuery(t.get_ContainerElement());t.detachObserver(EVENT_TYPE_CONRETE_FIELD_SEARCH_CONTAINER_CLOSE,this._onFieldSearchContainerCloseHandler);t.dispose();$q.removeProperty(this._fieldSearchContainerList,n);i.empty().remove();i=null;t=null}},_destroyAllFieldSearchContainers:function(){for(var n in this._fieldSearchContainerList)this._destroyFieldSearchContainer(n)},_onAddFieldClick:function(){this._createFieldSearchContainer()},_onFieldSearchContainerClose:function(n,t,i){this._destroyFieldSearchContainer(i.fieldID)},dispose:function(){this._detachFieldSearchBlockEventHandlers();this._destroyAllFieldSearchContainers();this._fieldSearchContainerList=null;this._fieldSearchBlockElement=null;this._fieldSearchListElement=null;this._fieldsComboElement=null;this._addFieldSearchButtonElement=null;this._onAddFieldClickHandler=null;this._onFieldSearchContainerCloseHandler=null}};Quantumart.QP8.BackendArticleSearchBlock.FieldSearchBlock.registerClass("Quantumart.QP8.BackendArticleSearchBlock.FieldSearchBlock",null,Sys.IDisposable);