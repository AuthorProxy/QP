Quantumart.QP8.BackendArticleSearchBlock.RelationFieldSearch=function(n,t,i,r,u,f,e,o,s){Quantumart.QP8.BackendArticleSearchBlock.RelationFieldSearch.initializeBase(this,[n,t,i,r,u,f,e,o]);this._searchType=s;this._onLoadHandler=jQuery.proxy(this._onLoad,this);this._onIsNullCheckBoxChangeHandler=jQuery.proxy(this._onIsNullCheckBoxChange,this);this._onSelectorChangeHandler=jQuery.proxy(this._onSelectorChange,this)};Quantumart.QP8.BackendArticleSearchBlock.RelationFieldSearch.prototype={initialize:function(){var t,r,n,i,u;$q.getJsonFromUrl("POST",CONTROLLER_URL_ARTICLE_SEARCH_BLOCK+"RelationSearch",{elementIdPrefix:this._elementIdPrefix,fieldID:this._fieldID,parentEntityId:this._parentEntityId,IDs:this._selectedEntitiesIDs},!1,!1,function(n){n.success?t=n.view:alert(n.message)},function(n){t=null;$q.processGenericAjaxError(n)});$q.isNullOrWhiteSpace(t)||(r=this._elementIdPrefix+"_isNullCheckBox",n=jQuery(this._containerElement),n.html(t),i=n.find("#"+r),i.bind("change",this._onIsNullCheckBoxChangeHandler),this._isNullCheckBoxElement=i.get(0),this._entityContainerElement=n.find("#EntityContainer").get(0),this._textAreaContainerElement=n.find("#TextAreaContainer").get(0),this._textAreaElement=n.find("#"+this._elementIdPrefix+"_relationTextArea").get(0),u=this._elementIdPrefix+"_inverseCheckBox",this._inverseCheckBoxElement=n.find("#"+u).get(0),jQuery(".radioButtonsList input[type='radio']",n).click(this._onSelectorChangeHandler),jQuery(document).ready(this._onLoadHandler),i=null,n=null)},get_searchQuery:function(){var n=null;return n=this._isEntity?jQuery.map(this._getSelectedEntities(),function(n){return n.Id}):this._getIds(jQuery(this._textAreaElement).val()),Quantumart.QP8.BackendArticleSearchBlock.createFieldSearchQuery(this._searchType,this._fieldID,this._fieldColumn,this._contentID,this._referenceFieldID,n,this.get_IsNull(),this.get_Inverse())},get_blockState:function(){return new Quantumart.QP8.BackendArticleSearchBlock.FieldSearchState(this._searchType,this._fieldID,this._contentID,this._fieldColumn,this._fieldName,this._fieldGroup,this._referenceFieldID,{isNull:this.get_IsNull(),inverse:this.get_Inverse(),entities:this._getSelectedEntities(),text:jQuery(this._textAreaElement).val(),isEntity:this._isEntity})},_selectedEntitiesIDs:null,set_blockState:function(n){this._selectedEntitiesIDs=n&&!$q.isNullOrEmpty(n.entities)?jQuery.map(n.entities,function(n){return n.Id}):null},get_filterDetails:function(){var t=this.get_blockState().data,n,i;return t.isNull?n=$l.SearchBlock.isNullCheckBoxLabelText:t.isEntity?n=$q.isNullOrEmpty(t.entities)?"":this._getText(t.entities,function(n){return $q.cutShort(n.Name,10)}):(i=this._getIds(t.text),n=this._getText(i)),t.inverse&&n!=""&&(n=$l.SearchBlock.notText+"("+n+")"),n},restore_blockState:function(n,t){var i,r;n&&(this._isNullCheckBoxElement&&(i=jQuery(this._isNullCheckBoxElement),i.prop("checked",n.isNull),i.trigger("change"),i=null),this._inverseCheckBoxElement&&(r=jQuery(this._inverseCheckBoxElement),r.prop("checked",n.inverse)),t&&(this._selectedEntitiesIDs=jQuery.map(n.entities,function(n){return n.Id}),this._entityDataListElement&&jQuery(this._entityDataListElement).data("entity_data_list_component").selectEntities(this._selectedEntitiesIDs)),jQuery(this._textAreaElement).val(n.text),jQuery(".radioButtonsList input:radio[value="+(n.isEntity?0:1)+"]",this._containerElement).prop("checked",!0).trigger("click"))},_getSelectedEntities:function(){var n=jQuery(this._entityDataListElement).data("entity_data_list_component"),t=n.getSelectedEntities();return n=null,t},_onIsNullCheckBoxChange:function(){var n=jQuery(this._entityDataListElement).data("entity_data_list_component");this.get_IsNull()?(n.disableList(),jQuery(this._textAreaElement).prop("disabled",!0)):(n.enableList(),jQuery(this._textAreaElement).prop("disabled",!1));n=null},_onLoad:function(){$c.initAllEntityDataLists(this._containerElement);this._entityDataListElement=$c.getAllEntityDataLists(this._containerElement).get(0)},_onSelectorChange:function(n){this._isEntity=jQuery(n.currentTarget).val()==0;this._isEntity?(jQuery(this._entityContainerElement).show(),jQuery(this._textAreaContainerElement).hide(),jQuery(this._entityDataListElement).data("entity_data_list_component").refreshList()):(jQuery(this._entityContainerElement).hide(),jQuery(this._textAreaContainerElement).show())},onOpen:function(){$c.fixAllEntityDataListsOverflow(this._containerElement)},dispose:function(){if($c.destroyAllEntityDataLists(this._containerElement),this._isNullCheckBoxElement){var n=jQuery(this._isNullCheckBoxElement);n.unbind("change",this._onIsNullCheckBoxChangeHandler);n=null}this._isNullCheckBoxElement=null;this._inverseCheckBoxElement=null;this._entityDataListElement=null;this._entityContainerElement=null;this._textAreaContainerElement=null;this._textAreaElement=null;this._onIsNullCheckBoxChangeHandler=null;this._onLoadHandler=null;Quantumart.QP8.BackendArticleSearchBlock.RelationFieldSearch.callBaseMethod(this,"dispose")},_onIsNullCheckBoxChangeHandler:null,get_IsNull:function(){return this._isNullCheckBoxElement?jQuery(this._isNullCheckBoxElement).is(":checked"):!1},get_Inverse:function(){return this._inverseCheckBoxElement?jQuery(this._inverseCheckBoxElement).is(":checked"):!1},_searchType:0,_isEntity:!0,_isNullCheckBoxElement:null,_inverseCheckBoxElement:null,_entityDataListElement:null,_entityContainerElement:null,_textAreaContainerElement:null,_textAreaElement:null};Quantumart.QP8.BackendArticleSearchBlock.RelationFieldSearch.registerClass("Quantumart.QP8.BackendArticleSearchBlock.RelationFieldSearch",Quantumart.QP8.BackendArticleSearchBlock.FieldSearchBase);