Quantumart.QP8.BackendTreeBase=function(n,t){Quantumart.QP8.BackendTreeBase.initializeBase(this);this._treeElementId=n;this._treeElementName=n;$q.isObject(t)&&(t.treeContainerElementId&&(this._treeContainerElementId=t.treeContainerElementId),$q.isNull(t.showIds)||(this._showIds=t.showIds),$q.isNull(t.autoGenerateLink)||(this._makeLinksFromIds=t.autoGenerateLink),$q.isNull(t.autoCheckChildren)||(this._autoCheckChildren=t.autoCheckChildren),t.actionCodeForLink&&(this._readActionCode=t.actionCodeForLink),t.isWindow&&(this._hostIsWindow=t.isWindow));this._onNodeClickingHandler=jQuery.proxy(this._onNodeClicking,this);this._onIdClickingHandler=jQuery.proxy(this._onIdClicking,this)};Quantumart.QP8.BackendTreeBase.prototype={_treeElementId:"",_treeElementName:"",_treeElement:null,_treeContainerElementId:"",_stopDeferredOperations:!1,_treeComponent:null,_deferredNodeCodeToHighlight:"",_showIds:!1,_makeLinksFromIds:!0,_autoCheckChildren:!1,_readActionCode:"",_hostIsWindow:!1,ROOT_NODE_CODE:"root",ROOT_NODE_CLASS_NAME:"t-treeview",NODE_HOVER_CLASS_NAME:"t-state-hover",NODE_SELECTED_CLASS_NAME:"t-state-selected",NODE_OLD_CLICKABLE_SELECTORS:".t-in:not(.t-state-selected,.t-state-disabled)",NODE_NEW_CLICKABLE_SELECTORS:"SPAN.t-in:not(.t-state-disabled)",NODE_ID_LINK_SELECTORS:"SPAN.idLink A",NODE_WRAPPER_SELECTOR:"> DIV > SPAN.t-in",NODE_CHECKBOX_SELECTORS:"> DIV > SPAN.t-checkbox INPUT:checkbox:not(:disabled)",NODE_PLUS_SELECTOR:"> DIV .t-plus",NODE_MINUS_SELECTOR:"> DIV .t-minus",get_treeElementId:function(){return this._treeElementId},set_treeElementId:function(n){this._treeElementId=n},get_treeElement:function(){return this._treeElement},get_treeContainerElementId:function(){return this._treeContainerElementId},set_treeContainerElementId:function(n){this._treeContainerElementId=n},_onDataBindingHandler:null,_onNodeClickingHandler:null,_onNodeCheckboxClickHandler:null,initialize:function(){var t=jQuery("#"+this._treeElementId),n=t.data("tTreeView"),i;n.isAjax=this.isAjax;n.ajaxRequest=this._onDataBindingHandler;i=this;this._initNodeCheck(n);this._initNewToggle(n);this._treeElement=t.get(0);this._treeComponent=n;t.unbind("select").undelegate(this.NODE_OLD_CLICKABLE_SELECTORS,"click").delegate(this.NODE_NEW_CLICKABLE_SELECTORS,"click",this._onNodeClickingHandler).delegate(this.NODE_ID_LINK_SELECTORS,"click",this._onIdClickingHandler);t=null},_initNodeCheck:function(n){var t=this;n.nodeCheck=function(i,r,u){t._legacyNodeCheck.call(n,i,r);t.customNodeCheck.call(t,i,r,u);t._proceedAutoCheckChildren.call(t,i,r,u)}},_initNewToggle:function(n){var t=n.nodeToggle;n.nodeToggle=function(){t.call(n,arguments[0],arguments[1],!0)}},isAjax:function(){return!0},getChildNodesContainer:function(n){var t=this.getNode(n),i=jQuery("> UL.t-group",t);return t=null,i},getAllNodes:function(){var n=jQuery(this._treeElement),t=n.find("LI.t-item");return n=null,t},getSelectedNodes:function(){return this.getAllNodes().filter(":has(> DIV > SPAN."+this.NODE_SELECTED_CLASS_NAME+")")},getNode:function(n,t){if($q.isObject(n))return $q.toJQuery(n);if($q.isString(n)||$q.isInt(n)||$q.isFloat(n)){$parentNode=jQuery(t);$q.isNullOrEmpty($parentNode)&&($parentNode=jQuery("#"+this._treeElementId));var i=null;return n==this.ROOT_NODE_CODE?i=jQuery("#"+this._treeElementId):(i=jQuery("LI DIV INPUT:hidden[value='"+n+"']",$parentNode).parent().parent().filter(".t-item"),i.length==0&&(i=null)),i}},getNodeValue:function(n){var t=this.getNode(n),i="";return $q.isNullOrEmpty(t)||(i=t.hasClass(this.ROOT_NODE_CLASS_NAME)?this.ROOT_NODE_CODE:this._treeComponent.getItemValue(t)),i},getNodeText:function(n){var t=this.getNode(n),i="";return $q.isNullOrEmpty(t)||(i=this._treeComponent.getItemText(t)),i},getParentNode:function(n){var i=this.getNode(n),t=null;return $q.isNullOrEmpty(i)||(t=i.parent().parent(),t.length!=0&&t.hasClass("t-item")||(t=null)),t},refreshNode:function(n,t){var r=!0,u=null,i,f,e;$q.isObject(t)&&($q.isNull(t.loadChildNodes)||(r=t.loadChildNodes),t.callback&&(u=t.callback));i=this.getNode(n);f=this;$q.isNullOrEmpty(i)||(e=function(){},this.getChildNodeCount(i)>0&&this.collapseNode(i),this._refreshNodeInner(i,r,u))},_refreshNodeInner:function(){alert($l.Common.methodNotImplemented);return},refreshNodes:function(n,t){var r=this,i=$q.toJQuery(n);$q.isNullOrEmpty(i)||i.each(function(n,i){var u=jQuery(i);r.refreshNode(u,t)})},_renderNode:function(n,t,i){var f=this.getNode(n),e=this.getCheckedNodeIndex(n),r=new $.telerik.stringBuilder;$.telerik.treeview.getItemHtml({elementId:this._treeElementName,item:t,html:r,isAjax:this.isAjax(),isFirstLevel:i,showCheckBoxes:this._treeComponent.showCheckBox,itemIndex:e,showIds:this._showIds,makeLinksFromIds:this._makeLinksFromIds});var u=jQuery(r.string()),o=u.attr("class"),s=u.html();r=null;u=null;f.attr("class",o).html(s)},_renderChildNodes:function(n,t,i){var u=this.getNode(n),r=this._getChildNodesContainer(u),e=$q.isNullOrEmpty(r),f=new $.telerik.stringBuilder,o=this.getCheckedNodeIndex(n);$.telerik.treeview.getGroupHtml({elementId:this._treeElementName,data:t,html:f,isAjax:!0,isFirstLevel:i,showCheckBoxes:this._treeComponent.showCheckBox,renderGroup:e,groupLevel:o,showIds:this._showIds,makeLinksFromIds:this._makeLinksFromIds});$q.isNullOrEmpty(r)||u.data("loaded")!==!1?$q.isNullOrEmpty(r)||u.data("loaded")===!1?$q.isNullOrEmpty(r)&&(r=$(f.string()).appendTo(u)):r.empty().html(f.string()):$(f.string()).prependTo(r);r.show();r=null},refreshTree:function(){var n=this._isSearchQueryEmpty()?1:0;$("ul.t-group",this._treeElement).remove();this.addNodesToParentNode(this._treeElement,n)},_onNodeClicking:function(n){var t=jQuery(n.currentTarget),i=jQuery(t.closest(".t-item")[0]);if(this._treeComponent.shouldNavigate(t))i=null,t=null;else return i=null,t=null,n.preventDefault(),!1},_onIdClicking:function(n){n.preventDefault();n.stopPropagation();this._readActionCode&&this.executeAction($(n.currentTarget).closest(".t-item").first(),this._readActionCode,{ctrlKey:n.ctrlKey,shiftKey:n.shiftKey})},expandNode:function(n){var t=this.getNode(n);$q.isNullOrEmpty(t)||this._treeComponent.expand(t)},collapseNode:function(n){var t=this.getNode(n);$q.isNullOrEmpty(t)||this._treeComponent.collapse(t)},removeNodeOrRefreshParent:function(n,t,i){var r=this.getNode(n);r&&(r.siblings().length>0?this.removeNode(r):this.refreshNode(t,i))},removeNode:function(n){var t=this.getNode(n);$q.isNullOrEmpty(t)||t.hide(100,function(){t.removeData().empty().remove()})},removeChildNodes:function(n){var i=this.getNode(n),t=this._getChildNodesContainer(i);$q.isNullOrEmpty(t)||t.empty()},isRootNode:function(n){var t=this.getNode(n),i=!1;return $q.isNullOrEmpty(t)||(i=t.hasClass(this.ROOT_NODE_CLASS_NAME)),i},getNodeLevel:function(n){var i=this.getNode(n),r=-1,t,u;if(!$q.isNullOrEmpty(i))if(this.isRootNode(i))r=0;else{for(t=i.parent(),r=1;!$q.isNullOrEmpty(t)&&!this.isRootNode(i);)u=t.get(0),u&&u.tagName=="LI"&&r++,u=null,t=t.parent();t=null}return r},getCheckedNodeIndex:function(n){var i=this.getNode(n),t=undefined;return this._treeComponent.showCheckBox===!0&&(t=jQuery(".t-checkbox input[type='hidden'][name='"+this._treeElementName+".Index']",i).val()),t},getChildNodeCount:function(n){var t=this.getNode(n),i=0;return $q.isNullOrEmpty(t)||(i=t.find("> UL.t-group > LI").length),i},_getChildNodesContainer:function(n){return this.getNode(n).find("> UL.t-group")},_showAjaxLoadingIndicatorForNode:function(n){var i=this,t=this.getNode(n);t.data("loading_icon_timeout",setTimeout(function(){if(i._stopDeferredOperations){clearTimeout(t.data("loading_icon_timeout"));return}t.find("> DIV > SPAN.t-icon").addClass("t-loading")},100))},_hideAjaxLoadingIndicatorForNode:function(n){var t=this.getNode(n);clearTimeout(t.data("loading_icon_timeout"));t.hasClass("t-item")&&t.data("loaded",!0).find("SPAN.t-icon:first").removeClass("t-loading").removeClass("t-plus").addClass("t-minus")},executeAction:function(){alert($l.Common.methodNotImplemented);return},_legacyNodeCheck:function(n,t){$(n,this.element).each($.proxy(function(n,i){var f=$(i).closest(".t-item"),r=$("> div > .t-checkbox",f),u=r.data("array_name");n=r.find(':input[name="'+u+'.Index"]').val();r.find(':input[name="'+u+"["+n+'].Text"]').remove();r.find(':input[name="'+u+"["+n+'].Value"]').remove();r.find(":checkbox").attr({checked:t?!0:!1,value:t});t&&$($.telerik.treeview.getNodeInputsHtml(this.getItemValue(f),this.getItemText(f),u,n)).appendTo(r)},this))},_proceedAutoCheckChildren:function(n,t,i){var r,u;!i&&this._autoCheckChildren&&(r=$($(n).closest(".t-item")[0]),this._isNodeCollapsed(r)&&this._treeComponent.nodeToggle(null,r,!0),u=this,jQuery("ul.t-group .t-checkbox [type=checkbox]",r).each(function(n,i){var r=jQuery(i);r.prop("checked",t);u._treeComponent.nodeCheck(r,t,!0);r.removeClass(CHANGED_FIELD_CLASS_NAME);r=null}),$parentNode=null)},customNodeCheck:function(){},_isNodeCollapsed:function(n){return n.find(this.NODE_PLUS_SELECTOR).length},dispose:function(){this._stopDeferredOperations=!0;Quantumart.QP8.BackendTreeBase.callBaseMethod(this,"dispose");this._treeComponent&&(this._treeComponent.nodeToggle=null,this._treeComponent.nodeCheck=null,this._treeComponent.element=null,this._treeComponent=null);var n=jQuery(this._treeElement);n.undelegate(this.NODE_NEW_CLICKABLE_SELECTORS,"click").undelegate(this.NODE_ID_LINK_SELECTORS,"click").removeData("tTreeView").empty();n=null;this._treeElement=null;this._onNodeClickingHandler=null;this._onIdClickingHandler=null;$q.collectGarbageInIE()}};$.telerik.treeview.getItemHtml=function(n){var t=n.item,i=n.html,o=n.isFirstLevel,s=n.groupLevel,r=n.itemIndex,f=n.itemsCount,e=(new $.telerik.stringBuilder).cat(s).catIf(":",s).cat(r).string(),u,h,c;i.cat('<li class="t-item').catIf(" t-first",o&&r==0).catIf(" t-last",r==f-1).cat('">').cat('<div class="').catIf("t-top ",o&&r==0).catIf("t-top",r!=f-1&&r==0).catIf("t-mid",r!=f-1&&r!=0).catIf("t-bot",r==f-1).cat('">');(n.isAjax&&t.LoadOnDemand||t.Items&&t.Items.length>0)&&i.cat('<span class="t-icon').catIf(" t-plus",t.Expanded!==!0).catIf(" t-minus",t.Expanded===!0).cat('"><\/span>');n.showCheckBoxes&&t.Checkable!==!1&&(u=n.elementId,i.cat('<span class="t-checkbox" data-array_name="').cat(u).cat('">').cat('<input type="hidden" value="').cat(e).cat('" name="').cat(u).cat(".Index").cat('" class="t-input"/>').cat('<input type="checkbox" value="').cat(t.Checked===!0?"True":"False").cat('" class="t-input').cat('" name="').cat(u).cat("[").cat(e).cat('].Checked"').catIf(' disabled="disabled"',t.Enabled===!1).catIf(' checked="checked"',t.Checked).cat("/>"),t.Checked&&i.cat($.telerik.treeview.getNodeInputsHtml(t.Value,t.Text,u,e)),i.cat("<\/span>"));h=function(n,t){var i=t.NavigateUrl||t.Url;n.cat(i?'<a href="'+i+'" class="t-link ':'<span class="').cat("t-in").catIf(" t-state-selected",t.Selected===!0).cat('">')};c=function(n,t){var i=t.NavigateUrl||t.Url;n.cat(i?"<\/a>":"<\/span>")};h(i,t);t.ImageUrl!=null&&i.cat('<img class="t-image" alt="" src="').cat(t.ImageUrl).cat('" />');t.SpriteCssClasses!=null&&i.cat('<span class="t-sprite ').cat(t.SpriteCssClasses).cat('"><\/span>');n.showIds&&(n.makeLinksFromIds?i.cat('<span class="idLink">(<a class="js" href="javascript:void(0)">'+$q.htmlEncode(t.Value)+"<\/a>)<\/span>"):i.cat('<span class="idLink">('+$q.htmlEncode(t.Value)+")<\/span>"),i.cat(" "));i.catIf(t.Text,t.Encoded===!1).catIf(t.Text.replace(/</g,"&lt;").replace(/>/g,"&gt;"),t.Encoded!==!1);c(i,t);t.Value&&i.cat('<input type="hidden" class="t-input" name="itemValue" value="').cat(t.Value).cat('" />');i.cat("<\/div>");t.Items&&t.Items.length>0&&$.telerik.treeview.getGroupHtml({data:t.Items,html:i,isAjax:n.isAjax,isFirstLevel:!1,showCheckBoxes:n.showCheckBoxes,groupLevel:e,elementId:n.elementId,showIds:n.showIds,makeLinksFromIds:n.makeLinksFromIds});i.cat("<\/li>")};$.telerik.treeview.getGroupHtml=function(n){var i=n.data,r=n.html,f=n.showLines,e=n.isFirstLevel,o=n.renderGroup,t,u;if(o!==!1&&r.cat('<ul class="t-group').catIf(" t-treeview-lines",e&&(typeof f==typeof undefined||f)).cat('"').catIf(' style="display:none"',n.isExpanded!==!0).cat(">"),i&&i.length>0)for(t=0,u=i.length;t<u;t++)$.telerik.treeview.getItemHtml({item:i[t],html:r,isAjax:n.isAjax,isFirstLevel:e,showCheckBoxes:n.showCheckBoxes,groupLevel:n.groupLevel,itemIndex:t,itemsCount:u,elementId:n.elementId,showIds:n.showIds,makeLinksFromIds:n.makeLinksFromIds});o!==!1&&r.cat("<\/ul>")};Quantumart.QP8.BackendTreeBase.registerClass("Quantumart.QP8.BackendTreeBase",Quantumart.QP8.Observable);