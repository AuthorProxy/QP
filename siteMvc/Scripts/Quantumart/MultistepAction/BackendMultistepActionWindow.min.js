var EVENT_TYPE_MULTISTEP_ACTION_WINDOW_CANCELING="OnMultistepActionWindowCanceling",EVENT_TYPE_MULTISTEP_ACTION_WINDOW_CANCELED="OnMultistepActionWindowCanceled",EVENT_TYPE_MULTISTEP_ACTION_WINDOW_CLOSED="OnMultistepActionWindowClosed";Quantumart.QP8.BackendMultistepActionWindow=function(n,t){Quantumart.QP8.BackendMultistepActionWindow.initializeBase(this);this._actionName=n;this._shortActionName=t;this._startStageTime=new Date};Quantumart.QP8.BackendMultistepActionWindow.prototype={_actionName:"",_shortActionName:"",_stagesCount:0,_stagesRemaining:0,_stageName:"",_stageStepsCount:0,_stageStepsRemaining:0,_stageItemsCount:0,_stageItemsRemaining:0,_startStageTime:null,_popupWindowElement:null,_popupWindowComponent:null,_progressBarComponent:null,_progressBarElement:null,_stageNameElement:null,_stageRemainingElement:null,_stageItemsElement:null,_stageElapsedTimeElement:null,_stageTimeRemainingElement:null,_stageAdditionalInfoElement:null,_additionalInfo:null,_windowTitle:$l.MultistepAction.progressWindowTitle,_windowWidth:500,_windowHeight:250,_zIndex:undefined,_parentId:null,initialize:function(){var n,i,t;this._popupWindowComponent=this._createWindow();this._popupWindowElement=this._popupWindowComponent.element;n=jQuery(".lop-main",this._popupWindowElement);n.find(".lop-action-name").text(this._shortActionName==null?this._actionName:this._shortActionName);i=n.find(".lop-stage-name dd");i.text($l.MultistepAction.setupStageName);this._stageNameElement=i.get(0);this._stageRemainingElement=n.find(".lop-stage-remaining dd").get(0);this._stageItemsElement=n.find(".lop-stage-items dd").get(0);this._stageElapsedTimeElement=n.find(".lop-elapsed-time dd").get(0);this._stageTimeRemainingElement=n.find(".lop-time-remaining dd").get(0);this._stageAdditionalInfoElement=n.find(".lop-additional-info dd").get(0);t=n.find(".lop-pbar");this._progressBarElement=t.get(0);t.backendProgressBar();this._progressBarComponent=t.data("backendProgressBar");this._cancelButtonElement=n.find(".lop-cancel-button").click(jQuery.proxy(this._onCancelClicked,this)).get(0);t=null;n=null},_refreshView:function(){var t,n;if(this._progressBarComponent.total(this._stageItemsCount),this._progressBarComponent.value(this._stageItemsCount-this._stageItemsRemaining),this._progressBarComponent.refresh(),jQuery(this._stageNameElement).text(this._stageName),this._additionalInfo!=null)if(this._additionalInfo.indexOf(".csv")>0){jQuery(this._stageAdditionalInfoElement).html("<a href='javascript:void(0);'>"+$l.MultistepAction.linkForDownloadFile+"<\/a>");$(this._stageAdditionalInfoElement).children("a").on("click",jQuery.proxy(this._createDownloadLink,this))}else jQuery(this._stageAdditionalInfoElement).html(this._additionalInfo),this._stageAdditionalInfoElement.scrollWidth>this._stageAdditionalInfoElement.clientWidth&&jQuery(this._stageAdditionalInfoElement).append('<div class="tooltip">'+this._additionalInfo+"<\/div>");jQuery(this._stageRemainingElement).text(String.format($l.MultistepAction.stageRemainingTemplate,this._stagesRemaining,this._stagesCount));jQuery(this._stageItemsElement).text(String.format($l.MultistepAction.stageItemsRemainingTemplate,this._stageItemsRemaining,this._stageItemsCount));t=(new Date).getTime()-this._startStageTime.getTime();jQuery(this._stageElapsedTimeElement).text(this._formatTimeRange(t));n=0;this._stageStepsCount==0?jQuery(this._stageTimeRemainingElement).text(""):this._stageStepsCount>this._stageStepsRemaining?(n=Math.ceil(t*this._stageStepsRemaining/(this._stageStepsCount-this._stageStepsRemaining)),n<=1e3&&(n=1e3),jQuery(this._stageTimeRemainingElement).text(this._formatTimeRange(n))):jQuery(this._stageTimeRemainingElement).text(this._formatTimeRange(0))},_formatTimeRange:function(n){var r=Math.floor(n/1e3),u=Math.floor(r/3600),t=Math.floor((r-u*3600)/60),i=Math.round(r-u*3600-t*60);return t<10&&(t="0"+t),i<10&&(i="0"+i),u+":"+t+":"+i},startAction:function(n){this._stagesCount=n;this._stagesRemaining=n},startStage:function(n,t,i){this._stageName=n;this._stageStepsCount=t;this._stageStepsRemaining=t;this._stageItemsCount=i;this._stageItemsRemaining=i;this._startStageTime=new Date;this._refreshView()},completeStage:function(){this._stagesRemaining-=1;this._stagesRemaining<0&&(this._stagesRemaining=0);this._stageItemsCount=0;this._stageItemsRemaining=0;this._stageStepsCount=0;this._stageStepsRemaining=0;this._refreshView()},_createDownloadLink:function(){if(!$q.isNullOrWhiteSpace(this._additionalInfo)){var n={id:this._parentId,fileName:encodeURIComponent(this._additionalInfo)},t=Quantumart.QP8.BackendLibrary.generateActionUrl("ExportFileDownload",n);return $c.downloadFileWithChecking(t,this._additionalInfo),!1}return!1},completeStep:function(n,t,i){this._stageItemsRemaining-=n;this._additionalInfo=t;this._parentId=i;this._stageItemsRemaining<0&&(this._stageItemsRemaining=0);this._stageStepsRemaining--;this._stageStepsRemaining<0&&(this._stageStepsRemaining=0);this._refreshView()},_isInProcess:!0,_stop:function(){this._isInProcess=!1;jQuery(this._cancelButtonElement).prop({value:$l.MultistepAction.close,title:$l.MultistepAction.closeTitle});jQuery([this._stageNameElement,this._stageItemsElement,this._stageTimeRemainingElement,this._stageElapsedTimeElement,this._stageRemainingElement]).text("")},setError:function(){this._stop();this._progressBarComponent.setColor("red");this._progressBarComponent.setText($l.MultistepAction.errorStatus)},setCancel:function(){this._stop();this._progressBarComponent.setColor("#BDBDBD");this._progressBarComponent.setText($l.MultistepAction.canceledStatus)},setComplete:function(){this._stop();this._progressBarComponent.setColor("green");this._progressBarComponent.setText($l.MultistepAction.completeStatus)},_createWindow:function(){var r=new $.telerik.stringBuilder,n,t,u,i;return r.cat('<div class="lop-main">').cat('<div class="lop-action-name"><\/div>').cat('<div class="lop-info">').cat('<dl class="lop-stage-remaining">').cat("<dt>"+$l.MultistepAction.stageRemainingLabel+"<\/dt>").cat("<dd><\/dd>").cat("<\/dl>").cat('<dl class="lop-stage-name">').cat("<dt>"+$l.MultistepAction.stageNameLabel+"<\/dt>").cat("<dd><\/dd>").cat("<\/dl>").cat('<dl class="lop-stage-items">').cat("<dt>"+$l.MultistepAction.stageItemsRemainingLabel+"<\/dt>").cat("<dd><\/dd>").cat("<\/dl>").cat('<dl class="lop-elapsed-time">').cat("<dt>"+$l.MultistepAction.stageElapsedTimeLabel+"<\/dt>").cat("<dd><\/dd>").cat("<\/dl>").cat('<dl class="lop-time-remaining">').cat("<dt>"+$l.MultistepAction.stageTimeRemaningLabel+"<\/dt>").cat("<dd><\/dd>").cat("<\/dl>").cat('<dl class="lop-additional-info">').cat("<dt>"+$l.MultistepAction.additionalInfoLabel+"<\/dt>").cat('<dd class="brief"><\/dd>').cat("<\/dl>").cat('<div class="lop-pbar-container">').cat('<div class="lop-pbar"><\/div>').cat("<\/div>").cat('<div class="lop-cancel-container">').cat('<input type="button" class="lop-cancel-button" value="').cat($l.MultistepAction.cancel).cat('" title="').cat($l.MultistepAction.cancelTitle).cat('" />').cat("<\/div>").cat("<\/div>").cat("<\/div>"),n=$.telerik.window.create({title:this._windowTitle,html:r.string(),width:this._windowWidth,height:this._windowHeight,modal:!0,resizable:!1,draggable:!1,onClose:jQuery.proxy(this._onWindowClose,this)}).data("tWindow").center(),t=jQuery(n.element),this._zIndex&&t.css("z-index",this._windowZIndex),u=t.find("DIV.t-window-content:first"),i=0,i=jQuery.support.borderRadius?15:10,u.css("padding-bottom",i+"px"),n},_onWindowClose:function(){if(this._isInProcess)return this._cancel(),!1;this.notify(EVENT_TYPE_MULTISTEP_ACTION_WINDOW_CLOSED,{})},_onCancelClicked:function(){this._popupWindowComponent.close()},_cancel:function(){var n=new Quantumart.QP8.BackendMultistepActionWindowEventArgs;if(this.notify(EVENT_TYPE_MULTISTEP_ACTION_WINDOW_CANCELING,n),n.getCancel()===!0)this.notify(EVENT_TYPE_MULTISTEP_ACTION_WINDOW_CANCELED,n);else return!1},dispose:function(){if(this._progressBarComponent=null,this._progressBarElement&&jQuery(this._progressBarElement).backendProgressBar("dispose"),this._progressBarElement=null,this._cancelButtonElement&&jQuery(this._cancelButtonElement).off("click"),this._cancelButtonElement=null,this._popupWindowComponent){var n=this._popupWindowComponent;$c.destroyPopupWindow(n);n=null;this._popupWindowComponent=null}this._popupWindowElement=null}};Quantumart.QP8.BackendMultistepActionWindow.registerClass("Quantumart.QP8.BackendMultistepActionWindow",Quantumart.QP8.Observable);Quantumart.QP8.BackendMultistepActionWindowEventArgs=function(){Quantumart.QP8.BackendMultistepActionWindowEventArgs.initializeBase(this)};Quantumart.QP8.BackendMultistepActionWindowEventArgs.prototype={_cancel:!1,getCancel:function(){return this._cancel},setCancel:function(n){this._cancel=n}};Quantumart.QP8.BackendMultistepActionWindowEventArgs.registerClass("Quantumart.QP8.BackendMultistepActionWindowEventArgs",Sys.EventArgs);