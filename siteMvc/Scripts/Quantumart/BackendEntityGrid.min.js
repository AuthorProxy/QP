var EVENT_TYPE_ENTITY_GRID_DATA_BINDING="OnEntityGridDataBinding",EVENT_TYPE_ENTITY_GRID_DATA_BOUND="OnEntityGridDataBound",EVENT_TYPE_ENTITY_GRID_ACTION_EXECUTING="OnEntityGridActionExecuting",EVENT_TYPE_ENTITY_GRID_ENTITY_SELECTED="OnEntityGridEntitySelected",EVENT_TYPE_ENTITY_GRID_TITLE_LINK_CLICK="OnEntityGridEntityTitleLinkClick";Quantumart.QP8.BackendEntityGrid=function(n,t,i,r,u,f,e){Quantumart.QP8.BackendEntityGrid.initializeBase(this);this._gridGroupCodes=n;this._gridElementId=t;this._entityTypeCode=i;this._parentEntityId=r;this._actionCode=u;$q.isObject(f)&&(f.selectedEntitiesIDs&&(this._selectedEntitiesIDs=f.selectedEntitiesIDs),f.actionCodeForLink&&(this._actionCodeForLink=f.actionCodeForLink),f.contextMenuCode&&(this._contextMenuCode=f.contextMenuCode),$q.isNull(f.allowMultipleRowSelection)||(this._allowMultipleRowSelection=f.allowMultipleRowSelection),$q.isNull(f.allowGlobalSelection)||(this._allowGlobalSelection=f.allowGlobalSelection),f.keyColumnName&&(this._keyColumnName=f.keyColumnName),f.titleColumnName&&(this._titleColumnName=f.titleColumnName),f.parentKeyColumnName&&(this._parentKeyColumnName=f.parentKeyColumnName),$q.isNull(f.linkOpenNewTab)||(this._linkOpenNewTab=f.linkOpenNewTab),$q.isNull(f.allowFilterSelectedEntities)||(this._allowFilterSelectedEntities=f.allowFilterSelectedEntities),f.autoGenerateLink&&(this._autoGenerateLink=f.autoGenerateLink),f.generateLinkOnTitle&&(this._generateLinkOnTitle=f.generateLinkOnTitle),$q.isNull(f.autoLoad)||(this._autoLoad=f.autoLoad),$q.isNull(f.delayAutoLoad)||(this._delayAutoLoad=f.delayAutoLoad),f.filter&&(this._filter=f.filter),f.isWindow&&(this._hostIsWindow=f.isWindow),f.treeFieldId&&(this._treeFieldId=f.treeFieldId),f.selectAllId&&(this._selectAllId=f.selectAllId),f.unselectId&&(this._deselectAllId=f.unselectId),f.zIndex&&(this._zIndex=f.zIndex));$q.isNull(e)||(e.searchQuery&&(this._searchQuery=e.searchQuery),e.contextQuery&&(this._contextQuery=e.contextQuery),e.filter&&(this._filter=e.filter),e.currentPage&&(this._currentPage=e.currentPage),e.orderBy&&(this._orderBy=e.orderBy),this._isBindToExternal=$q.toBoolean(e.isBindToExternal,!1));this._onDataBindingHandler=jQuery.proxy(this._onDataBinding,this);this._onDataBoundHandler=jQuery.proxy(this._onDataBound,this);this._onRowDataBoundHandler=jQuery.proxy(this._onRowDataBound,this);this._onDataLoadErrorHandler=jQuery.proxy(this._onDataLoadError,this);this._onHeaderCheckboxClickHandler=jQuery.proxy(this._onHeaderCheckboxClick,this);this._onTitleLinkClickHandler=jQuery.proxy(this._onTitleLinkClick,this);this._onRowCellClickHandler=jQuery.proxy(this._onRowCellClick,this);this._onRowCheckboxCellClickHandler=jQuery.proxy(this._onRowCheckboxCellClick,this);this._onContextMenuHandler=jQuery.proxy(this._onContextMenu,this);this._onRowContextMenuShowingHandler=jQuery.proxy(this._onRowContextMenuShowing,this);this._onRowContextMenuItemClickingHandler=jQuery.proxy(this._onRowContextMenuItemClicking,this);this._onRowContextMenuHiddenHandler=jQuery.proxy(this._onRowContextMenuHidden,this);this._onSelectAllClickHandler=jQuery.proxy(this._onSelectAllClick,this);this._onDeselectAllClickHandler=jQuery.proxy(this._onDeselectAllClick,this)};Quantumart.QP8.BackendEntityGrid.prototype={_gridGroupCodes:null,_gridElementId:"",_gridElement:null,_gridComponent:null,_currentRowId:-1,_allowMultipleRowSelection:!1,_allowGlobalSelection:!1,_entityTypeCode:"",_parentEntityId:0,_actionCode:"",_actionCodeForLink:"",_contextMenuCode:"",_keyColumnName:"Id",_titleColumnName:"Name",_parentKeyColumnName:"ParentId",_linkOpenNewTab:!1,_startingEntitiesIDs:[],_selectedEntitiesIDs:[],_allowFilterSelectedEntities:!1,_removedIds:[],_allowSaveRowsSelection:!0,_stopDeferredOperations:!1,_isDataLoaded:!1,_searchQuery:null,_contextQuery:null,_autoGenerateLink:!1,_generateLinkOnTitle:!1,_contextMenuComponent:null,_gridManagerComponent:null,_autoLoad:!0,_delayAutoLoad:!1,_contextMenuActionCode:"",_filter:"",_hostIsWindow:!1,_treeFieldId:0,_isBindToExternal:!1,_deselectAllId:"",_selectAllId:"",_zIndex:0,GRID_BUSY_CLASS_NAME:"busy",ROW_SELECTED_CLASS_NAME:"t-state-selected",TITLE_CELL_CLASS_NAME:"title",ID_CELL_CLASS_NAME:"id",ROW_CLICKABLE_SELECTORS:"tr:not(.t-grouping-row,.t-detail-row,.t-no-data,:has(>.t-edit-container))",CHECKBOX_HEADER_SELECTORS:".t-select-header INPUT:checkbox",CHECKBOX_CELL_SELECTORS:".t-select-cell INPUT:checkbox",get_gridGroupCodes:function(){return this._gridGroupCodes},get_gridElementId:function(){return this._gridElementId},set_gridElementId:function(n){this._gridElementId=n},get_gridElement:function(){return this._gridElement},set_gridElement:function(n){this._gridElement=n},get_gridComponent:function(){return this._gridComponent},get_entityTypeCode:function(){return this._entityTypeCode},set_entityTypeFromRow:function(n){var i=this.getRow(n),t=this.getDataItem(i);t.EntityTypeCode&&(this._entityTypeCode=t.EntityTypeCode)},set_actionCodeFromRow:function(n){var i=this.getRow(n),t=this.getDataItem(i);t.ActionCode&&(this._actionCodeForLink=t.ActionCode)},set_entityTypeCode:function(n){this._entityTypeCode=n},get_parentEntityId:function(){return this._parentEntityId},set_parentEntityId:function(n){this._parentEntityId=n},get_actionCode:function(){return this._actionCode},set_actionCode:function(n){this._actionCode=n},get_actionCodeForLink:function(){return this._actionCodeForLink},set_actionCodeForLink:function(n){this._actionCodeForLink=n},get_allowMultipleRowSelection:function(){return this._allowMultipleRowSelection},set_allowMultipleRowSelection:function(n){this._allowMultipleRowSelection=n},get_allowGlobalSelection:function(){return this._allowGlobalSelection},set_allowGlobalSelection:function(n){this._allowGlobalSelection=n},get_selectedEntitiesIDs:function(){return this._selectedEntitiesIDs},set_selectedEntitiesIDs:function(n){this._selectedEntitiesIDs=n},get_contextMenuCode:function(){return this._contextMenuCode},set_contextMenuCode:function(n){this._contextMenuCode=n},get_keyColumnName:function(){return this._keyColumnName},set_keyColumnName:function(n){this._keyColumnName=n},get_titleColumnName:function(){return this._titleColumnName},set_titleColumnName:function(n){this._titleColumnName=n},get_autoGenerateLink:function(){return this._autoGenerateLink},set_autoGenerateLink:function(n){this._autoGenerateLink=n},get_gridManager:function(){return this._gridManagerComponent},set_gridManager:function(n){this._gridManagerComponent=n},get_treeFieldId:function(){return this._treeFieldId},set_treeFieldId:function(n){this._treeFieldId=n},get_currentPage:function(){if(this._gridComponent)return this._gridComponent.currentPage},get_orderBy:function(){if(this._gridComponent)return this._gridComponent.orderBy},_onDataBindingHandler:null,_onDataBoundHandler:null,_onRowDataBoundHandler:null,_onDataLoadErrorHandler:null,_onHeaderCheckboxClickHandler:null,_onTitleLinkClickHandler:null,_onRowCellClickHandler:null,_onRowCheckboxCellClickHandler:null,_onContextMenuHandler:null,_onRowContextMenuShowingHandler:null,_onRowContextMenuItemClickingHandler:null,_onRowContextMenuHiddenHandler:null,_onSelectAllClickHandler:null,_onDeselectAllClickHandler:null,initialize:function(){var i=jQuery("#"+this._gridElementId),n=i.data("tGrid"),r,t,u;this._currentPage&&(n.currentPage=this._currentPage);this._orderBy&&(n.orderBy=this._orderBy);this._gridElement=i.get(0);this._gridComponent=n;this._startingEntitiesIDs=Array.clone(this._selectedEntitiesIDs);i.unbind("dataBinding",n.onDataBinding).unbind("rowDataBound",n.onRowDataBound).bind("dataBinding",this._onDataBindingHandler).bind("dataBound",this._onDataBoundHandler).bind("rowDataBound",this._onRowDataBoundHandler);this._autoLoad&&!this._delayAutoLoad&&n.ajaxRequest();n.selectable&&(r=this._getHeaderCheckbox(),$q.isNullOrEmpty(r)||(this._allowMultipleRowSelection?r.bind("click",this._onHeaderCheckboxClickHandler):r.css("display","none")),r=null,n.$tbody.undelegate(this.ROW_CLICKABLE_SELECTORS,"click").delegate(this.ROW_CLICKABLE_SELECTORS+" td","click",this._onRowCellClickHandler).delegate(this.ROW_CLICKABLE_SELECTORS+" "+this.CHECKBOX_CELL_SELECTORS,"click",this._onRowCheckboxCellClickHandler));$q.isNullOrWhiteSpace(this._contextMenuCode)||(t=new Quantumart.QP8.BackendContextMenu(this._contextMenuCode,String.format("{0}_ContextMenu",this._gridElementId),{targetElements:this._gridElement,allowManualShowing:"true",isBindToExternal:this._isBindToExternal,zIndex:this._zIndex}),t.initialize(),t.addMenuItemsToMenu(!0),u=t.getContextMenuEventType(),i.delegate(this.ROW_CLICKABLE_SELECTORS,u,this._onContextMenuHandler),t.attachObserver(EVENT_TYPE_CONTEXT_MENU_SHOWING,this._onRowContextMenuShowingHandler),t.attachObserver(EVENT_TYPE_CONTEXT_MENU_ITEM_CLICKING,this._onRowContextMenuItemClickingHandler),t.attachObserver(EVENT_TYPE_CONTEXT_MENU_HIDDEN,this._onRowContextMenuHiddenHandler),this._contextMenuComponent=t);this._deselectAllId&&jQuery("#"+this._deselectAllId).bind("click",this._onDeselectAllClickHandler);this._selectAllId&&jQuery("#"+this._selectAllId).bind("click",this._onSelectAllClickHandler);n=null;i=null},_getCurrentAction:function(){return $a.getBackendActionByCode(this._actionCode)},_getTitleLinks:function(){return this.getRows().find(this._getLinkCellSelector()+" > A")},_addLinkToCell:function(n){var r=$q.toJQuery(n),t=r.find(this._getLinkCellSelector()),i;$q.isNullOrEmpty(t)||(t.wrapInner('<a href="javascript:void(0)" />'),i=t.find("A"),i.addClass(this._linkOpenNewTab?"js":"html").bind("click",this._onTitleLinkClickHandler).bind("mouseup",this._onTitleLinkClickHandler),i=null);t=null;r=null},_getLinkCellSelector:function(){var n="TD."+this.ID_CELL_CLASS_NAME;return this._generateLinkOnTitle&&(n+=", TD."+this.TITLE_CELL_CLASS_NAME),n},_removeLinksFromCells:function(){this._getTitleLinks().unbind("click",this._onTitleLinkClickHandler).unbind("mouseup",this._onTitleLinkClickHandler).empty().remove()},getRows:function(){var t=[],n=this._gridComponent;return n&&(t=n.$rows()),n=null,t},getSelectedRows:function(){return this.getRows().filter("."+this.ROW_SELECTED_CLASS_NAME)},getRow:function(n){var t=null,i;return $q.isObject(n)?t=$q.toJQuery(n):$q.isInt(n)&&(i=parseInt(n),t=this.getRows().eq(i)),t},getRowByEntityId:function(n){for(var r,f,u=null,t=this.getRows(),e=t.length,i=0;i<e;i++)if(r=t.eq(i),f=this.getEntityId(r.get(0)),f==n){u=r;break}return t=null,u},getRowsByEntitiesIDs:function(n){var t=[],i,r;return $q.isNullOrEmpty(n)||(i=this,r=this.getRows(),r.each(function(r,u){var f=i.getEntityId(u);Array.contains(n,f)&&Array.add(t,u)})),t},selectRow:function(n,t){t||(this._changePageRowsState(!1),!this._allowMultipleRowSelection&&this._allowGlobalSelection&&this._resetRowSelectionState());var i=this.getRow(n),r=this.isRowSelected(i);this._changeRowsState(i,!r);this._saveRowSelectionState();this._raiseSelectEvent()},selectRows:function(n){this._changePageRowsState(!1);$q.isNullOrEmpty(n)||this._changeRowsState($q.toJQuery(n),!0);this._saveRowSelectionState();this._raiseSelectEvent()},selectAllRows:function(){this._changePageRowsState(!0);this._saveRowAllSelectionState();this._raiseSelectEvent()},deselectAllRows:function(){this._changePageRowsState(!1);this._selectedEntitiesIDs=[];this._raiseSelectEvent()},_changePageRowsState:function(n){this._changeRowsState(this.getRows(),n)},selectPageRows:function(n){this._changePageRowsState(n);this._saveRowSelectionState();this._raiseSelectEvent()},isRowSelected:function(n){return this.getRow(n).hasClass(this.ROW_SELECTED_CLASS_NAME)},_changeRowsState:function(n,t){n[t?"addClass":"removeClass"](this.ROW_SELECTED_CLASS_NAME);n.find(this.CHECKBOX_CELL_SELECTORS).prop("checked",t)},_getHeaderCheckbox:function(){return jQuery(this.CHECKBOX_HEADER_SELECTORS,this._gridComponent.$header)},_checkHeaderCheckbox:function(){var n=this._getHeaderCheckbox();n.prop("checked",!0);n=null},_uncheckHeaderCheckbox:function(){var n=this._getHeaderCheckbox();n.prop("checked",!1);n=null},_refreshHeaderCheckbox:function(){this._isAllRowsSelectedInCurrentPage()?this._checkHeaderCheckbox():this._uncheckHeaderCheckbox()},_refreshCancelSelection:function(){if(this._deselectAllId){var t=jQuery("#"+this._deselectAllId),n=t.data("action_link_component");n&&(this._selectedEntitiesIDs.length>0?n.enableActionLink():n.disableActionLink())}},getDataItem:function(n){var t=null,i=this.getRow(n);return $q.isNullOrEmpty(i)||(t=this._gridComponent.dataItem(i.get(0))),t},getEntityId:function(n){var i=0,r=this.getRow(n),t=this.getDataItem(r);return t&&t[this._keyColumnName]&&(i=t[this._keyColumnName]),i},getEntityName:function(n){var i="",r=this.getRow(n),t=this.getDataItem(r);return t&&t[this._titleColumnName]&&(i=t[this._titleColumnName]),i},getParentEntityId:function(n){var i=this._parentEntityId,r=this.getRow(n),t=this.getDataItem(r);return t&&t[this._parentKeyColumnName]&&(i=t[this._parentKeyColumnName]),i},checkExistEntityInCurrentPage:function(n){var t=!1,i=this.getRowByEntityId(n);return $q.isNullOrEmpty(i)||(t=!0),t},checkExistEntitiesInCurrentPage:function(n){var i=this,t=!1;return jQuery.each(n,function(n,r){if(i.checkExistEntityInCurrentPage(r.Id))return t=!0,!1}),t},getEntitiesFromRows:function(n){for(var u=[],e=n.length,r=0;r<e;r++){var i=0,f="",t=this.getDataItem(n[r]);t&&(t[this._keyColumnName]&&(i=t[this._keyColumnName]),f=t[this._titleColumnName]?t[this._titleColumnName]+"":i,i&&Array.add(u,{Id:i,Name:f}))}return u},getSelectedEntities:function(){var n=[],i,t,r;return this._allowGlobalSelection?(i=this.getRowsByEntitiesIDs(this._selectedEntitiesIDs),t=this,n=jQuery.map(i,function(n){return{Id:t.getEntityId(n),Name:t.getEntityName(n)}}),r=jQuery.grep(this._selectedEntitiesIDs,function(t){for(var i=0;i<n.length;i++)if(n[i].Id==t)return!1;return!0}),jQuery.each(r,function(t,i){n.push({Id:i,Name:""})})):n=this.getEntitiesFromRows(this.getSelectedRows()),n},resetGrid:function(n){$q.isObject(n)&&($q.isNull(n.searchQuery)||(this._searchQuery=n.searchQuery),$q.isNull(n.contextQuery)||(this._contextQuery=n.contextQuery));var t=this._gridComponent;t.currentPage=1;t&&t.ajaxRequest();t=null},refreshGrid:function(n){$q.isObject(n)&&($q.isNull(n.saveRowsSelection)||(this._allowSaveRowsSelection=n.saveRowsSelection),$q.isNull(n.searchQuery)||(this._searchQuery=n.searchQuery),$q.isNull(n.contextQuery)||(this._contextQuery=n.contextQuery),$q.isNull(n.removedIds)||(this._removedIds=n.removedIds));var t=this._gridComponent;t&&t.ajaxRequest()},markGridAsBusy:function(){jQuery(this._gridElement).addClass(this.GRID_BUSY_CLASS_NAME)},unmarkGridAsBusy:function(){jQuery(this._gridElement).removeClass(this.GRID_BUSY_CLASS_NAME)},isGridBusy:function(){return jQuery(this._gridElement).hasClass(this.GRID_BUSY_CLASS_NAME)},executeAction:function(n,t,i,r){var e=this.getRow(n),f,o,u,s;if(!$q.isNullOrEmpty(e)){if(f=$a.getBackendActionByCode(t),f){o={ctrlKey:r};t==ACTION_CODE_ADD_NEW_CHILD_ARTICLE&&(o=jQuery.extend(o,{additionalUrlParameters:{fieldId:this._treeFieldId,articleId:this.getEntityId(e),isChild:!0}}));var c=this.getEntityId(e),l=this.getEntityName(e),h=new Quantumart.QP8.BackendActionParameters({entityTypeCode:this._entityTypeCode,entityId:c,entityName:l,entities:f.ActionType.IsMultiple?[{Id:c,Name:l}]:null,parentEntityId:this.getParentEntityId(e),context:o});h.correct(f);u=$a.getEventArgsFromActionWithParams(f,h);u.set_startedByExternal(this._isBindToExternal);s=Quantumart.QP8.Backend.getInstance().checkOpenDocumentByEventArgs(u);this._hostIsWindow?s?alert(s):(u.set_isWindow(!0),this.notify(EVENT_TYPE_ENTITY_GRID_ACTION_EXECUTING,u)):!i||this._linkOpenNewTab||s?this.notify(EVENT_TYPE_ENTITY_GRID_ACTION_EXECUTING,u):this.notify(EVENT_TYPE_ENTITY_GRID_TITLE_LINK_CLICK,u);h=null;u=null}else alert($l.Common.ajaxDataReceivingErrorMessage);f=null}},_raiseSelectEvent:function(){var t=this._getCurrentAction(),n=$a.getEventArgsFromAction(t);n.set_isMultipleEntities(!0);n.set_entityTypeCode(this._entityTypeCode);n.set_entities(this.getSelectedEntities());n.set_parentEntityId(this._parentEntityId);this._allowFilterSelectedEntities&&!this._hostIsWindow&&n.set_context({dataQueryParams:this._createDataQueryParams(),url:this._gridComponent.url("selectUrl")});this.notify(EVENT_TYPE_ENTITY_GRID_ENTITY_SELECTED,n);n=null;this._refreshHeaderCheckbox();this._refreshCancelSelection()},_isAllRowsSelectedInCurrentPage:function(){var n=this.getRows(),t=this.getSelectedRows();return n.length==t.length},_saveRowSelectionState:function(){for(var n=this.getRows(),f=n.length,t=0;t<f;t++){var r=n.eq(t),u=this.isRowSelected(r),i=this.getEntityId(r);Array.contains(this._selectedEntitiesIDs,i)?u||Array.remove(this._selectedEntitiesIDs,i):u&&Array.add(this._selectedEntitiesIDs,i)}n=null},_saveRowAllSelectionState:function(){var u=this.getRows().length,f=this._gridComponent.total,e=!(u<f),r;if(e)this._saveRowSelectionState();else{var o=this._gridComponent.url("selectUrl"),s=jQuery.extend({page:1,size:0,onlyIds:!0},this._createDataQueryParams()),i=null,n=null,t=this._getCurrentAction();t&&(n=$a.getEventArgsFromAction(t),n.set_isMultipleEntities(!0),n.set_entityTypeCode(this._entityTypeCode),n.set_entities(this.getSelectedEntities()),n.set_parentEntityId(this._parentEntityId));t&&this.notify(EVENT_TYPE_ENTITY_GRID_DATA_BINDING,n);$q.postDataToUrl(o,s,!1,function(n){i=n},function(n){$q.processGenericAjaxError(n)});t&&this.notify(EVENT_TYPE_ENTITY_GRID_DATA_BOUND,n);r=this;i&&(this._selectedEntitiesIDs=jQuery.map(i.data,function(n){return n[r._keyColumnName]}))}},_restoreRowSelectionState:function(){var i=this,r=this._selectedEntitiesIDs,n=[],t=this.getRows();t.each(function(t,u){var f=jQuery(u),e=i.getEntityId(f);Array.contains(r,e)&&Array.add(n,u)});this.selectRows(n);t=null},_resetRowSelectionState:function(){$q.clearArray(this._selectedEntitiesIDs)},_fixGridWidth:function(){var n=this.get_gridElement(),t=jQuery("table",n).get(0);t.offsetWidth>n.offsetWidth&&jQuery(n).css("width",t.offsetWidth+"px")},_createDataQueryParams:function(){var n={gridParentId:this._parentEntityId};return $q.isNullOrEmpty(this._startingEntitiesIDs)||(n.IDs=this._startingEntitiesIDs.join(",")),$q.isNull(this._searchQuery)||(n.searchQuery=this._searchQuery),$q.isNull(this._contextQuery)||(n.contextQuery=this._contextQuery),$q.isNull(this._filter)||(n.customFilter=this._filter),n},_onDataBinding:function(n){var u=this._createDataQueryParams(),i,t,r;n.data=jQuery.extend(n.data,u);this._isDataLoaded&&(i=this._getCurrentAction(),i&&(t=$a.getEventArgsFromAction(i),t.set_isMultipleEntities(!0),t.set_entityTypeCode(this._entityTypeCode),t.set_entities(this.getSelectedEntities()),t.set_parentEntityId(this._parentEntityId),this.notify(EVENT_TYPE_ENTITY_GRID_DATA_BINDING,t)),this._allowSaveRowsSelection?this._saveRowSelectionState():this._resetRowSelectionState(),r=this._contextMenuComponent,r&&r.hideMenu())},_onDataBound:function(){var t=this._gridComponent,r,i,n;t.currentPage>1&&!t.total&&t.pageTo(t.currentPage-1);this._isDataLoaded=!0;this._fixGridWidth();r=this;this._selectedEntitiesIDs=jQuery.grep(this._selectedEntitiesIDs,function(n){return!Array.contains(r._removedIds,n)});this._removedIds=[];i=this._getCurrentAction();i&&(n=$a.getEventArgsFromAction(i),n.set_isMultipleEntities(!0),n.set_entityTypeCode(this._entityTypeCode),n.set_entities(this.getSelectedEntities()),n.set_parentEntityId(this._parentEntityId),this.notify(EVENT_TYPE_ENTITY_GRID_DATA_BOUND,n));this._allowSaveRowsSelection&&this._restoreRowSelectionState()},_onRowDataBound:function(n){this._applyStatusColor(n.row,n.dataItem);this._autoGenerateLink&&this._addLinkToCell(n.row)},_onDataLoadError:function(n){$q.processGenericAjaxError(n.XMLHttpRequest);n.preventDefault()},_onHeaderCheckboxClick:function(n){this.selectPageRows(jQuery(n.currentTarget).is(":checked"))},_onTitleLinkClick:function(n){var t,u,i,r;if(n.preventDefault(),t=n.type=="mouseup"&&n.which==2,u=n.type=="click"&&(n.which==1||n.which==0),this.isGridBusy()||!(u||t))return!1;i=jQuery(n.currentTarget).parent().parent();this.set_actionCodeFromRow(i);this.set_entityTypeFromRow(i);r=this._actionCodeForLink;$q.isNullOrWhiteSpace(r)?alert("Вы не задали код действия, которое открывает форму редактирования сущности!"):this.executeAction(i,r,!(n.ctrlKey||n.shiftKey||t),n.ctrlKey||t)},_onRowCellClick:function(n){var t=jQuery(n.target),i;t.is(":button, A, :input, A > .t-icon")||(n.stopPropagation(),i=t.closest("TR"),this.selectRow(i,this._allowMultipleRowSelection&&n.ctrlKey),i=null);t=null;this._contextMenuComponent&&this._contextMenuComponent.hideMenu()},_onRowCheckboxCellClick:function(n){var r=jQuery(n.target),t=r.closest("INPUT:checkbox"),i;$q.isNullOrEmpty(t)||(i=t.parent().parent(),this.selectRow(i,this._allowMultipleRowSelection))},_onContextMenu:function(n){var t=jQuery(n.currentTarget),i=jQuery(t.closest("TR")[0]);this._currentRowId=this.getEntityId(i);i=null;this._contextMenuComponent&&this._contextMenuComponent.showMenu(n,t.get(0));t=null;n.preventDefault()},_onRowContextMenuShowing:function(n,t,i){var r=i.get_menu(),u=jQuery(i.get_targetElement());if(!$q.isNullOrEmpty(u)&&!$q.isNullOrEmpty(r)){var o=this._entityTypeCode,f=this._currentRowId,e=this._parentEntityId;r.tuneMenuItems(f,e)}u=null},_onRowContextMenuItemClicking:function(n,t,i){var r=jQuery(i.get_menuItem());$q.isNullOrEmpty(r)||(this._contextMenuActionCode=r.data("action_code"));r=null},_onRowContextMenuHidden:function(n,t,i){var r=jQuery(i.get_targetElement());$q.isNullOrEmpty(this._contextMenuActionCode)||(this.executeAction(r,this._contextMenuActionCode,!1,!1),this._contextMenuActionCode=null);r=null;r=null},_onSelectAllClick:function(){this.selectAllRows()},_onDeselectAllClick:function(){this.deselectAllRows()},_applyStatusColor:function(n,t){var i=t.STATUS_TYPE_COLOR;if(i){var r=jQuery(n),u=r.hasClass("t-alt"),f=u?"t-alt-"+i:"t-"+i;r.removeClass("t-alt").addClass(f)}},onLoad:function(){this._autoLoad&&this._delayAutoLoad&&this.refreshGrid()},dispose:function(){var r,t,n,i,u;this._stopDeferredOperations=!0;Quantumart.QP8.BackendEntityGrid.callBaseMethod(this,"dispose");this._autoGenerateLink&&this._removeLinksFromCells();this._resetRowSelectionState();this._searchQuery=null;this._contextQuery=null;this._startingEntitiesIDs=null;this._selectedEntitiesIDs=null;this._gridManagerComponent&&(r=this._gridElementId,$q.isNullOrWhiteSpace(r)||this._gridManagerComponent.removeGrid(r),this._gridManagerComponent=null);t=jQuery(this._gridElement);n=this._gridComponent;n&&(this._contextMenuComponent&&(n.selectable&&(i=this._getHeaderCheckbox(),$q.isNullOrEmpty(i)||this._allowMultipleRowSelection&&i.unbind("click",this._onHeaderCheckboxClickHandler),i=null,n.$tbody.undelegate(this.ROW_CLICKABLE_SELECTORS+" td","click",this._onRowCellClickHandler).undelegate(this.ROW_CLICKABLE_SELECTORS+" "+this.CHECKBOX_CELL_SELECTORS,"click",this._onRowCheckboxCellClickHandler)),u=this._contextMenuComponent.getContextMenuEventType(),t.unbind("dataBinding").unbind("dataBound").unbind("rowDataBound").undelegate(this.ROW_CLICKABLE_SELECTORS,u,this._onContextMenuHandler),this._contextMenuComponent.detachObserver(EVENT_TYPE_CONTEXT_MENU_SHOWING,this._onRowContextMenuShowingHandler),this._contextMenuComponent.detachObserver(EVENT_TYPE_CONTEXT_MENU_ITEM_CLICKING,this._onRowContextMenuItemClickingHandler),this._contextMenuComponent.detachObserver(EVENT_TYPE_CONTEXT_MENU_HIDDEN,this._onRowContextMenuHiddenHandler),this._contextMenuComponent.dispose(),this._contextMenuComponent=null),n.element=null,n=null,this._gridComponent=null);t.removeData("tGrid").empty();t=null;this._deselectAllId&&jQuery("#"+this._deselectAllId).unbind("click",this._onDeselectAllClickHandler);this._selectAllId&&jQuery("#"+this._selectAllId).unbind("click",this._onSelectAllClickHandler);this._gridElement=null;this._onDataBindingHandler=null;this._onDataBoundHandler=null;this._onRowDataBoundHandler=null;this._onDataLoadErrorHandler=null;this._onHeaderCheckboxClickHandler=null;this._onTitleLinkClickHandler=null;this._onRowCellClickHandler=null;this._onRowCheckboxCellClickHandler=null;this._onContextMenuHandler=null;this._onRowContextMenuShowingHandler=null;this._onRowContextMenuItemClickingHandler=null;this._onRowContextMenuHiddenHandler=null;this._onSelectAllClickHandler=null;this._onDeselectAllClickHandler=null;$q.collectGarbageInIE()}};Quantumart.QP8.BackendEntityGrid.registerClass("Quantumart.QP8.BackendEntityGrid",Quantumart.QP8.Observable);