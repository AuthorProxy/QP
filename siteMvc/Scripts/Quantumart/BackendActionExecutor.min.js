var EVENT_TYPE_BACKEND_ACTION_EXECUTED="OnActionExecuted",BACKEND_ACTION_EXECUTION_STATUS_NOT_STARTING=0,BACKEND_ACTION_EXECUTION_STATUS_SUCCESS=1,BACKEND_ACTION_EXECUTION_STATUS_FAILED=2,BACKEND_ACTION_EXECUTION_STATUS_ERROR=3;Quantumart.QP8.BackendActionExecutor=function(){Quantumart.QP8.BackendActionExecutor.initializeBase(this)};Quantumart.QP8.BackendActionExecutor.prototype={executeNonInterfaceAction:function(n,t){var f=n.get_actionCode(),h=n.get_isCustomAction(),e=null,i,c,l,a,u;if(n.get_context()&&n.get_context().additionalUrlParameters&&(e=jQuery.extend(this._additionalUrlParameters,n.get_context().additionalUrlParameters)),n.get_startedByExternal()===!0&&(e=jQuery.extend(e,{boundToExternal:!0})),$q.isNullOrWhiteSpace(f))t("",n);else if(i=Quantumart.QP8.BackendActionExecutor.getSelectedAction(f),!$q.isNull(i)&&!i.IsInterface){var y=n.get_entities(),o=i.ActionType.IsMultiple,r=i.ConfirmPhrase;if(r&&(c=o?$o.getEntityNamesFromEntities(y).join('", "'):n.get_entityName(),c='"'+c+'"',r=String.format(r,c)),!r||r&&confirm(r))if(l=o?$o.getEntityIDsFromEntities(y):[n.get_entityId()],a=Quantumart.QP8.BackendActionExecutor.generateActionUrl(o,l,n.get_parentEntityId(),"0",f,{additionalUrlParameters:e}),a){u={};(o||h)&&(u.IDs=l);var p=function(i){Quantumart.QP8.BackendActionExecutor.showResult(i);!i||i.Type!=ACTION_MESSAGE_TYPE_CONFIRM&&i.Type!=ACTION_MESSAGE_TYPE_ERROR||i.Type==ACTION_MESSAGE_TYPE_CONFIRM&&confirm(i.Text)?w():t("",n)},w=function(){h?$q.getCustomActionJson(v.Url,b,s):$q.getJsonFromUrl("POST",a,u,!0,!1,b,s)},b=function(i){Quantumart.QP8.BackendActionExecutor.showResult(i);t(i&&i.Type==ACTION_MESSAGE_TYPE_ERROR?BACKEND_ACTION_EXECUTION_STATUS_ERROR:BACKEND_ACTION_EXECUTION_STATUS_SUCCESS,n)},s=function(i,r){r==="timeout"?alert($l.Action.actionExecutingTimeoutMessage):alert($l.Action.actionExecutingErrorMessage);t(BACKEND_ACTION_EXECUTION_STATUS_FAILED,n)},k=function(){if(i.HasPreAction)if(h)$q.getCustomActionJson(v.PreActionUrl,p,s);else{var t=Quantumart.QP8.BackendActionExecutor.generateActionUrl(o,l,n.get_parentEntityId(),"0",f,{isPreAction:!0,additionalUrlParameters:e});$q.getJsonFromUrl("POST",t,u,!1,!1,p,s)}else w()},v,d=function(i){i&&i.Type==ACTION_MESSAGE_TYPE_ERROR?($a.showResult(i),t("",n)):(v=i,k())};h?(u.actionCode=f,$q.getJsonFromUrl("POST",a,u,!1,!1,d,s)):k()}else t("",n);else t("",n)}},executeSpecialAction:function(n){var r=BACKEND_ACTION_EXECUTION_STATUS_NOT_STARTING,t=n.get_entityTypeCode(),i=n.get_actionTypeCode(),f=n.get_entityId(),u={id:n.get_parentEntityId(),fileName:encodeURIComponent(f),entityTypeCode:t,actionTypeCode:i};return i==ACTION_TYPE_CODE_PREVIEW&&(t==ENTITY_TYPE_CODE_SITE_FILE||t==ENTITY_TYPE_CODE_CONTENT_FILE)?($c.preview(Quantumart.QP8.BackendLibrary.generateActionUrl("GetLibraryImageProperties",u)),r=BACKEND_ACTION_EXECUTION_STATUS_SUCCESS):i==ACTION_TYPE_CODE_DOWNLOAD&&(t==ENTITY_TYPE_CODE_SITE_FILE||t==ENTITY_TYPE_CODE_CONTENT_FILE)&&($c.downloadFileWithChecking(Quantumart.QP8.BackendLibrary.generateActionUrl("TestLibraryFileDownload",u),f),r=BACKEND_ACTION_EXECUTION_STATUS_SUCCESS),i==ACTION_TYPE_CODE_CROP&&(t==ENTITY_TYPE_CODE_SITE_FILE||t==ENTITY_TYPE_CODE_CONTENT_FILE)?($c.crop(Quantumart.QP8.BackendLibrary.generateActionUrl("GetLibraryImageProperties",u),u),r=BACKEND_ACTION_EXECUTION_STATUS_SUCCESS):(i==ACTION_TYPE_CODE_ALL_FILES_UPLOADED||i==ACTION_TYPE_CODE_FILE_CROPPED)&&(t==ENTITY_TYPE_CODE_CONTENT_FILE||t==ENTITY_TYPE_CODE_SITE_FILE)&&(r=BACKEND_ACTION_EXECUTION_STATUS_SUCCESS),r},executeMultistepAction:function(n){var i=new jQuery.Deferred,r=this,u=null,y,t,h,c,l,v,b,w,k;if(n.get_startedByExternal()===!0&&(u=jQuery.extend(u,{boundToExternal:!0})),y=n.get_actionCode(),t=Quantumart.QP8.BackendActionExecutor.getSelectedAction(y),!$q.isNull(t)){var p=n.get_entities(),a=t.ActionType.IsMultiple,f=t.ConfirmPhrase;if(f&&(h=a?$o.getEntityNamesFromEntities(p).join('", "'):n.get_entityName(),h='"'+h+'"',f=String.format(f,h)),!f||f&&confirm(f)){var e=n.get_parentEntityId(),o=a?$o.getEntityIDsFromEntities(p):[n.get_entityId()],s={};a&&(s.IDs=o);c=function(n,t){t==="timeout"?alert($l.Action.actionExecutingTimeoutMessage):alert($l.Action.actionExecutingErrorMessage)};l=function(n){var p=Quantumart.QP8.BackendActionExecutor.generateMultistepActionUrl(t,o,e,{additionalUrlParameters:u,isSetup:!0,urlParams:n});n&&(s.settingsParams=n);var l=Quantumart.QP8.BackendActionExecutor.generateMultistepActionUrl(t,o,e,{additionalUrlParameters:u,isTearDown:!0}),w=Quantumart.QP8.BackendActionExecutor.generateMultistepActionUrl(t,o,e,{additionalUrlParameters:u}),a=!1,f=new Quantumart.QP8.BackendMultistepActionWindow(t.Name,t.ShortName),b=function(){f.detachObserver(EVENT_TYPE_MULTISTEP_ACTION_WINDOW_CANCELING);f.detachObserver(EVENT_TYPE_MULTISTEP_ACTION_WINDOW_CANCELED);f.detachObserver(EVENT_TYPE_MULTISTEP_ACTION_WINDOW_CLOSED);f.dispose();f=null};f.attachObserver(EVENT_TYPE_MULTISTEP_ACTION_WINDOW_CANCELING,function(n,t,i){confirm($l.MultistepAction.cancelConfirmation)&&i.setCancel(!0)});f.attachObserver(EVENT_TYPE_MULTISTEP_ACTION_WINDOW_CANCELED,function(){a=!0});f.attachObserver(EVENT_TYPE_MULTISTEP_ACTION_WINDOW_CLOSED,b);f.initialize();var h=function(n,t,u){c(n,t,u);f.setError();i.rejectWith(r,[BACKEND_ACTION_EXECUTION_STATUS_FAILED])},v=function(n,t,i){$q.postDataToUrl(l,{isError:!0},!0).done(function(){h(n,t,i)}).fail(h)},y=function(n){Quantumart.QP8.BackendActionExecutor.showResult(n);$q.postDataToUrl(l,{isError:!0},!0).done(function(){f.setError();i.rejectWith(r,[BACKEND_ACTION_EXECUTION_STATUS_FAILED])}).fail(h)};$q.getJsonFromUrl("POST",p,s,!0,!1).done(function(n){var c;if(n)if(n.Type==ACTION_MESSAGE_TYPE_ERROR)y(n);else{f.startAction(n.Stages.length);var u=0,p=0,o=0,s=0,t=null;n.Stages&&n.Stages.length&&(p=n.Stages.length);c=function(){a===!0&&(u=p);u<p?o<s?$q.getJsonFromUrl("POST",w,{stage:u,step:o},!0,!1).done(function(t){t&&(t.Type==ACTION_MESSAGE_TYPE_ERROR?y(t):(f.completeStep(t.ProcessedItemsCount,t.AdditionalInfo,n.ParentId||e),o++,o==s&&(f.completeStage(),u++),c()))}).fail(v):(t&&s==0&&(f.completeStage(),u++),t=n.Stages[u],o=0,s=0,t&&(s=t.StepCount,f.startStage(t.Name,t.StepCount,t.ItemCount)),c()):$q.postDataToUrl(l,{isError:!1},!0).done(function(){a===!0?f.setCancel():f.setComplete();i.resolveWith(r,[BACKEND_ACTION_EXECUTION_STATUS_SUCCESS])}).fail(h)};c()}}).fail(v)};t.HasSettings&&!n.isSettingsSet?(v=Quantumart.QP8.BackendActionExecutor.generateMultistepActionUrl(t,o,e,{additionalUrlParameters:u,hasSettings:!0,isSettingsSet:n.isSettingsSet}),b=null,$q.getJsonFromUrl("POST",v.replace("Settings","PreSettings"),s,!0,!1).done(function(t){if(t&&t.Type==ACTION_MESSAGE_TYPE_ERROR){Quantumart.QP8.BackendActionExecutor.showResult(t);i.rejectWith(r,[BACKEND_ACTION_EXECUTION_STATUS_FAILED]);return}n.settingsActionUrl=v;var u=new Quantumart.QP8.BackendSettingsPopupWindow(n,t,l)}).fail(c,function(){i.rejectWith(r,[BACKEND_ACTION_EXECUTION_STATUS_FAILED])})):t.HasPreAction?(w=Quantumart.QP8.BackendActionExecutor.generateMultistepActionUrl(t,o,e,{additionalUrlParameters:u,isPreAction:!0}),k=null,$q.getJsonFromUrl("POST",w,s,!0,!1).done(function(n){if(n){if(n.Type==ACTION_MESSAGE_TYPE_ERROR){Quantumart.QP8.BackendActionExecutor.showResult(n);i.rejectWith(r,[BACKEND_ACTION_EXECUTION_STATUS_FAILED]);return}if(n.Type==ACTION_MESSAGE_TYPE_INFO){Quantumart.QP8.BackendActionExecutor.showResult(n);i.resolveWith(r);return}}!n||n.Type!=ACTION_MESSAGE_TYPE_CONFIRM||confirm(n.Text)?l():i.resolveWith(r)}).fail(c,function(){i.rejectWith(r,[BACKEND_ACTION_EXECUTION_STATUS_FAILED])})):l()}else i.resolveWith(r)}return i.promise()},dispose:function(){Quantumart.QP8.BackendActionExecutor.callBaseMethod(this,"dispose");Quantumart.QP8.BackendActionExecutor._instance=null;$q.collectGarbageInIE()}};Quantumart.QP8.BackendActionExecutor._instance=null;Quantumart.QP8.BackendActionExecutor.getInstance=function(){return Quantumart.QP8.BackendActionExecutor._instance==null&&(Quantumart.QP8.BackendActionExecutor._instance=new Quantumart.QP8.BackendActionExecutor),Quantumart.QP8.BackendActionExecutor._instance};Quantumart.QP8.BackendActionExecutor.destroyInstance=function(){Quantumart.QP8.BackendActionExecutor._instance&&Quantumart.QP8.BackendActionExecutor._instance.dispose()};Quantumart.QP8.BackendActionExecutor.getBackendAction=function(n){var t=null;return $q.isObject(n)?t=n:$q.isString(n)&&(t=Quantumart.QP8.BackendActionExecutor.getBackendActionByCode(n)),t};Quantumart.QP8.BackendActionExecutor.getBackendActionByCode=function(n){var i="ActionByActionCode_"+n,t=$cache.getItem(i);return t||($q.getJsonFromUrl("GET",CONTROLLER_URL_BACKEND_ACTION+"GetByCode",{actionCode:n},!1,!1).done(function(n){n.success?t=n.action:(t=null,alert(n.Text))}).fail(function(n){t=null;$q.processGenericAjaxError(n)}),$cache.addItem(i,t)),t};Quantumart.QP8.BackendActionExecutor.getBackendActionById=function(n){var i="ActionByActionId_"+n,t=$cache.getItem(i);return t||($q.getJsonFromUrl("GET",CONTROLLER_URL_BACKEND_ACTION+"GetCodeById",{actionId:n},!1,!1).done(function(n){n.success?t=n.actionCode:(t=null,alert(n.Text))}).fail(function(n){t=null;$q.processGenericAjaxError(n)}),$cache.addItem(i,t)),Quantumart.QP8.BackendActionExecutor.getBackendActionByCode(t)};Quantumart.QP8.BackendActionExecutor.getSelectedAction=function(n){var t=null;return $q.isObject(n)?t=n:$q.isString(n)&&(t=Quantumart.QP8.BackendActionExecutor.getBackendActionByCode(n)),t};Quantumart.QP8.BackendActionExecutor.generateActionUrl=function(n,t,i,r,u,f){var h,l,c;$q.isNullOrEmpty(i)&&(i=0);var e="",o=Quantumart.QP8.BackendActionExecutor.getSelectedAction(u),s=f&&f.additionalUrlParameters?$q.hashToQueryString(f.additionalUrlParameters):"";return $q.isNull(o)||(h=o.IsInterface,l=o.IsCustom,e=f&&f.controllerActionUrl?f.controllerActionUrl:o.ControllerActionUrl?o.ControllerActionUrl:h?"~/Diagnostics/Index/":"",f&&f.isPreAction&&(e=e.replace(/\/$/,"PreAction/")),f&&f.hasSettings&&!f.isSettingsSet&&(e=e.replace(/\/$/,"/Settings/")),e=e.replace(/^~\//,APPLICATION_ROOT_URL),e&&(n?e+=String.format("{0}/{1}/",r,i):(c=t.length>0?t[0]:0,e+=String.format("{0}/{1}/{2}/",r,i,c)),s.length>0&&(e+="?"+s))),e};Quantumart.QP8.BackendActionExecutor.generateBackendActionUrl=function(n,t,i,r,u){return Quantumart.QP8.BackendActionExecutor.generateActionUrl(!1,[n],t,i,r,u)};Quantumart.QP8.BackendActionExecutor.generateBackendMultipleActionUrl=function(n,t,i,r,u){return Quantumart.QP8.BackendActionExecutor.generateActionUrl(!0,n,t,i,r,u)};Quantumart.QP8.BackendActionExecutor.generateMultistepActionUrl=function(n,t,i,r){var u,f,e;return $q.isNullOrEmpty(i)&&(i=0),u="",f=r&&r.additionalUrlParameters?$q.hashToQueryString(r.additionalUrlParameters):"",$q.isNull(n)||(u=n.IsMultistep||$q.isNullOrEmpty(n.AdditionalControllerActionUrl)?n.ControllerActionUrl:n.AdditionalControllerActionUrl,u=r?r.isPreAction?u.replace(/\/$/,"/PreAction/"):r.isSetup?u.replace(/\/$/,"/Setup/"):r.isTearDown?u.replace(/\/$/,"/TearDown/"):r&&r.hasSettings&&!r.isSettingsSet?u.replace(/\/$/,"/Settings/"):u.replace(/\/$/,"/Step/"):u.replace(/\/$/,"/Step/"),u=u.replace(/^~\//,APPLICATION_ROOT_URL),u&&(n.ActionType.IsMultiple?u+=String.format("{0}/{1}/","0",i):(e=t.length>0?t[0]:0,u+=String.format("{0}/{1}/{2}/","0",i,e)),f.length>0&&(u+="?"+f))),u};Quantumart.QP8.BackendActionExecutor.showResult=function(n){var t,i;n&&n.Type&&(t=n.Type,t==ACTION_MESSAGE_TYPE_DOWNLOAD?$c.downloadFile(n.Url):(t==ACTION_MESSAGE_TYPE_INFO||t==ACTION_MESSAGE_TYPE_WARNING||t==ACTION_MESSAGE_TYPE_ERROR)&&(i=n.Text,$q.isNullOrWhiteSpace(i)||alert(i)))};Quantumart.QP8.BackendActionExecutor.fillEventArgsFromAction=function(n,t){if(!$q.isObject(n))throw new Error($l.Common.targetEventArgsNotSpecified);if(!$q.isObject(t))throw new Error($l.Common.actionNotSpecified);n.set_entityTypeCode(t.EntityType.Code);n.set_entityTypeName(t.EntityType.Name);n.set_actionCode(t.Code);n.set_actionName(t.Name);n.set_actionTypeCode(t.ActionType.Code);n.set_isInterface(t.IsInterface);n.set_isCustomAction(t.IsCustom);n.set_isMultistepAction(t.IsMultistep);n.set_isWindow(t.IsWindow);n.set_windowWidth(t.WindowWidth);n.set_windowHeight(t.WindowHeight);n.set_confirmPhrase(t.ConfirmPhrase);n.set_nextSuccessfulActionCode(t.NextSuccessfulActionCode);n.set_nextFailedActionCode(t.NextFailedActionCode);n.set_isMultipleEntities(t.ActionType.IsMultiple)};Quantumart.QP8.BackendActionExecutor.getEventArgsFromAction=function(n){if(!$q.isObject(n))throw new Error($l.Common.actionNotSpecified);var t=new Quantumart.QP8.BackendEventArgs;return Quantumart.QP8.BackendActionExecutor.fillEventArgsFromAction(t,n),t};Quantumart.QP8.BackendActionExecutor.getEventArgsFromActionWithParams=function(n,t){if(!$q.isObject(n))throw new Error($l.Common.actionNotSpecified);var i=new Quantumart.QP8.BackendEventArgs;return Quantumart.QP8.BackendActionExecutor.fillEventArgsFromAction(i,n),i.init(t.get_entityTypeCode(),t.get_entities(),t.get_parentEntityId(),n,t.get_options(),t.get_actionCode()),i};Quantumart.QP8.BackendActionExecutor.getActionViewByViewTypeCode=function(n,t){var i=n.Views,r=null;return $q.isNullOrEmpty(i)||(r=jQuery.grep(i,function(n){return n.ViewType.Code==t})[0]),r};Quantumart.QP8.BackendActionExecutor.registerClass("Quantumart.QP8.BackendActionExecutor",Quantumart.QP8.Observable);window.$a=Quantumart.QP8.BackendActionExecutor;Quantumart.QP8.BackendActionParameters=function(n){Quantumart.QP8.BackendActionParameters.initializeBase(this);$q.isObject(n.eventArgs)?(n.eventArgs.get_isMultipleEntities()?this._entities=n.eventArgs.get_entities():(this._entityId=n.eventArgs.get_entityId(),this._entityName=n.eventArgs.get_entityName()),this._parentEntityId=n.eventArgs.get_parentEntityId(),this._entityTypeCode=n.eventArgs.get_entityTypeCode(),this._previousAction=n.eventArgs.get_previousAction(),this._context=n.eventArgs.get_context(),this._forceOpenWindow=n.eventArgs.get_isWindow()):(n.entities?this._entities=n.entities:(this._entityId=n.entityId,this._entityName=n.entityName),n.isGroup&&(this._isGroup=n.isGroup),this._parentEntityId=n.parentEntityId,this._entityTypeCode=n.entityTypeCode,$q.isObject(n.previousAction)&&(this._previousAction=n.previousAction),$q.isBoolean(n.forceOpenWindow)&&(this._forceOpenWindow=n.forceOpenWindow),$q.isObject(n.context)&&(this._context=n.context))};Quantumart.QP8.BackendActionParameters.prototype={_entityId:0,_entityName:"",_parentEntityId:0,_entityTypeCode:"",_previousAction:null,_entities:null,_forceOpenWindow:!1,_context:null,_actionCode:null,_isGroup:!1,get_entityId:function(){return this._entityId},get_entityName:function(){return this._entityName},get_parentEntityId:function(){return this._parentEntityId},get_entityTypeCode:function(){return this._entityTypeCode},get_context:function(){return this._context},get_entities:function(){return $q.isArray(this._entities)&&this._entities.length>0?this._entities:[{Id:this._entityId,Name:this._entityName}]},get_actionCode:function(){return this._actionCode},correct:function(n){var t=$a.getBackendAction(n);t.IsWindow&&(this._forceOpenWindow=!0);n.ActionType.IsMultiple&&(this._entityId=0,this._entityName="");(n.Code==ACTION_CODE_CONTENT_PERMISSIONS_FOR_CHILD||n.Code==ACTION_CODE_ARTICLE_PERMISSIONS_FOR_CHILD)&&(this._parentEntityId=this._entityId,this._entityId=0,n.Code==ACTION_CODE_CONTENT_PERMISSIONS_FOR_CHILD?this._actionCode=ACTION_CODE_CONTENT_PERMISSIONS:n.Code==ACTION_CODE_ARTICLE_PERMISSIONS_FOR_CHILD&&(this._actionCode=ACTION_CODE_ARTICLE_PERMISSIONS));n.Code==ACTION_CODE_ADD_NEW_ADJACENT_FIELD&&(this._context=this._context||{},jQuery.extend(this._context,{additionalUrlParameters:{fieldId:this._entityId}}),this._entityId=0);this._entityTypeCode!=t.EntityType.Code&&t.ActionType.Code!=ASSEMBLE_PARENT_ACTION_TYPE&&(this._entityTypeCode=t.EntityType.Code,this._entityTypeCode!=ENTITY_TYPE_CODE_SITE_FILE&&this._entityTypeCode!=ENTITY_TYPE_CODE_CONTENT_FILE&&(this._isGroup?(this._context=this._context||{},jQuery.extend(this._context,{additionalUrlParameters:{groupId:this._entityId}})):this._parentEntityId=this._entityId,this._entityId=0,this._entityName=""))},get_options:function(){return{previousAction:this._previousAction,forceOpenWindow:this._forceOpenWindow,context:this._context}}};Quantumart.QP8.BackendActionParameters.registerClass("Quantumart.QP8.BackendActionParameters");