var EVENT_TYPE_CLASSIFIER_FIELD_ARTICLE_LOADED="OnClassifierFieldArticleLoaded",EVENT_TYPE_CLASSIFIER_FIELD_ARTICLE_UNLOADING="OnClassifierFieldArticleUnloading";Quantumart.QP8.BackendClassifierField=function(n,t,i){Quantumart.QP8.BackendClassifierField.initializeBase(this);this._editorExecutingHandler=t;$q.isNull(i)||(i.hostIsWindow&&(this._hostIsWindow=i.hostIsWindow),i.initFieldValues&&(this._initFieldValues=i.initFieldValues),i.disabledFields&&(this._disabledFields=i.disabledFields),i.hideFields&&(this._hideFields=i.hideFields),i.customInit&&(this._customInit=i.customInit),i.customDispose&&(this._customDispose=i.customDispose),i.parentEditor&&(this._parentEditor=i.parentEditor),i.customButtonsSettings&&(this._customButtonsSettings=i.customButtonsSettings),i.customLinkButtonsSettings&&(this._customLinkButtonsSettings=i.customLinkButtonsSettings));this._$componentElem=jQuery(n);this._$componentElem.data(Quantumart.QP8.BackendClassifierField.componentRefDataKey,this)};Quantumart.QP8.BackendClassifierField.componentRefDataKey="component_ref";Quantumart.QP8.BackendClassifierField.getComponent=function(n){return jQuery(n).data(Quantumart.QP8.BackendClassifierField.componentRefDataKey)};Quantumart.QP8.BackendClassifierField.prototype={_$componentElem:null,_$articleWrapper:null,_$contentList:null,_hostIsWindow:!1,_initFieldValues:null,_disabledFields:null,_hideFields:null,_disableChangeTracking:!1,_parentEditor:null,_customInit:null,_customDispose:null,initialize:function(){var t,n;this._$articleWrapper=jQuery('<div class="articleWrapper"><\/div>');this._$componentElem.closest("dl.row").after(this._$articleWrapper);this._$contentList=this._$componentElem.find("select.classifierContentList");t=this._$componentElem.data("aggregated_content_id");t||(t="");this._$contentList.find("option[value="+t+"]").prop("selected",!0);this._$contentList.on("change",jQuery.proxy(this._onContentSelected,this));n=jQuery("#"+this._$componentElem.data("acticle_html_id")).html();n&&(n=jQuery("<div><\/div>").html(n).text(),this._$articleWrapper.html(n));$q.toBoolean(this._$componentElem.data("is_not_changeable"),!1)&&this.makeReadonly()},selectContent:function(n){!$q.isNull(n)&&$q.isInt(n)?this._$contentList.find('OPTION[value="'+n+'"]').prop("selected",!0).change():this._$contentList.find("OPTION:selected").prop("selected",!1).change()},getSelectedContent:function(){return $q.toInt(this._$contentList.find("option:selected").val())},makeReadonly:function(){var n=this._$contentList.find("OPTION:selected").val(),t;$q.isNullOrEmpty(n)||(t=this._$contentList.siblings('input[name="'+this._$contentList.prop("name")+'"]:hidden'),t.length>0?t.val(n):this._$contentList.after('<input type="hidden" name="'+this._$contentList.prop("name")+'" value="'+n+'" />'));this._$contentList.addClass(this.LIST_DISABLED_CLASS_NAME).prop("disabled",!0)},_onContentSelected:function(){var t=$q.toInt(this._$componentElem.data("root_content_id"),0),i=$q.toInt(this._$componentElem.data("root_article_id"),0),r=$q.toInt(this._$contentList.find("option:selected").val(),0),u=this._$componentElem.data("host_id"),f=this._generateUrl(u,t,i,r),n=this;$q.getJsonFromUrl("GET",f,null,!0,!1,function(t){if(t.success){var i=t.view;n.notify(EVENT_TYPE_CLASSIFIER_FIELD_ARTICLE_UNLOADING,{articleWrapper:n._$articleWrapper,toggleDisableChangeTracking:n.set_disableChangeTracking});n._disposeAllFields();n._$articleWrapper.empty();i&&(n._$articleWrapper.html(i),n._initAllFields(),n.notify(EVENT_TYPE_CLASSIFIER_FIELD_ARTICLE_LOADED,{articleWrapper:n._$articleWrapper,toggleDisableChangeTracking:n.set_disableChangeTracking}));n._disableChangeTracking&&(n._$articleWrapper.find("."+CHANGED_FIELD_CLASS_NAME).removeClass(CHANGED_FIELD_CLASS_NAME),n._disableChangeTracking=!1)}else alert(t.message)},function(n){$q.processGenericAjaxError(n)})},_generateUrl:function(n,t,i,r){var u=new $.telerik.stringBuilder;return u.cat(APPLICATION_ROOT_URL).cat("Article/AggregatedArticle/").cat(n).cat("/").cat(t).cat("/").cat(i).cat("?aggregatedContentId=").cat(r).cat("&_=").cat(+new Date),u.string()},_initAllFields:function(){var n=this._$articleWrapper,t;$c.setAllVisualEditorValues(n,this._initFieldValues);$c.makeReadonlyVisualEditors(n,this._disabledFields);$c.initAllDateTimePickers(n);$c.initAllVisualEditors(n);$c.initAllNumericTextBoxes(n);$c.initAllFileFields(n);$c.initAllEntityDataLists(n,this._editorExecutingHandler,{hostIsWindow:this._hostIsWindow});$c.initAllEntityDataTrees(n);$c.initAllAggregationLists(n);$c.initAllHighlightedTextAreas(n);Quantumart.QP8.BackendExpandedContainer.initAll(n);$c.setAllSimpleTextBoxValues(n,this._initFieldValues);$c.setAllBooleanValues(n,this._initFieldValues);$c.setAllNumericBoxValues(n,this._initFieldValues);$c.setAllDateTimePickersValues(n,this._initFieldValues);$c.setAllRadioListValues(n,this._initFieldValues);$c.initAllCheckboxToggles(n);$c.initAllSwitcherLists(n);$c.makeReadonlySimpleTextBoxes(n,this._disabledFields);$c.makeReadonlyBooleans(n,this._disabledFields);$c.makeReadonlyNumericBox(n,this._disabledFields);$c.makeReadonlyDateTimePickers(n,this._disabledFields);$c.makeReadonlyFileFields(n,this._disabledFields);$c.makeReadonlyRadioList(n,this._disabledFields);$c.setAllEntityDataListValues(n,this._initFieldValues);$c.fixAllEntityDataListsOverflow(n);$c.makeReadonlyEntityDataList(n,this._disabledFields);$c.setFieldRowsVisibility(n,this._hideFields,!1);this._customInit&&this._customInit(this._parentEditor,n);t=this;this._customButtonsSettings&&jQuery.each(this._customButtonsSettings,function(i,r){t._parentEditor.addCustomButton(r,n)});this._customLinkButtonsSettings&&jQuery.each(this._customLinkButtonsSettings,function(i,r){t._parentEditor.addCustomLinkButton(r,n)});n=null},set_initFieldValues:function(n){this._initFieldValues=n},set_disableChangeTracking:function(n){this._disableChangeTracking=n},_disposeAllFields:function(){var n=this._$articleWrapper;this._customDispose&&this._customDispose(this._parentEditor,n);$c.destroyAllCheckboxToggles(n);$c.destroyAllSwitcherLists(n);$c.destroyAllDateTimePickers(n);$c.destroyAllVisualEditors(n);$c.destroyAllNumericTextBoxes(n);$c.destroyAllFileFields(n);$c.destroyAllEntityDataLists(n);$c.destroyAllEntityDataTrees(n);$c.destroyAllAggregationLists(n);$c.destroyAllHighlightedTextAreas(n);Quantumart.QP8.BackendExpandedContainer.destroyAll(n);n=null},dispose:function(){this._customInit=null;this._customDispose=null;this._parentEditor=null;this._$contentList&&(this._$contentList.off(),this._$contentList=null);this._$articleWrapper=null;this._$componentElem&&(this._$componentElem.removeData(),this._$componentElem=null)}};Quantumart.QP8.BackendClassifierField.registerClass("Quantumart.QP8.BackendClassifierField",Quantumart.QP8.Observable);