Quantumart.QP8.BackendAggregationList=function(n){this._componentElem=n;this._containerElem=jQuery(".aggregationListContainer",n);this._resultElem=jQuery(".aggregationListResult",n)};Quantumart.QP8.BackendAggregationList.DATA_KEY_COMPONENT="aggregation_list_component";Quantumart.QP8.BackendAggregationList.getComponent=function(n){if(n)return $q.toJQuery(n).data(Quantumart.QP8.BackendAggregationList.DATA_KEY_COMPONENT)};Quantumart.QP8.BackendAggregationList.prototype={_componentElem:null,_resultElem:null,_containerElem:null,_items:null,_fields:null,_addItemHandler:null,_removeItemHandler:null,_tableHeader:null,_tableBody:null,_additionalNames:null,_viewModel:null,initialize:function(){var n=this._componentElem,r,u,i,t;jQuery(n).data(Quantumart.QP8.BackendAggregationList.DATA_KEY_COMPONENT,this);r=this._resultElem;u=this._containerElem;this._items=ko.observableArray(n.data("aggregation_list_data"));this._fields=n.data("aggregation_list_item_fields").split(",");this._addItemHandler=jQuery.proxy(this.addItem,this);this._removeItemHandler=jQuery.proxy(this.removeItem,this);n.data("additional_names")!=undefined&&(this._additionalNames=n.data("additional_names").split(","));this._viewModel={items:this._items,addItem:this._addItemHandler,removeItem:this._removeItemHandler,onItemChanged:jQuery.proxy(this._onItemChanged,this)};for(i in this._additionalNames)t=this._additionalNames[i],this._viewModel[t]=ko.observableArray(n.data("additional_"+t).split(","));ko.applyBindingsToNode(this._containerElem.get(0),{template:{name:n.attr("id").replace("_aggregationlist","_template")}},this._viewModel);this._tableHeader=jQuery("thead",this._componentElem);this._tableBody=jQuery("tbody",this._componentElem);this.checkHeaders();this._componentElem.data("component",this)},get_items:function(){return this._items()},set_items:function(n){if(this._items()&&(this._items.removeAll(),!$q.isNullOrEmpty(n)&&$q.isArray(n))){var t=this;jQuery.each(n,function(){t._items.push(jQuery.extend({},this))})}},addItem:function(){var n={};for(var t in this._fields)n[this._fields[t]]="";n.Invalid=!1;this._items.push(n);this._setAsChanged();this.checkHeaders()},removeItem:function(n){this._items.remove(n);this._setAsChanged();this.checkHeaders()},_onItemChanged:function(){return this._setAsChanged(),!0},_setAsChanged:function(){var n=jQuery(this._resultElem),t;n.addClass(CHANGED_FIELD_CLASS_NAME);t=jQuery(this._componentElem).data("field_name");n.trigger(JQ_CUSTOM_EVENT_ON_FIELD_CHANGED,{fieldName:t,value:this._items()});n=null},checkHeaders:function(){this._tableBody.children("tr").size()==0?this._tableHeader.hide():this._tableHeader.show()},saveAggregationListData:function(){var n=this._componentElem;this._resultElem.val(JSON.stringify(n.data("aggregation_list_data")))},destroyAggregationList:function(){var n=this._containerElem;ko.cleanNode(n.get(0));this._componentElem&&(jQuery(this._componentElem).removeData(Quantumart.QP8.BackendAggregationList.DATA_KEY_COMPONENT),this._componentElem=null);this._containerElem=null;this._resultElem=null;this._items=null;this._fields=null;this._addItemHandler=null;this._removeItemHandler=null;this._tableHeader=null;this._tableBody=null;this._viewModel=null}};