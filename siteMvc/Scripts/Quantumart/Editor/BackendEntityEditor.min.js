var EVENT_TYPE_ENTITY_EDITOR_ENTITY_SUBMITTING="OnEntityEditorSubmitting",EVENT_TYPE_ENTITY_EDITOR_ENTITY_SUBMITTED="OnEntityEditorSubmitted",EVENT_TYPE_ENTITY_EDITOR_ENTITY_SUBMITTED_ERROR="OnEntityEditorSubmittedError",EVENT_TYPE_ENTITY_EDITOR_ENTITY_REFRESH_STARTING="OnEntityEditorRefreshStarting",EVENT_TYPE_ENTITY_EDITOR_ACTION_EXECUTING="OnEntityEditorActionExecuting";Quantumart.QP8.BackendEntityEditor=function(n,t,i,r,u,f){Quantumart.QP8.BackendEntityEditor.initializeBase(this);this._editorGroupCode=n;this._entityTypeCode=i;this._entityId=r;this._parentEntityId=f.parentEntityId;this._acionCode=f.actionCode;this._actionTypeCode=u;this._documentWrapperElementId=t;$q.isNull(f)||(f.formElementId&&(this._formElementId=f.formElementId),f.validationSummaryElementId&&(this._validationSummaryElementId=f.validationSummaryElementId),f.isWindow&&(this._hostIsWindow=f.isWindow),f.initFieldValues&&(this._initFieldValues=f.initFieldValues),f.disabledFields&&(this._disabledFields=f.disabledFields),f.hideFields&&(this._hideFields=f.hideFields),f.restoring===!0&&(this._restoring=!0),f.modifiedDateTime&&(this._modifiedDateTime=f.modifiedDateTime),f.contextQuery&&(this._contextBlockState=JSON.parse(f.contextQuery)),f.needUp&&(this._needUp=f.needUp),f.customButtonsSettings&&(this._customButtonsSettings=f.customButtonsSettings),f.customLinkButtonsSettings&&(this._customLinkButtonsSettings=f.customLinkButtonsSettings),f.notifyCustomButtonExistence===!1&&(this._notifyCustomButtonExistence=f.notifyCustomButtonExistence),f.customHandlers&&(f.customHandlers.beforeSubmit&&(this._customBeforeSubmit=f.customHandlers.beforeSubmit),f.customHandlers.init&&(this._customInit=f.customHandlers.init),f.customHandlers.load&&(this._customLoad=f.customHandlers.load),f.customHandlers.dispose&&(this._customDispose=f.customHandlers.dispose),f.customHandlers.fieldValueChanged&&(this._customFieldValueChanged=f.customHandlers.fieldValueChanged)),this._entityTypeAllowedToAutosave=$q.toBoolean(f.entityTypeAllowedToAutosave,!1),this._isBindToExternal=$q.toBoolean(f.isBindToExternal,!1));this._onActionExecutingHandler=jQuery.proxy(this._onActionExecuting,this);this._onHtmlInputChangedHandler=jQuery.proxy(this._onHtmlInputChanged,this);this._onBeforeSubmitHandler=jQuery.proxy(this._onBeforeSubmit,this);this._onSuccessHandler=jQuery.proxy(this._onSuccess,this);this._onErrorHandler=jQuery.proxy(this._onError,this);this._onLibraryFilesUploadedHandler=jQuery.proxy(this._onFileUploaded,this);this._customButtons=[];this._customLinkButtons=[];jQuery("#"+this._documentWrapperElementId).data(Quantumart.QP8.BackendEntityEditor.componentRefDataKey,this)};Quantumart.QP8.BackendEntityEditor.componentRefDataKey="component_ref";Quantumart.QP8.BackendEntityEditor.getComponent=function(n){return jQuery(n).data(Quantumart.QP8.BackendEntityEditor.componentRefDataKey)};Quantumart.QP8.BackendEntityEditor.prototype={_editorGroupCode:"",_entityTypeCode:"",_entityId:0,_parentEntityId:0,_acionCode:"",_actionTypeCode:"",_documentWrapperElementId:"",_formElementId:"",_formElement:null,_validationSummaryElementId:"",_validationSummaryElement:null,_formHasErrors:!1,_editorManagerComponent:null,_hostIsWindow:!1,_initFieldValues:null,_disabledFields:null,_hideFields:null,_restoring:!1,_contextBlockState:null,_variationsModel:null,_errorModel:null,_variationsModelChanged:!1,_contextModel:null,_disableChangeTracking:!1,_needUp:!1,_modifiedDateTime:null,_isBindToExternal:!1,_entityTypeAllowedToAutosave:!1,_customBeforeSubmit:null,_customInit:null,_customDispose:null,_customFieldValueChanged:null,_customLoad:null,_notifyCustomButtonExistence:!0,_customButtons:null,_customLinkButtons:null,_customButtonsSettings:null,_customLinkButtonsSettings:null,FIELD_SELECTORS:":input",FIELD_VALUE_SELECTORS:":input[name ^= 'field_']",FIELD_CHANGE_TRACK_SELECTORS:":input:not(.qp-notChangeTrack)",CHANGED_FIELD_SELECTOR:".changed",CHANGED_EXCEPT_VARMODEL_SELECTOR:".changed:not(.variationModel)",REAL_CHANGED_FIELD_SELECTOR:"."+CHANGED_FIELD_CLASS_NAME+":not(."+REFRESHED_FIELD_CLASS_NAME+")",REAL_CHANGED_EXCEPT_VARMODEL_SELECTOR:"."+CHANGED_FIELD_CLASS_NAME+":not(."+REFRESHED_FIELD_CLASS_NAME+"):not(.variationModel)",CONTEXT_SELECTOR:".currentContext",CONTEXT_MODEL_SELECTOR:".contextModel",VARIATION_SELECTOR:".variationModel",VARIATION_INFO_SELECTOR:".variationInfo",ERROR_SELECTOR:".errorModel",OLD_CONTEXT_DATA_KEY:"oldContext",get_editorGroupCode:function(){return this._editorGroupCode},set_editorGroupCode:function(n){this._editorGroupCode=n},get_documentWrapperElementId:function(){return this._documentWrapperElementId},set_documentWrapperElementId:function(n){this._documentWrapperElementId=n},get_entityTypeCode:function(){return this._entityTypeCode},set_entityTypeCode:function(n){this._entityTypeCode=n},get_entityId:function(){return this._entityId},set_entityId:function(n){this._entityId=n},get_actionTypeCode:function(){return this._actionTypeCode},set_actionTypeCode:function(n){this._actionTypeCode=n},get_formElementId:function(){return this._formElementId},set_formElementId:function(n){this._formElementId=n},get_validationSummaryElementId:function(){return this._validationSummaryElementId},set_validationSummaryElementId:function(n){this._validationSummaryElementId=n},get_editorManagerComponent:function(){return this._editorManagerComponent},set_editorManagerComponent:function(n){this._editorManagerComponent=n},get_fieldValues:function(){return $c.getAllFieldValues(this._formElement)},get_disabledFields:function(){return this._disabledFields},get_hideFields:function(){return this._hideFields},get_parentEntityId:function(){return this._parentEntityId},get_actionCode:function(){return this._acionCode},get_modifiedDateTime:function(){return this._modifiedDateTime},get_contextQuery:function(){return this._contextBlockState?JSON.stringify(this._contextBlockState):""},allowAutoSave:function(){return this._entityTypeAllowedToAutosave&&!this._isBindToExternal},_onHtmlInputChangedHandler:null,_onActionExecutingHandler:null,_onLibraryFilesUploadedHandler:null,initialize:function(){var n,t,i;this._needUp||(n=null,t=this._formElementId,$q.isNullOrWhiteSpace(t)&&(n=jQuery("#"+this._documentWrapperElementId+" FORM:first"),t=n.attr("id")),this._isBindToExternal===!0,n.ajaxForm({beforeSubmit:this._onBeforeSubmitHandler,success:this._onSuccessHandler,error:this._onErrorHandler,iframe:!1}),this._formElementId=t,this._formElement=n.get(0),n=null,$q.isNullOrWhiteSpace(this._validationSummaryElementId)||(i=jQuery("#"+this._validationSummaryElementId),this._formHasErrors=i.length>0&&i.find("UL").length>0,i=null),this._formHasErrors&&(this._initFieldValues=null),this._initAllFields(),this._initAllFieldDescriptons())},getFields:function(){return jQuery(this._formElement).find(this.FIELD_SELECTORS)},_initAllFields:function(){var n,t;if(this._formElement){n=jQuery(this._formElement);$c.initAllClassifierFields(n,this._onActionExecutingHandler,{hostIsWindow:this._hostIsWindow,initFieldValues:this._initFieldValues,disabledFields:this._disabledFields,hideFields:this._hideFields,customInit:this._customInit,customDispose:this._customDispose,parentEditor:this,customButtonsSettings:this._customButtonsSettings,customLinkButtonsSettings:this._customLinkButtonsSettings},jQuery.proxy(function(n,t,i){if(this.notify(n,i),i.toggleDisableChangeTracking)n===EVENT_TYPE_CLASSIFIER_FIELD_ARTICLE_UNLOADING?this._disableChangeTracking=!0:n===EVENT_TYPE_CLASSIFIER_FIELD_ARTICLE_LOADED&&(this._disableChangeTracking=!1);else if(n===EVENT_TYPE_CLASSIFIER_FIELD_ARTICLE_LOADED&&this._editorManagerComponent)this._editorManagerComponent.onAllFieldInvalidate(this._documentWrapperElementId)},this));$c.setAllVisualEditorValues(n,this._initFieldValues);$c.makeReadonlyVisualEditors(n,this._disabledFields);$c.initAllDateTimePickers(n);$c.initAllVisualEditors(n);$c.initAllNumericTextBoxes(n);$c.initAllFileFields(n,this._onLibraryFilesUploadedHandler);$c.initAllEntityDataLists(n,this._onActionExecutingHandler,{hostIsWindow:this._hostIsWindow});$c.initAllEntityDataTrees(n);$c.initAllAggregationLists(n);$c.initAllWorkflows(n);n.on("change paste",this.FIELD_CHANGE_TRACK_SELECTORS,this._onHtmlInputChangedHandler).on(JQ_CUSTOM_EVENT_ON_FIELD_CHANGED,this.CHANGED_FIELD_SELECTOR,jQuery.proxy(this._onFieldValueChanged,this));$c.setAllSimpleTextBoxValues(n,this._initFieldValues);$c.setAllBooleanValues(n,this._initFieldValues);$c.setAllNumericBoxValues(n,this._initFieldValues);$c.setAllDateTimePickersValues(n,this._initFieldValues);$c.setAllRadioListValues(n,this._initFieldValues);$c.setAllAggregationListValues(n,this._initFieldValues);$c.initAllCheckboxToggles(n);$c.initAllSwitcherLists(n);$c.makeReadonlySimpleTextBoxes(n,this._disabledFields);$c.makeReadonlyBooleans(n,this._disabledFields);$c.makeReadonlyNumericBox(n,this._disabledFields);$c.makeReadonlyDateTimePickers(n,this._disabledFields);$c.makeReadonlyFileFields(n,this._disabledFields);$c.makeReadonlyRadioList(n,this._disabledFields);this._initVariationsModelField(n);this._initVariationInfo(n);this._initContextModelField(n);this._initErrorModelField(n);this._customInit&&this._customInit(this,n);t=this;this._customButtonsSettings&&jQuery.each(this._customButtonsSettings,function(n,i){t.addCustomButton(i)});this._customLinkButtonsSettings&&jQuery.each(this._customLinkButtonsSettings,function(n,i){t.addCustomLinkButton(i)});n=null}},_initAllFieldDescriptons:function(){jQuery("span[data-field_description_text]",this._formElement).qtip({style:"qtip-light",content:{attr:"data-field_description_text"},hide:{fixed:!0,delay:300},show:{solo:!0,event:"click",delay:0}})},_disposeAllFieldDescriptons:function(){jQuery("span[data-tooltip]").qtip("destroy",!0)},_disposeAllFields:function(){if(this._formElement&&!this._needUp){var n=jQuery(this._formElement);this._customDispose&&this._customDispose(this,n);$c.destroyAllCheckboxToggles(n);$c.destroyAllSwitcherLists(n);$c.destroyAllDateTimePickers(n);$c.destroyAllVisualEditors(n);$c.destroyAllNumericTextBoxes(n);$c.destroyAllFileFields(n);$c.destroyAllEntityDataLists(n);$c.destroyAllEntityDataTrees(n);$c.destroyAllAggregationLists(n);$c.destroyAllHighlightedTextAreas(n);Quantumart.QP8.BackendExpandedContainer.destroyAll(n);$c.destroyAllClassifierFields(n);n.off("change paste",this.FIELD_CHANGE_TRACK_SELECTORS).off(JQ_CUSTOM_EVENT_ON_FIELD_CHANGED,this.CHANGED_FIELD_SELECTOR);this._disposeContextModelField(n);this._disposeVariationInfo(n);this._disposeVariationsModelField(n);this._disposeErrorModelField(n);n=null}},_initVariationsModelField:function(n){var i=jQuery(this.VARIATION_SELECTOR,n),t;i.length==1&&(t={},jQuery.each(JSON.parse(i.val()),function(){t[this.Context]={Id:this.Id,FieldValues:this.FieldValues}}),this._variationsModel=t,this._variationsModelChanged=!1)},_disposeVariationsModelField:function(){this._variationsModel=null},_initVariationInfo:function(n){var t=jQuery(this.VARIATION_INFO_SELECTOR,n);t.find(".removeVariation").on("click",jQuery.proxy(this._onRemoveVariation,this));t.find(".currentInfo").html($l.EntityEditor.baseArticle);t.find(".currentTotal").html(this._getVariationModelCount())},_disposeVariationInfo:function(n){var t=jQuery(this.VARIATION_INFO_SELECTOR,n);t.find(".removeVariation").off("click")},_onRemoveVariation:function(){var t=jQuery(this._formElement),n=jQuery(this.CONTEXT_SELECTOR,t).val();$q.removeProperty(this._variationsModel,n);this._variationsModelChanged=!0;this._saveVariationsModelData(t);this._restoreFromVariationsModel(n);this._updateVariationInfo(n)},_updateVariationInfo:function(n){var t=this._variationsModel[n],r=!!t&&!!n,f=t&&t.Id===0,i=jQuery(this.VARIATION_INFO_SELECTOR,this._formElement),u="";u=n==""?$l.EntityEditor.baseArticle:r?f?$l.EntityEditor.newVariationExists:String.format($l.EntityEditor.variationExists,t.Id):$l.EntityEditor.variationNotExists;i.find(".currentInfo").html(u);i.find(".currentTotal").html(this._getVariationModelCount());i.find(".removeItem").toggle(r)},_getVariationModelCount:function(){var n=0;for(k in this._variationsModel)k&&this._variationsModel.hasOwnProperty(k)&&n++;return n},_initContextModelField:function(n){var t=jQuery(this.CONTEXT_MODEL_SELECTOR,n);t.length==1&&(this._contextModel=JSON.parse(t.val()))},_disposeContextModelField:function(){this._contextModel=null},_initErrorModelField:function(n){var i=jQuery(this.ERROR_SELECTOR,n),t;i.length==1&&(t={},jQuery.each(JSON.parse(i.val()),function(){t[this.Context]=this.Errors}),this._errorModel=t)},_disposeErrorModelField:function(){this._errorModel=null},_saveVariationsModelData:function(n){var t,i,r,u;if(this._variationsModelChanged&&(t=jQuery(this.VARIATION_SELECTOR,n),t.length==1)){i=[];for(r in this._variationsModel)u=this._variationsModel[r],i.push({Context:r,Id:u.Id,FieldValues:u.FieldValues});t.val(JSON.stringify(i)).change();this._variationsModelChanged=!1}},_copyCurrentDataToVariationsModel:function(n){var t=jQuery(this.CONTEXT_SELECTOR,n);t.length==1&&($c.saveDataOfAllVisualEditors(this._formElement),this._copyToVariationsModel(t.val()))},isFieldsValid:function(){return!this._formHasErrors},isFieldsChanged:function(){var n=jQuery(this._formElement).find(this.REAL_CHANGED_FIELD_SELECTOR);return n.length>0},isFieldValuesChanged:function(){var n=jQuery(this._formElement).find(this.VARIATION_SELECTOR).closest("fieldset").find(this.REAL_CHANGED_EXCEPT_VARMODEL_SELECTOR);return n.length>0},addCustomButton:function(n,t){var s,e,i,o,h,r,u,f,c;if(n.name||n.onClick||n.suffix||n.title){if(s={"class":"customButton"},n=jQuery.extend(s,n),e=t||jQuery(this._formElement),i=e.find("[name='"+n.name+"']"),i.length==0){this._notifyCustomButtonExistence&&alert("Input "+n.name+" is not found");return}if(o=i.data("exact_type"),h=[FILE_FIELD_TYPE,IMAGE_FIELD_TYPE],!o&&(i.prop("type")!="text"||i.parents(".t-numerictextbox").length>0)||jQuery.inArray(o,h)==-1){alert("Input "+n.name+" type is not supported");return}if(r=i.parent(".fieldWrapper"),r.length==0&&(i.wrap($("<div/>",{id:i.prop("id")+"_wrapper","class":"fieldWrapper group myClass"})),r=i.parent(".fieldWrapper")),u={id:i.prop("id")+"_"+n.suffix,"class":n["class"],title:n.title},r.find("#"+u.id).length>0){this._notifyCustomButtonExistence&&alert("Button "+u.id+" already exists");return}f=$("<div/>",u);f.append($("<img/>",{src:"/Backend/Content/Common/0.gif"}));n.url&&f.css({"background-image":"url("+n.url+")","background-color":"transparent"});r.append(f);c=function(){n.onClick.call(this,i,e)};f.on("click",{$input:i,$form:e,settings:n},n.onClick);this._customButtons.push(u.id)}else alert("One of the required settings is missed: name, title, suffix, onClick")},addCustomLinkButton:function(n,t){var s,i,h,c,u,f,r,o,e,l;if(n.name||n.onClick||n.suffix||n.title){if(s={"class":"pick"},n=jQuery.extend(s,n),$form=t||jQuery(this._formElement),i=$form.find("[name='"+n.name+"']"),i.length==0){this._notifyCustomButtonExistence&&alert("Input "+n.name+" is not found");return}if(h=i.data("exact_type"),c=[STRING_FIELD_TYPE,FILE_FIELD_TYPE,IMAGE_FIELD_TYPE,TEXTBOX_FIELD_TYPE,VISUAL_EDIT_FIELD_TYPE],jQuery.inArray(h,c)==-1){alert("Input "+n.name+" type is not supported");return}if(u=i.parent(".fieldWrapper"),u.length==0&&(i.wrap($("<div/>",{"class":"fieldWrapper group myClass"})),u=i.parent(".fieldWrapper")),f=u.find("ul.linkButtons"),f.length==0&&(u.prepend('<ul class="linkButtons group" style="display: block;" />'),f=u.find("ul.linkButtons")),r={id:i.prop("id")+"_"+n.suffix,"class":n["class"],title:n.title},f.find("#"+r.id).length>0){this._notifyCustomButtonExistence&&alert("Button "+r.id+" already exists");return}o=new $.telerik.stringBuilder;o.cat('<li><span id="'+r.id+'" class="linkButton actionLink">').cat('<a href="javascript:void(0);">').cat('<span class="icon '+r["class"]+'"><img src="/Backend/Content/Common/0.gif"><\/span>').cat('<span class="text">'+r.title+"<\/span>").cat("<\/a><\/span><\/li>");e=jQuery(o.string());n.url&&e.find(".icon").css({"background-image":"url("+n.url+")"});f.append(e);l=function(){n.onClick.call(this,i,$form)};e.find("a").on("click",{$input:i,$form:$form,settings:n},n.onClick);this._customLinkButtons.push(r.id)}else alert("One of the required settings is missed: name, title, suffix, onClick")},saveEntity:function(n){if($c.saveDataOfAllVisualEditors(this._formElement),$c.SaveDataOfAllHighlightedTextAreas(this._formElement),$c.saveDataOfAllAggregationLists(this._formElement),$c.saveDataOfAllWorkflows(this._formElement),this._entityTypeCode!==ENTITY_TYPE_CODE_ARTICLE_VERSION&&!this.isFieldsChanged())return alert($l.EntityEditor.fieldsNotChangedMessage),!1;this._copyCurrentDataToVariationsModel(t);this._saveVariationsModelData(t);var t=jQuery(this._formElement);t.find('input[name="'+BACKEND_ACTION_CODE_HIDDEN_NAME+'"]').val(n);t.trigger("submit")},refreshEditor:function(n){var i=n&&n.confirmMessageText?n.confirmMessageText:$l.EntityEditor.autoRefreshConfirmMessage,t;this._confirmAction(i)&&(t=new Quantumart.QP8.BackendEventArgs,this.notify(EVENT_TYPE_ENTITY_EDITOR_ENTITY_REFRESH_STARTING,t),t=null)},fixEntityDataListsOverflow:function(){if(this._formElement){var n=jQuery(this._formElement);$c.fixAllEntityDataListsOverflow(n);n=null}},fixHtaInitializing:function(){if(this._formElement){var n=jQuery(this._formElement);$c._refreshAllHta(n);n=null}},confirmRefresh:function(){return this._confirmAction($l.EntityEditor.refreshConfirmMessage)},confirmChange:function(){return this._confirmAction($l.EntityEditor.changeConfirmMessage)},confirmClose:function(){return this._confirmAction($l.EntityEditor.closeConfirmMessage)},_confirmAction:function(n){return!this.isFieldsChanged()||confirm(n)},onLoad:function(){var n=jQuery(this._formElement),t;$c.setAllEntityDataListValues(n,this._initFieldValues);this.fixEntityDataListsOverflow();$c.makeReadonlyEntityDataList(n,this._disabledFields);$c.setAllClassifierFieldValues(n,this._initFieldValues);$c.makeReadonlyClassifierFields(n,this._disabledFields);$c.initAllHighlightedTextAreas(n);$c.setAllHighlightedTextAreaValues(n,this._initFieldValues);Quantumart.QP8.BackendExpandedContainer.initAll(n);$c.setFieldRowsVisibility(n,this._hideFields,!1);this._customLoad&&this._customLoad(n);this._contextBlockState&&this.applyContext(this._contextBlockState);this._initFieldValues=null;t=jQuery("#"+this._documentWrapperElementId);t.scrollTop(this._formHasErrors?0:$q.toInt(t.data("scroll_position"),0));t=null;n=null;this._editorManagerComponent.onEntityEditorReady(this._documentWrapperElementId)},onSelect:function(){this.fixEntityDataListsOverflow();this.fixHtaInitializing()},_onActionExecuting:function(n,t,i){this.notify(EVENT_TYPE_ENTITY_EDITOR_ACTION_EXECUTING,i)},_onHtmlInputChanged:function(n){var t,i;this._disableChangeTracking||(t=jQuery(n.currentTarget),t.addClass(CHANGED_FIELD_CLASS_NAME),t.removeClass(REFRESHED_FIELD_CLASS_NAME),i=t.is(":checkbox")?t.is(":checked"):t.val(),t.trigger(JQ_CUSTOM_EVENT_ON_FIELD_CHANGED,{fieldName:t.attr("name"),value:i}),t=null)},_onFieldValueChanged:function(n,t){if(!this._disableChangeTracking&&t&&t.fieldName){this._customFieldValueChanged&&this._customFieldValueChanged(this,t);this._editorManagerComponent.onFieldValueChanged(jQuery.extend({documentWrapperElementId:this._documentWrapperElementId},t))}},_onBeforeSubmit:function(){var n=jQuery("#"+this._documentWrapperElementId),t;return(n.data("scroll_position",n.scrollTop()),n=null,this._customBeforeSubmit&&!this._customBeforeSubmit(this))?!1:(t=new Quantumart.QP8.BackendEntityEditorActionEventArgs,this.notify(EVENT_TYPE_ENTITY_EDITOR_ENTITY_SUBMITTING,t),t=null,!0)},_onSuccess:function(n){var t=new Quantumart.QP8.BackendEntityEditorActionEventArgs;t.set_data(n);this.notify(EVENT_TYPE_ENTITY_EDITOR_ENTITY_SUBMITTED,t);t=null},_onError:function(n){$q.processGenericAjaxError(n);var t=new Quantumart.QP8.BackendEntityEditorActionEventArgs;this.notify(EVENT_TYPE_ENTITY_EDITOR_ENTITY_SUBMITTED_ERROR,t);t=null},_onFileUploaded:function(n,t,i){this.notify(EVENT_TYPE_LIBRARY_ALL_FILES_UPLOADED,i)},_onChangeContext:function(){var n=jQuery(this._formElement),i=n.data(this.OLD_CONTEXT_DATA_KEY),t=jQuery(this.CONTEXT_SELECTOR,n).val();i!=t&&(typeof i!="undefined"&&(this._copyToVariationsModel(i),this._saveVariationsModelData(n)),this._initFieldValues==null&&this._restoreFromVariationsModel(t),this._updateVariationInfo(t),n.data(this.OLD_CONTEXT_DATA_KEY,t))},_copyToVariationsModel:function(n){if(this.isFieldValuesChanged()){var t={};jQuery.each(this.get_fieldValues(),function(){this.fieldName.match(/^field_[\d]+$/)&&(t[this.fieldName]=this.value===null?"":this.value+"")});this._variationsModel[n]||(this._variationsModel[n]={Id:0});this._variationsModel[n].FieldValues=t;this._variationsModelChanged=!0}},_getActualContext:function(n){var t,i,u;if(this._contextModel&&this._variationsModel){if(n in this._variationsModel)return n;for(t=n.split(","),i=!1;!i&&t.length>0;){var r=t.length-1,e=t[r],f=this._contextModel[r].Ids[e];f=="0"?t.length--:t[r]=f;u=t.join();i=u in this._variationsModel}return u}return""},_restoreFromVariationsModel:function(n){var t;this._disableChangeTracking=!0;var r=this._getActualContext(n),f=this._variationsModel[r].FieldValues,u=this._errorModel[r],i=[];jQuery.each(f,function(n,t){var r={fieldName:n,value:t};$q.isNullOrEmpty(u)||(r.errors=jQuery.grep(u,function(t){return t.Name==n}));i.push(r)});t=jQuery(this._formElement);$c.setAllEntityDataListValues(t,i);this.fixEntityDataListsOverflow();$c.setAllClassifierFieldValues(t,i,!0);$c.setAllVisualEditorValues(t,i);$c.setAllSimpleTextBoxValues(t,i);$c.setAllBooleanValues(t,i);$c.setAllNumericBoxValues(t,i);$c.setAllDateTimePickersValues(t,i);$c.setAllRadioListValues(t,i);$c.setAllAggregationListValues(t,i);this._disableChangeTracking=!1;jQuery(this.VARIATION_SELECTOR,t).closest("fieldset").find(this.CHANGED_EXCEPT_VARMODEL_SELECTOR).removeClass(CHANGED_FIELD_CLASS_NAME)},applyContext:function(n){this._contextBlockState=n;var t=[];jQuery.each(n,function(){this.Value&&t.push(this.Value)});jQuery(this.CONTEXT_SELECTOR,this._formElement).val(t.join());this._onChangeContext()},dispose:function(){if(Quantumart.QP8.BackendEntityEditor.callBaseMethod(this,"dispose"),this._disposeAllFieldDescriptons(),this._disposeAllFields(),this._editorManagerComponent){var n=this._editorCode;$q.isNullOrWhiteSpace(n)||this._editorManagerComponent.removeEditor(n);this._editorManagerComponent.onEntityEditorDisposed(this._documentWrapperElementId);this._editorManagerComponent=null}jQuery.each(this._customButtons,function(n,t){jQuery("#"+t).off("click")});jQuery.each(this._customLinkButtons,function(n,t){jQuery("#"+t).find("a").off("click")});jQuery("#"+this._documentWrapperElementId).removeData();this._validationSummaryElement=null;this._formElement=null;this._onActionExecutingHandler=null;this._onHtmlInputChangedHandler=null;this._onBeforeSubmitHandler=null;this._onSuccessHandler=null;this._onErrorHandler=null;$q.collectGarbageInIE()}};Quantumart.QP8.BackendEntityEditor.registerClass("Quantumart.QP8.BackendEntityEditor",Quantumart.QP8.Observable);Quantumart.QP8.BackendEntityEditorActionEventArgs=function(){Quantumart.QP8.BackendEntityEditorActionEventArgs.initializeBase(this)};Quantumart.QP8.BackendEntityEditorActionEventArgs.prototype={_data:null,get_data:function(){return this._data},set_data:function(n){this._data=n}};Quantumart.QP8.BackendEntityEditorActionEventArgs.registerClass("Quantumart.QP8.BackendEntityEditorActionEventArgs",Quantumart.QP8.BackendEventArgs);