Quantumart.QP8.BackendHighlightedTextArea=function(n){this._componentElem=n};Quantumart.QP8.BackendHighlightedTextArea.prototype={_selectPopupWindowComponent:null,_libraryButton:null,_restoreButton:null,_insertButton:null,_insertPopUp:null,_onLibraryButtonClickHandler:null,_onRestoreButtonClickHandler:null,_onInsertButtonClickHandler:null,_onInsertCallHandler:null,_libraryEntityId:0,_libraryParentEntityId:0,_templateId:null,_formatId:null,_netLanguageId:null,_presentationOrCodeBehind:!1,_insertWindowInitialized:!1,_insertWindowHtml:null,_insertWindowComponent:null,_storedTempValue:"",_checkIntervalID:null,_editorWidth:null,_editorHeight:null,_openLibrary:function(){var n=new Quantumart.QP8.BackendEventArgs,t;n.set_entityId(this._libraryEntityId);n.set_parentEntityId(this._libraryParentEntityId);n.set_entityName("");n.set_entityTypeCode(ENTITY_TYPE_CODE_SITE);n.set_actionCode(ACTION_CODE_POPUP_SITE_LIBRARY);this._selectPopupWindowComponent||(t={isMultiOpen:!0,additionalUrlParameters:{filterFileTypeId:"",allowUpload:!0}},this._selectPopupWindowComponent=new Quantumart.QP8.BackendSelectPopupWindow(n,t),this._selectPopupWindowComponent.attachObserver(EVENT_TYPE_SELECT_POPUP_WINDOW_RESULT_SELECTED,jQuery.proxy(this._librarySelectedHandler,this)),this._selectPopupWindowComponent.attachObserver(EVENT_TYPE_SELECT_POPUP_WINDOW_CLOSED,jQuery.proxy(this._libraryClosedHandler,this)));this._selectPopupWindowComponent.openWindow();n=null;t=null},_closeLibrary:function(){this._selectPopupWindowComponent.closeWindow()},_destroyLibrary:function(){this._selectPopupWindowComponent&&(this._selectPopupWindowComponent.detachObserver(EVENT_TYPE_SELECT_POPUP_WINDOW_RESULT_SELECTED),this._selectPopupWindowComponent.detachObserver(EVENT_TYPE_SELECT_POPUP_WINDOW_CLOSED),this._selectPopupWindowComponent.dispose(),this._selectPopupWindowComponent=null)},_libraryClosedHandler:function(){this._closeLibrary()},_librarySelectedHandler:function(n,t,i){if(this._closeLibrary(),i){var r=jQuery("#"+this._selectPopupWindowComponent._popupWindowId+"_Library").find(".l-virtual-path").text(),u=i.entities;u.length>0&&(r=r+u[0].Name,jQuery.proxy(this._insertLibraryTag(r),this))}},_onCheckChangesIntervalHandler:function(){if(!$q.isNull(this._componentElem.data("codeMirror"))){var n=this._componentElem.data("codeMirror").getValue();this._storedTempValue!==n&&(this._storedTempValue=n,this._componentElem.addClass(CHANGED_FIELD_CLASS_NAME),this._componentElem.trigger(JQ_CUSTOM_EVENT_ON_FIELD_CHANGED,{fieldName:this._componentElem.attr("name"),value:this._componentElem.data("codeMirror").getValue()}))}},_insertLibraryTag:function(n){var t=this._componentElem.data("codeMirror").getCursor("start"),i=this._componentElem.data("codeMirror").getCursor("end");i.line==t.line&&i.ch==t.ch?this._componentElem.data("codeMirror").replaceRange(this._generateTag(n),t):this._componentElem.data("codeMirror").replaceRange(this._generateTag(n),t,i);this._componentElem.addClass(CHANGED_FIELD_CLASS_NAME)},_insertCallText:function(n){var t=this._componentElem.data("codeMirror").getCursor("start"),i=this._componentElem.data("codeMirror").getCursor("end");i.line==t.line&&i.ch==t.ch?this._componentElem.data("codeMirror").replaceRange(n,t):this._componentElem.data("codeMirror").replaceRange(n,t,i);this._insertWindowComponent.close()},_generateTag:function(n){return n.endsWith(".gif")||n.endsWith(".jpg")||n.endsWith(".jpeg")||n.endsWith(".png")||n.endsWith(".bmp")?$.telerik.formatString('<img src="{0}"/>',n):n.endsWith(".js")?$.telerik.formatString('<script language="JavaScript" src="{0}" type="text/javascript"><\/script>',n):n.endsWith(".swf")?$.telerik.formatString('<EMBED src="{0}" loop="false" menu="false" quality="high" TYPE="application/x-shockwave-flash" PLUGINSPAGE="http://www.macromedia.com/shockwave/download/index.cgi?P1_Prod_Version=ShockwaveFlash"><\/EMBED>',n):n.endsWith(".css")?$.telerik.formatString('<link rel="stylesheet" type="text/css" href="{0}">',n):$.telerik.formatString('<a  href="{0}">',n)},initialize:function(){var n=this._componentElem,t;this._presentationOrCodeBehind=n.data("is_presentation")=="True";this._templateId=n.data("template_id");this._formatId=n.data("format_id");this._netLanguageId=n.data("net_language");this._libraryEntityId=n.data("site_id");$q.isNull(n.data("codeMirror"))&&(this._componentElem.wrap('<div class="CodemirrorContainer">'),t=CodeMirror.fromTextArea(this._componentElem.get(0),{lineNumbers:$q.toBoolean(n.data("hta_lineNumbers"),!0),matchBrackets:$q.toBoolean(n.data("hta_matchBrackets"),!0),lineWrapping:$q.toBoolean(n.data("hta_lineWrapping"),!0),mode:this.getMode(n),readOnly:n.is("[disabled]"),tabMode:"indent"}),this.initTemplateToolbar(t),t.setSize(this._editorWidth,this._editorHeight),$q.isNull(n.data("height"))||t.setSize(null,n.data("height")),$q.isNull(n.data("width"))||t.setSize(n.data("width")),this._storedTempValue=t.getValue(),n.data("codeMirror",t),this._checkIntervalID=setInterval(jQuery.proxy(this._onCheckChangesIntervalHandler,this),1e4),t=null)},_onLibraryButtonClick:function(){this._openLibrary()},_onRestoreButtonClick:function(){$q.getJsonFromUrl("POST",CONTROLLER_URL_PAGE_TEMPLATE+(this._presentationOrCodeBehind?"GetDefaultPresentation":"GetDefaultCode"),{formatId:this._formatId},!0,!1).done(jQuery.proxy(function(n){confirm(HTA_DEFAULT_CONFIRM)&&(this._componentElem.data("codeMirror").replaceRange(n.code,{line:0,ch:0},{line:this._componentElem.data("codeMirror").lastLine()+1,ch:0}),this._componentElem.addClass(CHANGED_FIELD_CLASS_NAME))},this))},_onInsertButtonClick:function(){this._insertWindowInitialized?this._insertWindowComponent.open():(this.createInsertPopupWindow(),this._insertWindowInitialized=!0)},_onInsertCall:function(){!this._insertPopUp.data("valToInsert")==""&&(this._insertPopUp.data("valType")=="object"?this._insertObjectFunc(this._insertPopUp.data("valToInsert"),this._netLanguageId,!this._presentationOrCodeBehind):this._insertPopUp.data("valType")=="function"?this._insertFunc(this._insertPopUp.data("valToInsert"),this._netLanguageId,!this._presentationOrCodeBehind):this._insertPopUp.data("valType")=="field"&&this._insertFieldFunc(this._insertPopUp.data("valToInsert"),this._netLanguageId,!this._presentationOrCodeBehind),this._componentElem.addClass(CHANGED_FIELD_CLASS_NAME))},_insertObjectFunc:function(n,t,i){var r;r=t!=""?i?t=="2"?'ShowObject("'+n+'", Me)':'ShowObject("'+n+'", this);':'<qp:placeholder calls="'+n+'" runat="server"  />':'<%Object("'+n+'")%>';this._insertCallText(r)},_insertFunc:function(n,t,i){var r;t==""?r="<%="+n+"%>":i=="0"?r="<%# "+n+"%>":t=="1"&&(r=n);this._insertCallText(r)},_insertFieldFunc:function(n,t,i){var r='Field("'+n+'")';t=="1"&&(r=i=="0"?'Field(((DataRowView)(Container.DataItem)), "'+n+'")':'Field(Data.Rows[e.Item.ItemIndex], "'+n+'")');t=="2"&&(r=i=="0"?'Field(CType(Container.DataItem, DataRowView), "'+n+'")':'Field(Data.Rows(e.Item.ItemIndex), "'+n+'")');this._insertFunc(r,t,i)},createInsertPopupWindow:function(){this._insertWindowHtml="";$q.getJsonFromUrl("POST",CONTROLLER_URL_PAGE_TEMPLATE+"GetInsertPopUpMarkUp",{presentationOrCodeBehind:this._presentationOrCodeBehind,formatId:this._formatId,templateId:this._templateId},!0,!1).done(jQuery.proxy(function(n){this._insertWindowHtml=n.html;this._insertWindowComponent=$.telerik.window.create({title:HTA_INSERT_CALL,html:this._insertWindowHtml,modal:!0,width:700,resizable:!1,draggable:!1,actions:["Close"],effects:{list:[{name:"toggle"},{name:"property",properties:["opacity"]}],openDuration:"fast",closeDuration:"fast"}}).data("tWindow").center();this._insertPopUp=jQuery(this._insertWindowComponent.element).addClass("popupWindow");this._onInsertCallHandler=jQuery.proxy(this._onInsertCall,this);this._insertPopUp.find(".insertButton").parent("span").bind("click",this._onInsertCallHandler);this._insertPopUp.find("select").change(jQuery.proxy(function(n){jQuery(n.target).closest(".row").siblings().find("select option:first-child").attr("selected","selected");this._insertPopUp.data("valToInsert",jQuery(n.target).val());this._insertPopUp.data("valType",this.computeInsertType(jQuery(n.target)))},this))},this))},computeInsertType:function(n){var t=jQuery(n);return t.hasClass("ht-toolbar-container-selector")||t.hasClass("ht-toolbar-function-selector")?"function":t.hasClass("ht-toolbar-template-obj-selector")||t.hasClass("ht-toolbar-page-obj-selector")?"object":t.hasClass("ht-toolbar-field-selector")?"field":void 0},saveData:function(){var n=this._componentElem.data("codeMirror");n&&(this._componentElem.val()!=n.getValue()&&this._componentElem.change(),n.save())},getMode:function(){var n=this._componentElem;return n.hasClass("hta-htmlTextArea")?"application/x-aspx":n.hasClass("hta-cSharpTextArea")?"text/x-csharp":n.hasClass("hta-VBSTextArea")?"text/vbscript":n.hasClass("hta-VBTextArea")?"text/x-vb":n.hasClass("hta-XmlTextArea")?"application/xml":n.hasClass("hta-JsTextArea")?"text/javascript":n.hasClass("hta-SqlTextArea")?"text/x-sql":null},initTemplateToolbar:function(){$q.getJsonFromUrl("POST",CONTROLLER_URL_PAGE_TEMPLATE+"GetHTAToolbarMarkUp",{presentationOrCodeBehind:this._presentationOrCodeBehind,formatId:this._formatId,templateId:this._templateId},!0,!1).done(jQuery.proxy(function(n){this._componentElem.parent().prepend(n.html);this._libraryButton=this._componentElem.siblings(".codeMirrorToolbar").find(".libraryButton");this._restoreButton=this._componentElem.siblings(".codeMirrorToolbar").find(".restoreButton");this._insertButton=this._componentElem.siblings(".codeMirrorToolbar").find(".insertButton");this._libraryButton&&(this._onLibraryButtonClickHandler=jQuery.proxy(this._onLibraryButtonClick,this),this._libraryButton.bind("click",this._onLibraryButtonClickHandler));this._restoreButton&&(this._onRestoreButtonClickHandler=jQuery.proxy(this._onRestoreButtonClick,this),this._restoreButton.bind("click",this._onRestoreButtonClickHandler));this._insertButton&&(this._onInsertButtonClickHandler=jQuery.proxy(this._onInsertButtonClick,this),this._insertButton.bind("click",this._onInsertButtonClickHandler))},this))},destroy:function(){this._checkIntervalID&&clearInterval(this._checkIntervalID);this._destroyLibrary();this._componentElem=null}};