Quantumart.QP8.Backend=function(n,t){Quantumart.QP8.Backend.initializeBase(this);this._isDebugMode=n;t&&(t.currentCustomerCode&&(this._currentCustomerCode=t.currentCustomerCode),t.currentUserId&&(this._currentUserId=t.currentUserId),t.directLinkOptions&&(this._directLinkOptions=t.directLinkOptions),t.autoLoadHome&&(this._autoLoadHome=t.autoLoadHome));this._loadHandler=jQuery.proxy(this._initialize,this);this._unloadHandler=jQuery.proxy(this._dispose,this);this._errorHandler=jQuery.proxy(this._error,this);this._onResizeSplitterHandler=jQuery.proxy(this._onResizeSplitter,this);this._onDragStartSplitterHandler=jQuery.proxy(this._onDragStartSplitter,this);this._onDropSplitterHandler=jQuery.proxy(this._onDropSplitter,this);this._onEditingAreaEventHandler=jQuery.proxy(this._onEditingAreaEvent,this);this._onActionExecutingHandler=jQuery.proxy(this._onActionExecuting,this);this._onActionExecutedHandler=jQuery.proxy(this._onActionExecuted,this);this._onEntityReadedHandler=jQuery.proxy(this._onEntityReaded,this);this._onHostExternalCallerContextsUnbindedHandler=jQuery.proxy(this._onHostExternalCallerContextsUnbinded,this);jQuery(document).bind("click",function(n){n.which==2&&n.preventDefault()});jQuery(window).bind("load",this._loadHandler);window.attachEvent?jQuery(window).bind("unload",this._unloadHandler):window.onbeforeunload=this._unloadHandler};Quantumart.QP8.Backend.prototype={_isDebugMode:!1,_busy:!1,_backendActionExecutor:null,_backendSplitter:null,_backendTreeMenu:null,_backendTreeMenuContextMenuManager:null,_backendContextMenuManager:null,_backendBreadCrumbsManager:null,_backendTabStrip:null,_backendEditingArea:null,_backendPopupWindowManager:null,_backendEntityGridManager:null,_backendEntityTreeManager:null,_backendEntityEditorManager:null,_backendLibraryManager:null,_backendEntityDataListManager:null,_backendActionPermissionViewManager:null,_backendCustomActionHostManager:null,_currentCustomerCode:null,_currentUserId:null,_autoLoadHome:null,_directLinkOptions:null,_directLinkExecutor:null,_entityEditorAutoSaver:null,_loadHandler:null,_unloadHandler:null,_errorHandler:null,_onResizeSplitterHandler:null,_onEditingAreaEventHandler:null,_onActionExecutingHandler:null,_onActionExecutedHandler:null,_onEntityReadedHandler:null,_onHostExternalCallerContextsUnbindedHandler:null,_initialize:function(){this._directLinkExecutor=new Quantumart.QP8.DirectLinkExecutor(this._currentCustomerCode,this._directLinkOptions);this._directLinkExecutor.ready(jQuery.proxy(function(n){this._directLinkExecutor.attachObserver(EVENT_TYPE_DIRECT_LINK_ACTION_EXECUTING,this._onActionExecutingHandler);this._backendActionExecutor=Quantumart.QP8.BackendActionExecutor.getInstance();this._backendActionExecutor.attachObserver(EVENT_TYPE_BACKEND_ACTION_EXECUTED,this._onActionExecutedHandler);this._backendSplitter=new Quantumart.QP8.BackendSplitter("splitter",{firstPaneWidth:270,minFirstPaneWidth:50,maxFirstPaneWidth:400,stateCookieName:"leftMenuSize",toWindowResize:!0});this._backendTreeMenuContextMenuManager=Quantumart.QP8.BackendTreeMenuContextMenuManager.getInstance();this._backendContextMenuManager=Quantumart.QP8.BackendContextMenuManager.getInstance();this._backendBreadCrumbsManager=Quantumart.QP8.BackendBreadCrumbsManager.getInstance("breadCrumbs");this._backendTreeMenu=new Quantumart.QP8.BackendTreeMenu("MainTreeMenu",{treeContainerElementId:"tree",contextMenuManager:this._backendTreeMenuContextMenuManager});this._backendTreeMenu.initialize(3);this._backendTreeMenu.attachObserver(EVENT_TYPE_TREE_MENU_ACTION_EXECUTING,this._onActionExecutingHandler);this._backendTabStrip=Quantumart.QP8.BackendTabStrip.getInstance("MainTabStrip",{maxTabTextLength:35,maxTabMenuItemTextLength:33});this._backendTabStrip.initialize();this._backendEditingArea=Quantumart.QP8.BackendEditingArea.getInstance("editingArea",{documentsContainerElementId:"document",breadCrumbsContainerElementId:"breadCrumbs",actionToolbarContainerElementId:"actionToolbar",viewToolbarContainerElementId:"viewToolbar",searchBlockContainerElementId:"search",contextBlockContainerElementId:"context",documentsContainerHeightDifference:118,tabStrip:this._backendTabStrip,currentCustomerCode:this._currentCustomerCode,currentUserId:this._currentUserId});this._backendEditingArea.attachObserver(EVENT_TYPE_EDITING_AREA_DOCUMENT_LOADING,this._onEditingAreaEventHandler);this._backendEditingArea.attachObserver(EVENT_TYPE_EDITING_AREA_DOCUMENT_LOADED,this._onEditingAreaEventHandler);this._backendEditingArea.attachObserver(EVENT_TYPE_EDITING_AREA_DOCUMENT_CLOSING,this._onEditingAreaEventHandler);this._backendEditingArea.attachObserver(EVENT_TYPE_EDITING_AREA_DOCUMENT_CLOSED,this._onEditingAreaEventHandler);this._backendEditingArea.attachObserver(EVENT_TYPE_EDITING_AREA_DOCUMENT_ERROR,this._onEditingAreaEventHandler);this._backendEditingArea.attachObserver(EVENT_TYPE_EDITING_AREA_FIND_TAB_IN_TREE,this._onEditingAreaEventHandler);this._backendEditingArea.attachObserver(EVENT_TYPE_EDITING_AREA_CLOSED,this._onEditingAreaEventHandler);this._backendEditingArea.attachObserver(EVENT_TYPE_EDITING_AREA_ACTION_EXECUTING,this._onActionExecutingHandler);this._backendEditingArea.attachObserver(EVENT_TYPE_EDITING_AREA_ENTITY_READED,this._onEntityReadedHandler);this._backendEditingArea.attachObserver(EVENT_TYPE_HOST_EXTERNAL_CALLER_CONTEXTS_UNBINDED,this._onHostExternalCallerContextsUnbindedHandler);this._backendPopupWindowManager=Quantumart.QP8.BackendPopupWindowManager.getInstance();this._backendPopupWindowManager.attachObserver(EVENT_TYPE_POPUP_WINDOW_ACTION_EXECUTING,this._onActionExecutingHandler);this._backendPopupWindowManager.attachObserver(EVENT_TYPE_POPUP_WINDOW_ENTITY_READED,this._onEntityReadedHandler);this._backendPopupWindowManager.attachObserver(EVENT_TYPE_HOST_EXTERNAL_CALLER_CONTEXTS_UNBINDED,this._onHostExternalCallerContextsUnbindedHandler);this._backendEntityGridManager=Quantumart.QP8.BackendEntityGridManager.getInstance();this._backendEntityTreeManager=Quantumart.QP8.BackendEntityTreeManager.getInstance();this._backendEntityEditorManager=Quantumart.QP8.BackendEntityEditorManager.getInstance();this._backendEntityEditorManager.attachObserver(EVENT_TYPE_ENTITY_EDITOR_IS_READY,jQuery.proxy(this._onEntityEditorReady,this));this._backendEntityEditorManager.attachObserver(EVENT_TYPE_ENTITY_EDITOR_DISPOSED,jQuery.proxy(this._onEntityEditorDisposed,this));this._backendEntityEditorManager.attachObserver(EVENT_TYPE_ENTITY_EDITOR_FIELD_CHANGED,jQuery.proxy(this._onEntityEditorFieldChanged,this));this._backendEntityEditorManager.attachObserver(EVENT_TYPE_ENTITY_EDITOR_ALL_FIELD_INVALIDATE,jQuery.proxy(this._onEntityEditorAllFieldInvalidate,this));this._backendEntityDataListManager=Quantumart.QP8.BackendEntityDataListManager.getInstance();this._backendLibraryManager=Quantumart.QP8.BackendLibraryManager.getInstance();this._backendActionPermissionViewManager=Quantumart.QP8.BackendActionPermissionViewManager.getInstance();this._backendCustomActionHostManager=Quantumart.QP8.BackendCustomActionHostManager.getInstance();this._backendCustomActionHostManager.attachObserver(EVENT_TYPE_CLOSE_HOST_MESSAGE_RECEIVED,jQuery.proxy(this._onCloseHostMessageReceived,this));this._backendSplitter.attachObserver(EVENT_TYPE_SPLITTER_RESIZED,this._onResizeSplitterHandler);this._backendSplitter.attachObserver(EVENT_TYPE_SPLITTER_INITIALIZED,this._onResizeSplitterHandler);this._backendSplitter.attachObserver(EVENT_TYPE_SPLITTER_DRAG_START,this._onDragStartSplitterHandler);this._backendSplitter.attachObserver(EVENT_TYPE_SPLITTER_DROP,this._onDropSplitterHandler);this._backendSplitter.initialize();this._autoLoadHome&&this._loadHome();this._entityEditorAutoSaver=new Quantumart.QP8.EntityEditorAutoSaver({currentCustomerCode:this._currentCustomerCode,currentUserId:this._currentUserId});this._entityEditorAutoSaver.attachObserver(EVENT_TYPE_AUTO_SAVER_ACTION_EXECUTING,this._onActionExecutingHandler);n?this._entityEditorAutoSaver.start():this._entityEditorAutoSaver.restore();isDebugMode&&this._initializeTraceWindowLink();this._initializeSignOut()},this));this._initializeHubs()},_error:function(){},_initializeSignOut:function(){jQuery(".signOut").bind("click",function(){Quantumart.QP8.BackendLogin.removeCustomerCode()})},_terminateSignOut:function(){jQuery(".signOut").unbind("click")},_initializeTraceWindowLink:function(){jQuery("#traceWindowLink").bind("click",this._onTraceWindowLinkClickHandler)},_terminateTraceWindowLink:function(){jQuery("#traceWindowLink").unbind("click",this._onTraceWindowLinkClickHandler)},_initializeHubs:function(){that=this;$.connection.hub.logging=this._isDebugMode;$.connection.communication.client.send=function(n,t){n=="singleusermode"?that._updateSingleUserMode(t):$("."+n).text(t)};$.connection.singleUserMode.client.send=this._updateSingleUserMode;$.connection.hub.start().done(function(){var n=$("body").data("dbhash");$.connection.communication.server.addHash(n)})},_updateSingleUserMode:function(n){var t=$(".singleusermode"),r=$(".userName").data("userid"),i="";n==null?($("form :input").prop("disabled",!1),t.hide()):(n.userId==r?(i=$l.Communacation.singleUserModeMessage,t.addClass("info"),t.removeClass("warning")):(i=$l.Communacation.singleUserModeMessageFor+n.userName,t.addClass("warning"),t.removeClass("info")),t.show());t.text(i)},_markAsBusy:function(){this._busy=!0;this._backendTreeMenu&&this._backendTreeMenu.markTreeAsBusy();this._backendEditingArea&&this._backendEditingArea.markAsBusy()},_unmarkAsBusy:function(){this._busy=!1;this._backendTreeMenu&&this._backendTreeMenu.unmarkTreeAsBusy();this._backendEditingArea&&this._backendEditingArea.unmarkAsBusy()},_onTraceWindowLinkClickHandler:function(){Quantumart.QP8.BackendTraceWindow.getInstance().toggleWindow()},_onResizeSplitter:function(n,t,i){this._backendTreeMenu.fixTreeHeight(i.get_firstPaneHeight());this._backendEditingArea.get_tabStrip().fixTabStripWidth(i.get_firstPaneWidth());var r=this._backendEditingArea.getSelectedDocument();r&&r.fixActionToolbarWidth()},_onDragStartSplitter:function(){this._busy||this._backendEditingArea.showAjaxLoadingLayer()},_onDropSplitter:function(){this._busy||this._backendEditingArea.hideAjaxLoadingLayer()},_onEditingAreaEvent:function(n,t,i){n==EVENT_TYPE_EDITING_AREA_DOCUMENT_LOADING?this._backendTreeMenu.markTreeAsBusy():n==EVENT_TYPE_EDITING_AREA_DOCUMENT_LOADED?(this._backendTreeMenu.unmarkTreeAsBusy(),i.get_isSelected()&&this._backendTreeMenu.highlightNodeWithEventArgs(i)):n==EVENT_TYPE_EDITING_AREA_FIND_TAB_IN_TREE?(this._backendTreeMenu.unmarkTreeAsBusy(),this._backendTreeMenu.highlightNodeWithEventArgs(i)):n==EVENT_TYPE_EDITING_AREA_DOCUMENT_CLOSING?this._backendTreeMenu.markTreeAsBusy():n==EVENT_TYPE_EDITING_AREA_DOCUMENT_CLOSED?this._backendTreeMenu.unmarkTreeAsBusy():n==EVENT_TYPE_EDITING_AREA_DOCUMENT_ERROR?this._backendTreeMenu.unmarkTreeAsBusy():n==EVENT_TYPE_EDITING_AREA_CLOSED&&this._backendTreeMenu.unhighlightAllNodes()},_isMultistep:function(n,t){var r=t.get_entities(),i=1;return n.EntityLimit&&(i=n.EntityLimit),n.IsMultistep||n.AdditionalControllerActionUrl&&r.length>i},_onActionExecuting:function(n,t,i){var u=this._backendActionExecutor.executeSpecialAction(i),o=this,f,r,e;u==BACKEND_ACTION_EXECUTION_STATUS_NOT_STARTING?(f=i.get_actionCode(),r=$a.getSelectedAction(f),$q.isObject(r)&&(r.IsInterface?i.get_isWindow()?this._backendPopupWindowManager.openPopupWindow(i):this._backendEditingArea.addDocument(i):this._isMultistep(r,i)?jQuery.when(this._backendActionExecutor.executeMultistepAction(i)).done(function(n){n==BACKEND_ACTION_EXECUTION_STATUS_SUCCESS&&o._onActionExecuted(i)}).fail(function(){}):(this._markAsBusy(),e=jQuery.proxy(function(n,t){n==BACKEND_ACTION_EXECUTION_STATUS_SUCCESS&&this._onActionExecuted(t);this._unmarkAsBusy()},this),this._backendActionExecutor.executeNonInterfaceAction(i,e)))):u==BACKEND_ACTION_EXECUTION_STATUS_SUCCESS&&this._onActionExecuted(i)},_onActionExecuted:function(n){this._backendCustomActionHostManager.onActionExecuted(n);this._backendBreadCrumbsManager.onActionExecuted(n);this._backendTreeMenu.onActionExecuted(n);this._backendEditingArea.onActionExecuted(n);this._backendPopupWindowManager.onActionExecuted(n);this._backendEntityGridManager.onActionExecuted(n);this._backendEntityDataListManager.onActionExecuted(n);this._backendLibraryManager.onActionExecuted(n);this._backendEntityEditorManager.onActionExecuted(n);this._backendEntityTreeManager.onActionExecuted(n);this._backendContextMenuManager.onActionExecuted(n);this._backendActionPermissionViewManager.onActionExecuted(n);n.get_isUpdated()&&n.get_entityTypeCode()==ENTITY_TYPE_CODE_CUSTOM_ACTION&&$cache.clear()},_onEntityReaded:function(n,t,i){this._onActionExecuted(i)},_unlockAllEntities:function(){$q.postDataToUrl(CONTROLLER_URL_ENTITY_OBJECT+"UnlockAllEntities",null,!1)},_onCloseHostMessageReceived:function(n,t,i){this._backendEditingArea.onCloseHostMessageReceived(i)},_onHostExternalCallerContextsUnbinded:function(n,t,i){Quantumart.QP8.BackendCustomActionHostManager.getInstance().onExternalCallerContextsUnbinded(i)},_onEntityEditorReady:function(n,t,i){this._entityEditorAutoSaver.onEntityEditorReady(i.documentWrapperElementId)},_onEntityEditorDisposed:function(n,t,i){this._entityEditorAutoSaver.onEntityEditorDisposed(i.documentWrapperElementId)},_onEntityEditorFieldChanged:function(n,t,i){this._entityEditorAutoSaver.onFieldChanged(i.fieldChangeInfo)},_onEntityEditorAllFieldInvalidate:function(n,t,i){this._entityEditorAutoSaver.onAllFieldInvalidate(i.documentWrapperElementId)},checkOpenDocumentByEventArgs:function(n){var t=this._backendTabStrip.getTabsByEventArgs(n),r=t&&t.length>0,i=this._backendPopupWindowManager.getPopupWindowByEventArgs(n),u=i&&i.length>0;return r?String.format($l.Action.selectedDocumentIsOpenedInTab,n.get_entityId()):u?String.format($l.Action.selectedDocumentIsOpenedInWindow,n.get_entityId()):""},_loadHome:function(){var n=$a.getBackendActionByCode("home"),t=new Quantumart.QP8.BackendActionParameters({entityTypeCode:"db",entityId:1,entityName:this._currentCustomerCode,parentEntityId:0}),i=$a.getEventArgsFromActionWithParams(n,t);this._onActionExecuting(null,this,i)},_dispose:function(){try{this._unlockAllEntities();this._entityEditorAutoSaver&&(this._entityEditorAutoSaver.detachObserver(EVENT_TYPE_AUTO_SAVER_ACTION_EXECUTING),this._entityEditorAutoSaver.dispose(),this._entityEditorAutoSaver=null);this._backendPopupWindowManager&&(this._backendPopupWindowManager.detachObserver(EVENT_TYPE_POPUP_WINDOW_ACTION_EXECUTING,this._onActionExecutingHandler),this._backendPopupWindowManager.detachObserver(EVENT_TYPE_POPUP_WINDOW_ENTITY_READED,this._onEntityReadedHandler),this._backendPopupWindowManager.detachObserver(EVENT_TYPE_HOST_EXTERNAL_CALLER_CONTEXTS_UNBINDED,this._onHostExternalCallerContextsUnbindedHandler),this._backendPopupWindowManager.dispose(),this._backendPopupWindowManager=null);this._backendEntityDataListManager&&(this._backendEntityDataListManager.dispose(),this._backendEntityDataListManager=null);this._backendEntityEditorManager&&(this._backendEntityEditorManager.detachObserver(EVENT_TYPE_ENTITY_EDITOR_IS_READY),this._backendEntityEditorManager.detachObserver(EVENT_TYPE_ENTITY_EDITOR_DISPOSED),this._backendEntityEditorManager.detachObserver(EVENT_TYPE_ENTITY_EDITOR_FIELD_CHANGED),this._backendEntityEditorManager.detachObserver(EVENT_TYPE_ENTITY_EDITOR_ALL_FIELD_INVALIDATE),this._backendEntityEditorManager.dispose(),this._backendEntityEditorManager=null);this._backendEntityTreeManager&&(this._backendEntityTreeManager.dispose(),this._backendEntityTreeManager=null);this._backendEntityGridManager&&(this._backendEntityGridManager.dispose(),this._backendEntityGridManager=null);this._backendActionPermissionViewManager&&(this._backendActionPermissionViewManager.dispose(),this._backendActionPermissionViewManager=null);this._backendEditingArea&&(this._backendEditingArea.detachObserver(EVENT_TYPE_EDITING_AREA_DOCUMENT_LOADING,this._onEditingAreaEventHandler),this._backendEditingArea.detachObserver(EVENT_TYPE_EDITING_AREA_DOCUMENT_LOADED,this._onEditingAreaEventHandler),this._backendEditingArea.detachObserver(EVENT_TYPE_EDITING_AREA_DOCUMENT_CLOSING,this._onEditingAreaEventHandler),this._backendEditingArea.detachObserver(EVENT_TYPE_EDITING_AREA_DOCUMENT_CLOSED,this._onEditingAreaEventHandler),this._backendEditingArea.detachObserver(EVENT_TYPE_EDITING_AREA_DOCUMENT_ERROR,this._onEditingAreaEventHandler),this._backendEditingArea.detachObserver(EVENT_TYPE_EDITING_AREA_FIND_TAB_IN_TREE,this._onEditingAreaEventHandler),this._backendEditingArea.detachObserver(EVENT_TYPE_EDITING_AREA_CLOSED,this._onEditingAreaEventHandler),this._backendEditingArea.detachObserver(EVENT_TYPE_EDITING_AREA_ACTION_EXECUTING,this._onActionExecutingHandler),this._backendEditingArea.detachObserver(EVENT_TYPE_EDITING_AREA_ENTITY_READED,this._onEntityReadedHandler),this._backendEditingArea.detachObserver(EVENT_TYPE_HOST_EXTERNAL_CALLER_CONTEXTS_UNBINDED,this._onHostExternalCallerContextsUnbindedHandler),this._backendEditingArea.dispose(),this._backendEditingArea=null);this._backendTabStrip&&(this._backendTabStrip.dispose(),this._backendTabStrip=null);this._backendTreeMenu&&(this._backendTreeMenu.detachObserver(EVENT_TYPE_TREE_MENU_ACTION_EXECUTING,this._onActionExecutingHandler),this._backendTreeMenu.dispose(),this._backendTreeMenu=null);this._backendBreadCrumbsManager&&(this._backendBreadCrumbsManager.dispose(),this._backendBreadCrumbsManager=null);this._backendTreeMenuContextMenuManager&&(this._backendTreeMenuContextMenuManager.dispose(),this._backendTreeMenuContextMenuManager=null);this._backendContextMenuManager&&(this._backendContextMenuManager.dispose(),this._backendContextMenuManager=null);this._backendCustomActionHostManager&&(this._backendCustomActionHostManager.detachObserver(EVENT_TYPE_CLOSE_HOST_MESSAGE_RECEIVED),this._backendCustomActionHostManager.dispose(),this._backendCustomActionHostManager=null);this._backendSplitter&&(this._backendSplitter.detachObserver(EVENT_TYPE_SPLITTER_RESIZED,this._onResizeSplitterHandler),this._backendSplitter.detachObserver(EVENT_TYPE_SPLITTER_INITIALIZED,this._onResizeSplitterHandler),this._backendSplitter.detachObserver(EVENT_TYPE_SPLITTER_DRAG_START,this._onDragStartSplitterHandler),this._backendSplitter.detachObserver(EVENT_TYPE_SPLITTER_DROP,this._onDropSplitterHandler),this._backendSplitter.dispose(),this._backendSplitter=null);this._backendActionExecutor&&(this._backendActionExecutor.detachObserver(EVENT_TYPE_BACKEND_ACTION_EXECUTED,this._onActionExecutedHandler),this._backendActionExecutor.dispose(),this._backendActionExecutor=null);Quantumart.QP8.BackendTraceWindow.destroyInstance();this._isDebugMode&&this._terminateTraceWindowLink();this._terminateSignOut();jQuery(document).unbind("click");jQuery(window).unbind("load",this._loadHandler);window.attachEvent?jQuery(window).unbind("unload",this._unloadHandler):window.onbeforeunload=null;$cache.dispose();this._loadHandler=null;this._unloadHandler=null;this._errorHandler=null;this._onResizeSplitterHandler=null;this._onDragStartSplitterHandler=null;this._onDropSplitterHandler=null;this._onEditingAreaEventHandler=null;this._onActionExecutingHandler=null;this._onActionExecutedHandler=null;this._onEntityReadedHandler=null}finally{this._directLinkExecutor&&(this._directLinkExecutor.detachObserver(EVENT_TYPE_DIRECT_LINK_ACTION_EXECUTING),this._directLinkExecutor.dispose())}}};Quantumart.QP8.Backend._instance=null;Quantumart.QP8.Backend.getInstance=function(n,t){var i=Quantumart.QP8.Backend._instance;return i==null&&(i=new Quantumart.QP8.Backend(n,t),Quantumart.QP8.Backend._instance=i),i};Quantumart.QP8.Backend.registerClass("Quantumart.QP8.Backend");