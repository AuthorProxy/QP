Quantumart.QP8.BackendDocumentContext=function(n,t){Quantumart.QP8.BackendDocumentContext.initializeBase(this);this._hostId=n.hostId;$q.isBoolean(n.isWindow)&&(this._isWindow=n.isWindow);this._params=n;n.entityId&&(this._entityId=n.entityId);n.entityName&&(this._entityName=n.entityName);n.entities&&(this._entities=n.entities);n.parentEntityId&&(this._parentEntityId=n.parentEntityId);n.entityTypeCode&&(this._entityTypeCode=n.entityTypeCode);n.actionCode&&(this._actionCode=n.actionCode);n.previousActionCode&&(this._previousActionCode=n.previousActionCode);n.state&&(this._state=n.state);n.mainComponentType&&(this._mainComponentType=n.mainComponentType);n.mainComponentId&&(this._mainComponentId=n.mainComponentId);this._options=t;this._options.isWindow=this._isWindow;this._customLinkButtonsSettings=[];this._customButtonsSettings=[]};Quantumart.QP8.BackendDocumentContext.prototype={test:function(){return this},_hostId:"",_isWindow:!1,_entityId:0,_entityName:"",_entities:null,_parentEntityId:0,_entityTypeCode:"",_actionCode:"",_previousActionCode:"",_state:$e.DocumentContextState.None,_mainComponentType:$e.MainComponentType.Editor,_mainComponentId:"",_mainComponent:null,_eventArgs:null,_initializingCallback:null,_initializedCallback:null,_terminatingCallback:null,_terminatedCallback:null,_execSelectCallback:null,_hostLoadedCallback:null,initHandler:null,disposeHandler:null,beforeSubmitHandler:null,loadHanlder:null,fieldValueChangedHandler:null,_options:null,_params:null,_customLinkButtonsSettings:null,_customButtonsSettings:null,get_mainComponent:function(){return this._mainComponent},get_mainComponentType:function(){return this._mainComponentType},get_state:function(){return this._state},set_initializingCallback:function(n){this._initializingCallback=n},set_initializedCallback:function(n){this._initializedCallback=n},set_terminatingCallback:function(n){this._terminatingCallback=n},set_terminatedCallback:function(n){this._terminatedCallback=n},set_execSelectCallback:function(n){this._execSelectCallback=n},set_hostLoadedCallback:function(n){this._hostLoadedCallback=n},init:function(){Sys.Debug.trace("initPage "+this._hostId);this.needUp()||$q.callFunction(this._initializingCallback,this);var n=this.getHost();n&&(this._mainComponent=this.createMainComponent(n),n.set_documentContext(this));this.needUp()||$q.callFunction(this._initializedCallback,this)},getHost:function(){return this._isWindow?Quantumart.QP8.BackendPopupWindowManager.getInstance().getPopupWindow(this._hostId):this._getArea().getDocument(this._hostId)},_getArea:function(){return Quantumart.QP8.BackendEditingArea.getInstance()},setGlobal:function(n,t){$ctx.setGlobal(n,t)},getGlobal:function(n){return $ctx.getGlobal(n)},loadScript:function(n,t){if(t||(t=n),!this._getArea().getCustomScriptState(t)){var i=jQuery.ajax({type:"get",dataType:"script",url:n,cache:!1,async:!1});this._getArea().setCustomScriptState(t,!0)}},addCustomButton:function(n){this._customButtonsSettings.push(n)},addCustomLinkButton:function(n){this._customLinkButtonsSettings.push(n)},execSelect:function(n){this._execSelectCallback&&this._execSelectCallback(n)},createMainComponent:function(n){var r={viewTypeCode:n.get_viewTypeCode(),searchQuery:n.get_searchQuery(),contextQuery:n.get_contextQuery(),filter:n.get_filter(),hostType:n.get_hostType(),currentPage:n.get_currentPage(),orderBy:n.get_orderBy(),eventArgsAdditionalData:n.get_eventArgsAdditionalData(),isBindToExternal:n.get_isBindToExternal(),zIndex:n.get_zIndex()},i=n._onGeneralEventHandler,t=null;return this._mainComponentType==$e.MainComponentType.Grid?(t=Quantumart.QP8.BackendEntityGridManager.getInstance().createGrid(this._mainComponentId,this._entityTypeCode,this._parentEntityId,this._actionCode,this._options,r),t.attachObserver(EVENT_TYPE_ENTITY_GRID_DATA_BINDING,i),t.attachObserver(EVENT_TYPE_ENTITY_GRID_DATA_BOUND,i),t.attachObserver(EVENT_TYPE_ENTITY_GRID_ENTITY_SELECTED,i),t.attachObserver(EVENT_TYPE_ENTITY_GRID_TITLE_LINK_CLICK,i),t.attachObserver(EVENT_TYPE_ENTITY_GRID_ACTION_EXECUTING,i)):this._mainComponentType==$e.MainComponentType.Tree?(t=Quantumart.QP8.BackendEntityTreeManager.getInstance().createTree(this._mainComponentId,this._entityTypeCode,this._parentEntityId,this._actionCode,this._options,r),t.attachObserver(EVENT_TYPE_ENTITY_TREE_DATA_BOUND,i),t.attachObserver(EVENT_TYPE_ENTITY_TREE_ENTITY_SELECTED,i),t.attachObserver(EVENT_TYPE_ENTITY_TREE_ACTION_EXECUTING,i)):this._mainComponentType==$e.MainComponentType.Library?(t=Quantumart.QP8.BackendLibraryManager.getInstance().createLibrary(this._mainComponentId,this._parentEntityId,this._actionCode,this._options,r),t.attachObserver(EVENT_TYPE_LIBRARY_DATA_BOUND,i),t.attachObserver(EVENT_TYPE_LIBRARY_ENTITY_SELECTED,i),t.attachObserver(EVENT_TYPE_LIBRARY_ACTION_EXECUTING,i)):this._mainComponentType==$e.MainComponentType.Editor?(this._options.needUp=this.needUp(),this._options.customHandlers=this.getCustomHandlers(),this._options.customButtonsSettings=this._customButtonsSettings,this._options.customLinkButtonsSettings=this._customLinkButtonsSettings,this._options.notifyCustomButtonExistence=this.notifyCustomButtonExistence,t=Quantumart.QP8.BackendEntityEditorManager.getInstance().createEditor(n.get_documentWrapperElementId(),this._entityTypeCode,this._entityId,"",this._options,r),t.attachObserver(EVENT_TYPE_ENTITY_EDITOR_ENTITY_SUBMITTING,i),t.attachObserver(EVENT_TYPE_ENTITY_EDITOR_ENTITY_SUBMITTED,i),t.attachObserver(EVENT_TYPE_ENTITY_EDITOR_ENTITY_SUBMITTED_ERROR,i),t.attachObserver(EVENT_TYPE_ENTITY_EDITOR_ENTITY_REFRESH_STARTING,i),t.attachObserver(EVENT_TYPE_ENTITY_EDITOR_ACTION_EXECUTING,i),t.attachObserver(EVENT_TYPE_CLASSIFIER_FIELD_ARTICLE_LOADED,i),t.attachObserver(EVENT_TYPE_CLASSIFIER_FIELD_ARTICLE_UNLOADING,i),t.attachObserver(EVENT_TYPE_LIBRARY_ALL_FILES_UPLOADED,i)):this._mainComponentType==$e.MainComponentType.CustomActionHost?(r.eventArgsAdditionalData&&jQuery.extend(this._params,{additionalParams:r.eventArgsAdditionalData.additionalParams}),t=Quantumart.QP8.BackendCustomActionHostManager.getInstance().createComponent(this._hostId,this._params),t.attachObserver(EVENT_TYPE_EXTERNAL_ACTION_EXECUTING,i)):this._mainComponentType==$e.MainComponentType.ActionPermissionView?(t=Quantumart.QP8.BackendActionPermissionViewManager.getInstance().createView(this._mainComponentId,this._options,r),t.attachObserver(EVENT_TYPE_ACTION_PERMISSIONS_VIEW_EXECUTING,i)):this._mainComponentType==$e.MainComponentType.Area&&(t={initialize:function(){},dispose:function(){}}),t.initialize(),t},onHostLoaded:function(){$q.callFunction(this._hostLoadedCallback,this)},get_eventArgs:function(){if(!this._eventArgs){var t=$a.getBackendAction(this._actionCode),n=$a.getEventArgsFromAction(t);n.set_entityId(this._entityId);n.set_entityName(this._entityName);n.set_entities(this._entities);n.set_parentEntityId(this._parentEntityId);n.set_context(this.getEventArgsContext());n.set_previousAction(this.getPreviousAction());n.set_isWindow(this._isWindow);this._eventArgs=n}return this._eventArgs},getEventArgsContext:function(){var n={orderChanged:!1,groupChanged:!1,viewInListAffected:!1};return $q.isBoolean(this._options.orderChanged)&&(n.orderChanged=this._options.orderChanged),$q.isBoolean(this._options.groupChanged)&&(n.groupChanged=this._options.groupChanged),$q.isBoolean(this._options.viewInListAffected)&&(n.viewInListAffected=this._options.viewInListAffected),n},modifyEventArgsContext:function(n){return n},getPreviousAction:function(){var t=null,n;return this._previousActionCode&&(n=$a.getBackendAction(this._previousActionCode),n&&(t=new Quantumart.QP8.BackendPreviousAction({entityTypeCode:n.EntityType.Code,actionTypeCode:n.ActionType.Code,actionCode:n.Code,isSuccessfullyExecuted:!0}))),t},get_options:function(){return this._options},needUp:function(){var t=!1,n;return this._mainComponentType==$e.MainComponentType.Editor&&this._state!=$e.DocumentContextState.Error&&(n=this.get_eventArgs(),n.get_needUp()&&!$q.isNull(n.get_previousAction())&&(t=!0)),t},disposeMainComponent:function(n){var t=n._onGeneralEventHandler;this._mainComponentType==$e.MainComponentType.Grid?(this._mainComponent.detachObserver(EVENT_TYPE_ENTITY_GRID_DATA_BINDING,t),this._mainComponent.detachObserver(EVENT_TYPE_ENTITY_GRID_DATA_BOUND,t),this._mainComponent.detachObserver(EVENT_TYPE_ENTITY_GRID_ENTITY_SELECTED,t),this._mainComponent.detachObserver(EVENT_TYPE_ENTITY_GRID_TITLE_LINK_CLICK,t),this._mainComponent.detachObserver(EVENT_TYPE_ENTITY_GRID_ACTION_EXECUTING,t)):this._mainComponentType==$e.MainComponentType.Editor?(this._mainComponent.detachObserver(EVENT_TYPE_ENTITY_EDITOR_ENTITY_SUBMITTING,t),this._mainComponent.detachObserver(EVENT_TYPE_ENTITY_EDITOR_ENTITY_SUBMITTED,t),this._mainComponent.detachObserver(EVENT_TYPE_ENTITY_EDITOR_ENTITY_SUBMITTED_ERROR,t),this._mainComponent.detachObserver(EVENT_TYPE_ENTITY_EDITOR_ENTITY_REFRESH_STARTING,t),this._mainComponent.detachObserver(EVENT_TYPE_ENTITY_EDITOR_ACTION_EXECUTING,t),this._mainComponent.detachObserver(EVENT_TYPE_LIBRARY_ALL_FILES_UPLOADED,t)):this._mainComponentType==$e.MainComponentType.Library?(this._mainComponent.detachObserver(EVENT_TYPE_LIBRARY_DATA_BOUND,t),this._mainComponent.detachObserver(EVENT_TYPE_LIBRARY_ENTITY_SELECTED,t),this._mainComponent.detachObserver(EVENT_TYPE_LIBRARY_ACTION_EXECUTING,t)):this._mainComponentType==$e.MainComponentType.Tree?(this._mainComponent.detachObserver(EVENT_TYPE_ENTITY_TREE_DATA_BOUND,t),this._mainComponent.detachObserver(EVENT_TYPE_ENTITY_TREE_ENTITY_SELECTED,t),this._mainComponent.detachObserver(EVENT_TYPE_ENTITY_TREE_ACTION_EXECUTING,t)):this._mainComponentType==$e.MainComponentType.CustomActionHost?this._mainComponent.detachObserver(EVENT_TYPE_EXTERNAL_ACTION_EXECUTING,t):this._mainComponentType==$e.MainComponentType.ActionPermissionView&&this._mainComponent.detachObserver(EVENT_TYPE_ACTION_PERMISSIONS_VIEW_EXECUTING,t);this._mainComponent.dispose();this._mainComponent=null},getCustomHandlers:function(){var n={};return this.initHandler&&(n.init=jQuery.proxy(this.initHandler,this)),this.disposeHandler&&(n.dispose=jQuery.proxy(this.disposeHandler,this)),this.beforeSubmitHandler&&(n.beforeSubmit=jQuery.proxy(this.beforeSubmitHandler,this)),this.fieldValueChangedHandler&&(n.fieldValueChanged=jQuery.proxy(this.fieldValueChangedHandler,this)),this.loadHandler&&(n.load=jQuery.proxy(this.loadHandler,this)),n},dispose:function(){Sys.Debug.trace("terminatePage "+this._hostId);this.needUp()||$q.callFunction(this._terminatingCallback,this);var n=this.getHost();n&&(this.disposeMainComponent(n),n.set_documentContext(null));this.needUp()||$q.callFunction(this._terminatedCallback,this)}};var $ctx=Quantumart.QP8.BackendDocumentContext;Quantumart.QP8.BackendDocumentContext.getArea=function(){return Quantumart.QP8.BackendEditingArea.getInstance()};Quantumart.QP8.BackendDocumentContext.getGlobal=function(n){return $ctx.getArea().getGlobal(n)};Quantumart.QP8.BackendDocumentContext.setGlobal=function(n,t){return $ctx.getArea().setGlobal(n,t)};Quantumart.QP8.BackendDocumentContext.registerClass("Quantumart.QP8.BackendDocumentContext");