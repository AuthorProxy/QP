var EVENT_TYPE_POPUP_WINDOW_ACTION_EXECUTING="OnPopupWindowActionExecuting",EVENT_TYPE_POPUP_WINDOW_ENTITY_READED="OnPopupWindowEntityReaded",EVENT_TYPE_POPUP_WINDOW_CLOSED="OnPopupWindowClosed";Quantumart.QP8.BackendPopupWindow=function(n,t,i){Quantumart.QP8.BackendPopupWindow.initializeBase(this,[t,i]);var r=jQuery(window),u=r.width(),f=r.height();r=null;this._popupWindowId=n;$q.isObject(t)&&(this._applyEventArgs(t,!0),this.bindExternalCallerContext(t));this._loadDefaultSearchBlockState();$q.isObject(i)&&($q.isNull(i.showBreadCrumbs)||(this._showBreadCrumbs=i.showBreadCrumbs),i.customActionToolbarComponent&&(this._actionToolbarComponent=i.customActionToolbarComponent,this._useCustomActionToolbar=!0),this._selectedEntities=[],$q.isNull(i.saveSelectionWhenChangingView)||(this._saveSelectionWhenChangingView=i.saveSelectionWhenChangingView),i.title&&(this._title=i.title),this._width=i.width?i.width:Math.floor(u*.8),this._height=i.height?i.height:Math.floor(f*.8),this._minWidth=i.minWidth?i.minWidth:Math.floor(u*.2),this._minHeight=i.minHeight?i.minHeight:Math.floor(f*.2),$q.isNull(i.isModal)||(this._isModal=i.isModal),$q.isNull(i.allowResize)||(this._allowResize=i.allowResize),$q.isNull(i.allowDrag)||(this._allowDrag=i.allowDrag),$q.isNull(i.showCloseButton)||(this._showCloseButton=i.showCloseButton),$q.isNull(i.showMinimizeButton)||(this._showMinimizeButton=i.showMinimizeButton),$q.isNull(i.showMaximizeButton)||(this._showMaximizeButton=i.showMaximizeButton),i.additionalUrlParameters&&(this._additionalUrlParameters=i.additionalUrlParameters),t.get_context()&&t.get_context().additionalUrlParameters&&(this._additionalUrlParameters=jQuery.extend(this._additionalUrlParameters,t.get_context().additionalUrlParameters)),i.zIndex&&(this._zIndex=$q.toInt(i.zIndex)),i.filter&&(this._filter=i.filter),i.isMultiOpen&&(this._isMultiOpen=i.isMultiOpen));this._onPopupWindowResizeHandler=jQuery.proxy(this._onPopupWindowResize,this);this._onPopupWindowOpenHandler=jQuery.proxy(this._onPopupWindowOpen,this);this._onPopupWindowCloseHandler=jQuery.proxy(this._onPopupWindowClose,this);this._onPopupWindowActivatedHandler=jQuery.proxy(this._onPopupWindowActivated,this)};Quantumart.QP8.BackendPopupWindow.prototype={_popupWindowId:"",_popupWindowElement:null,_popupWindowComponent:null,_showBreadCrumbs:!1,_breadCrumbsWrapperElement:null,_toolbarWrapperElement:null,_actionToolbarWrapperElement:null,_viewToolbarWrapperElement:null,_searchBlockWrapperElement:null,_contextBlockWrapperElement:null,_documentAreaElement:null,_loadingLayerElement:null,_selectionContext:null,_saveSelectionWhenChangingView:!1,_title:"",_width:400,_height:300,_minWidth:400,_minHeight:300,_isModal:!0,_allowResize:!0,_allowDrag:!0,_showRefreshButton:!1,_showCloseButton:!0,_showMaximizeButton:!0,_popupWindowManagerComponent:null,_additionalUrlParameters:null,_zIndex:0,_isMultiOpen:!1,get_popupWindowId:function(){return this._popupWindowId},get_showBreadCrumbs:function(){return this._showBreadCrumbs},get_saveSelectionWhenChangingView:function(){return this._saveSelectionWhenChangingView},set_saveSelectionWhenChangingView:function(n){this._saveSelectionWhenChangingView=n},get_title:function(){return this._title},set_title:function(n){this._title=n},get_width:function(){return this._width},set_width:function(n){this._width=n},get_height:function(){return this._height},set_height:function(n){this._height=n},get_minWidth:function(){return this._minWidth},set_minWidth:function(n){this._minWidth=n},get_minHeight:function(){return this._minHeight},set_minHeight:function(n){this._minHeight=n},get_isModal:function(){return this._isModal},set_isModal:function(n){this._isModal=n},get_allowResize:function(){return this._allowResize},set_allowResize:function(n){this._allowResize=n},get_allowDrag:function(){return this._allowDrag},set_allowDrag:function(n){this._allowDrag=n},get_showRefreshButton:function(){return this._showRefreshButton},set_showRefreshButton:function(n){this._showRefreshButton=n},get_showCloseButton:function(){return this._showCloseButton},set_showCloseButton:function(n){this._showCloseButton=n},get_showMaximizeButton:function(){return this._showMaximizeButton},set_showMaximizeButton:function(n){this._showMaximizeButton=n},get_popupWindowManager:function(){return this._popupWindowManagerComponent},set_popupWindowManager:function(n){this._popupWindowManagerComponent=n},get_hostType:function(){return DOCUMENT_HOST_TYPE_POPUP_WINDOW},get_zIndex:function(){return parseInt(jQuery(this._popupWindowElement).css("z-index"))},get_selectionContext:function(){return this._selectionContext},set_selectionContext:function(n){this._selectionContext=n},_onPopupWindowResizeHandler:null,_onPopupWindowOpenHandler:null,_onPopupWindowCloseHandler:null,_onPopupWindowActivatedHandler:null,initialize:function(){var i,n,t,r;this._initSelectedEntities();i=this.getCurrentAction();$q.isNullOrWhiteSpace(this._title)&&this._popupWindowManagerComponent&&i&&(n=new Quantumart.QP8.BackendEventArgs,n.set_entityTypeCode(this._entityTypeCode),n.set_entityId(this._entityId),n.set_entityName(this._entityName),n.set_parentEntityId(this._parentEntityId),n.set_actionCode(this._actionCode),this._title=this._popupWindowManagerComponent.generatePopupWindowTitle(n));this.createPanels();t=this._createWindow();t.close=function(){$.telerik.trigger(t.element,"close")};r=jQuery(t.element);this._popupWindowElement=r.get(0);this._popupWindowComponent=t;this._attachPopupWindowEventHandlers()},_initSelectedEntities:function(){var n=this._actionTypeCode;(n==ACTION_TYPE_CODE_SELECT||n==ACTION_TYPE_CODE_MULTIPLE_SELECT)&&(this._selectedEntities=this._isMultipleEntities?Array.clone(this._entities):[{Id:this._entityId,Name:this._entityName}])},generateDocumentUrl:function(n){var u=this._actionTypeCode==ACTION_TYPE_CODE_SELECT||this._actionTypeCode==ACTION_TYPE_CODE_MULTIPLE_SELECT,r=this._isMultipleEntities?$o.getEntityIDsFromEntities(u?this._selectedEntities:this._entities):[this._entityId],t={additionalUrlParameters:this._additionalUrlParameters,controllerActionUrl:this.getCurrentViewActionUrl()},i;this.get_isBindToExternal()===!0&&(t.additionalUrlParameters=jQuery.extend(t.additionalUrlParameters,{boundToExternal:!0}));n=$q.isObject(n)?jQuery.extend(n,t):t;this._documentUrl=$a.generateActionUrl(this._isMultipleEntities,r,this._parentEntityId,this._popupWindowId,this.getCurrentAction(),n);i={};(this._isMultipleEntities||this._isCustomAction)&&(i.IDs=r);this._isCustomAction&&(i.actionCode=this._actionCode);this._documentPostParams=i},_createWindow:function(){var t=this._popupWindowId,r=[],f,n,e,o,i,g,s,l;this._showRefreshButton&&Array.add(r,"Refresh");this._showMaximizeButton&&Array.add(r,"Maximize");this._showCloseButton&&Array.add(r,"Close");var a="breadCrumbsWrapper_"+t,v="toolbarWrapper_"+t,y="actionToolbarWrapper_"+t,p="viewToolbarWrapper_"+t,w="searchBlockWrapper_"+t,b="contextBlockWrapper_"+t,k="documentArea_"+t,u="document_"+t,d=new $.telerik.stringBuilder;d.catIf('<div id="'+a+'" class="breadCrumbsWrapper"><\/div>',this._showBreadCrumbs).cat('<div id="'+v+'" class="toolbarWrapper">\n').cat('\t<div id="'+y+'" class="actionToolbarWrapper"><\/div>\n').cat('\t<div id="'+p+'" class="viewToolbarWrapper"><\/div>\n').cat("<\/div>\n").cat('<div id="'+k+'" class="area">').cat('\t<div id="'+w+'" class="searchWrapper"><\/div>').cat('\t<div id="'+b+'" class="contextWrapper"><\/div>').cat('\t<div id="'+u+'" class="documentWrapper"><\/div>').cat("<\/div>\n");f=$.telerik.window.create({title:$("<div/>").text(this._title).html(),html:d.string(),width:this._width,height:this._height,minWidth:this._minWidth,minHeight:this._minHeight,modal:this._isModal,actions:r,resizable:this._allowResize,draggable:this._allowDrag}).data("tWindow").center();n=jQuery(f.element);n.addClass("popupWindow").css("display","none");this._zIndex&&n.css("z-index",this._zIndex);e=n.find("DIV.t-window-content:first");o=0;o=jQuery.support.borderRadius?15:10;e.css("padding-bottom",o+"px");i=null;this._breadCrumbsComponent&&(g=jQuery(this._breadCrumbsComponent.get_breadCrumbsElement()),i=n.find("#"+a),i.append(g));var nt=jQuery(this._actionToolbarComponent.get_toolbarElement()),tt=jQuery(this._viewToolbarComponent.get_toolbarElement()),it=n.find("#"+v),rt=n.find("#"+y);rt.append(nt);s=n.find("#"+p);s.append(tt);var ut=n.find("#"+w),ft=n.find("#"+b),h=n.find("#"+k),c=jQuery("<div />",{"class":"loadingLayer",css:{display:"none"}});return h.prepend(c),l=n.find("#"+u),$q.isNullOrEmpty(i)||(this._breadCrumbsWrapperElement=i.get(0)),this._toolbarWrapperElement=it.get(0),this._actionToolbarWrapperElement=rt.get(0),this._viewToolbarWrapperElement=s.get(0),this._searchBlockWrapperElement=ut.get(0),this._contextBlockWrapperElement=ft.get(0),this._documentAreaElement=h.get(0),this._loadingLayerElement=c.get(0),this._documentWrapperElementId=u,this._documentWrapperElement=l.get(0),nt=null,tt=null,it=null,ut=null,h=null,c=null,l=null,e=null,n=null,f},openWindow:function(n){if(this._isMultiOpen&&this._isContentLoaded())this._popupWindowComponent.open();else{this.onDocumentChanging();this._popupWindowComponent.open();this.generateDocumentUrl(n);this.renderPanels();var t=this;this.loadHtmlContentToDocumentWrapper(function(){t.onDocumentChanged()},n)}},closeWindow:function(){if(this._isMultiOpen)$c.closePopupWindow(this._popupWindowComponent);else if(this.allowClose()){this.markMainComponentAsBusy();this.cancel();this.onDocumentUnloaded();this.unbindExternalCallerContexts("closed");var n=new Quantumart.QP8.BackendEventArgs;this.notify(EVENT_TYPE_POPUP_WINDOW_CLOSED,n);n=null;this.dispose()}},setWindowTitle:function(n){$c.setPopupWindowTitle(this._popupWindowComponent,n);this._title=n},_attachPopupWindowEventHandlers:function(){var n=jQuery(this._popupWindowElement);n.bind("open",this._onPopupWindowOpenHandler).bind("resize",this._onPopupWindowResizeHandler).bind("close",this._onPopupWindowCloseHandler).bind("activated",this._onPopupWindowActivatedHandler)},_detachPopupWindowEventHandlers:function(){var n=jQuery(this._popupWindowElement);n.unbind("open",this._onPopupWindowOpenHandler).unbind("resize",this._onPopupWindowResizeHandler).unbind("close",this._onPopupWindowCloseHandler).unbind("activated",this._onPopupWindowActivatedHandler)},_fixDocumentAreaHeight:function(){var i=jQuery(this._popupWindowElement),r=i.find("DIV.t-window-content:first"),t=null,o,s,n;this._breadCrumbsWrapperElement&&(t=jQuery(this._breadCrumbsWrapperElement));var u=jQuery(this._toolbarWrapperElement),f=jQuery(this._documentAreaElement),h=parseInt(r.height(),10),e=0;$q.isNullOrEmpty(t)||(e=parseInt(t.outerHeight(),10));o=parseInt(u.outerHeight(),10);s=h-e-o;f.height(s);n=this.get_mainComponent();n&&Quantumart.QP8.BackendLibrary.isInstanceOfType(n)&&n.resize();n=null;f=null;u=null;r=null;i=null},showLoadingLayer:function(){var n=jQuery(this._loadingLayerElement);n.show();n=null},hideLoadingLayer:function(){var n=jQuery(this._loadingLayerElement);n.hide();n=null},htmlLoadingMethod:function(){return this._isMultipleEntities||this._isCustomAction?"POST":"GET"},createPanels:function(){var o=this.getCurrentAction(),t,e,i,r,f,u,n;this._showBreadCrumbs&&(t=Quantumart.QP8.BackendBreadCrumbsManager.getInstance().createBreadCrumbs("breadCrumbs_"+this._popupWindowId,{documentHost:this}),t.attachObserver(EVENT_TYPE_BREAD_CRUMBS_ITEM_CLICK,this._onGeneralEventHandler),t.attachObserver(EVENT_TYPE_BREAD_CRUMBS_ITEM_CTRL_CLICK,this._onGeneralEventHandler),this._breadCrumbsComponent=t);this._useCustomActionToolbar||(i=this.get_eventArgsAdditionalData(),i&&i.disabledActionCodes&&(e={disabledActionCodes:i.disabledActionCodes}),r=new Quantumart.QP8.BackendActionToolbar("actionToolbar_"+this._popupWindowId,this._actionCode,this._parentEntityId,e),r.initialize(),r.attachObserver(EVENT_TYPE_ACTION_TOOLBAR_BUTTON_CLICKED,this._onGeneralEventHandler),this._actionToolbarComponent=r);f={};u=this.loadHostState();u&&u.viewTypeCode&&(f.viewTypeCode=u.viewTypeCode);n=new Quantumart.QP8.BackendViewToolbar("viewToolbar_"+this._popupWindowId,this._actionCode,f);n.initialize();n.attachObserver(EVENT_TYPE_VIEW_TOOLBAR_VIEWS_DROPDOWN_SELECTED_INDEX_CHANGED,this._onGeneralEventHandler);n.attachObserver(EVENT_TYPE_VIEW_TOOLBAR_SEARCH_BUTTON_CLICKED,this._onGeneralEventHandler);n.attachObserver(EVENT_TYPE_VIEW_TOOLBAR_CONTEXT_BUTTON_CLICKED,this._onGeneralEventHandler);this._viewToolbarComponent=n},hidePanels:function(n){this._breadCrumbsComponent&&this._breadCrumbsComponent.hideBreadCrumbs();this._actionToolbarComponent.hideToolbar(n);this._viewToolbarComponent.hideToolbar();this.get_isSearchBlockVisible()&&this._searchBlockComponent&&this._searchBlockComponent.hideSearchBlock();this._isContextBlockVisible&&this._contextBlockComponent&&this._contextBlockComponent.hideSearchBlock()},showPanels:function(n){this._breadCrumbsComponent&&this._breadCrumbsComponent.showBreadCrumbs();this._actionToolbarComponent.showToolbar(n);this._viewToolbarComponent.showToolbar();this.fixActionToolbarWidth();this.get_isSearchBlockVisible()&&this._searchBlockComponent&&this._searchBlockComponent.showSearchBlock();this._isContextBlockVisible&&this._contextBlockComponent&&this._contextBlockComponent.showSearchBlock()},destroyPanels:function(){if(this._breadCrumbsComponent){this._breadCrumbsComponent.detachObserver(EVENT_TYPE_BREAD_CRUMBS_ITEM_CLICK,this._onGeneralEventHandler);this._breadCrumbsComponent.detachObserver(EVENT_TYPE_BREAD_CRUMBS_ITEM_CTRL_CLICK,this._onGeneralEventHandler);var n=this._breadCrumbsComponent.get_breadCrumbsElementId();Quantumart.QP8.BackendBreadCrumbsManager.getInstance().destroyBreadCrumbs(n);this._breadCrumbsComponent=null}this._actionToolbarComponent&&(this._useCustomActionToolbar||this._actionToolbarComponent.detachObserver(EVENT_TYPE_ACTION_TOOLBAR_BUTTON_CLICKED,this._onGeneralEventHandler),this._actionToolbarComponent.dispose(),this._actionToolbarComponent=null);this._viewToolbarComponent&&(this._viewToolbarComponent.detachObserver(EVENT_TYPE_VIEW_TOOLBAR_VIEWS_DROPDOWN_SELECTED_INDEX_CHANGED,this._onGeneralEventHandler),this._viewToolbarComponent.detachObserver(EVENT_TYPE_VIEW_TOOLBAR_SEARCH_BUTTON_CLICKED,this._onGeneralEventHandler),this._viewToolbarComponent.detachObserver(EVENT_TYPE_VIEW_TOOLBAR_CONTEXT_BUTTON_CLICKED,this._onGeneralEventHandler),this._viewToolbarComponent.dispose(),this._viewToolbarComponent=null)},createSearchBlock:function(){var n=Quantumart.QP8.BackendSearchBlockManager.getInstance().createSearchBlock("searchBlock_"+this._popupWindowId,this._entityTypeCode,this._parentEntityId,this,{searchBlockContainerElementId:jQuery(this._searchBlockWrapperElement).attr("id"),popupWindowId:this._popupWindowId,actionCode:this._actionCode,searchBlockState:this.getHostStateProp("searchBlockState")});n.attachObserver(EVENT_TYPE_SEARCH_BLOCK_FIND_START,this._onSearchHandler);n.attachObserver(EVENT_TYPE_SEARCH_BLOCK_RESET_START,this._onSearchHandler);n.attachObserver(EVENT_TYPE_SEARCH_BLOCK_RESIZED,this._onSearchBlockResizeHandler);this._searchBlockComponent=n},createContextBlock:function(){var n=Quantumart.QP8.BackendSearchBlockManager.getInstance().createSearchBlock("contextBlock_"+this._popupWindowId,this._entityTypeCode,this._parentEntityId,this,{searchBlockContainerElementId:jQuery(this._searchBlockWrapperElement).attr("id"),popupWindowId:this._popupWindowId,actionCode:this._actionCode,contextSearch:!0,hideButtons:!0,searchBlockState:this.get_contextState()});n.initialize();n.attachObserver(EVENT_TYPE_CONTEXT_BLOCK_FIND_START,this._onContextSwitchingHandler);this._contextBlockComponent=n},destroySearchBlock:function(){var n=this._searchBlockComponent,t;n&&(n.hideSearchBlock(),n.detachObserver(EVENT_TYPE_SEARCH_BLOCK_FIND_START,this._onSearchHandler),n.detachObserver(EVENT_TYPE_SEARCH_BLOCK_RESET_START,this._onSearchHandler),n.detachObserver(EVENT_TYPE_SEARCH_BLOCK_RESIZED,this._onSearchBlockResizeHandler),t=n.get_searchBlockElementId(),Quantumart.QP8.BackendSearchBlockManager.getInstance().destroySearchBlock(t),this._searchBlockComponent=null)},destroyContextBlock:function(){var n=this._contextBlockComponent,t;n&&(n.hideSearchBlock(),n.detachObserver(EVENT_TYPE_CONTEXT_BLOCK_FIND_START,this._onContextSwitchingHandler),t=searchBlockComponent.get_searchBlockElementId(),Quantumart.QP8.BackendSearchBlockManager.getInstance().destroySearchBlock(t),this._contextBlockComponent=null,this._isContextBlockVisible=!1)},showErrorMessageInDocumentWrapper:function(){var n=jQuery(this._documentWrapperElement);n.html($q.generateErrorMessageText());n=null},updateTitle:function(n){this.setWindowTitle(this._popupWindowManagerComponent.generatePopupWindowTitle(n))},onChangeContent:function(n,t,i){this.changeContent(i)},saveSelectionContext:function(n){this._selectionContext=n.get_context()},onActionExecuting:function(n){return this._copyCurrentContextToEventArgs(n),this._popupWindowManagerComponent.notify(EVENT_TYPE_POPUP_WINDOW_ACTION_EXECUTING,n)},onEntityReaded:function(n){return this._popupWindowManagerComponent.notify(EVENT_TYPE_POPUP_WINDOW_ENTITY_READED,n)},onDocumentChanging:function(){this.markPanelsAsBusy()},onDocumentChanged:function(){this.unmarkPanelsAsBusy()},onNeedUp:function(n){this._popupWindowManagerComponent.onNeedUp(n,this.get_popupWindowId())},resetSelectedEntities:function(){this._initSelectedEntities()},_onLibraryResized:function(n,t){var i=jQuery(this._documentAreaElement),r=jQuery(t._libraryElement);r.height(i.height()+8);i=null;r=null},_onPopupWindowResize:function(){this._fixDocumentAreaHeight()},_onPopupWindowOpen:function(){this._fixDocumentAreaHeight()},_onPopupWindowClose:function(){var n=jQuery(document.activeElement);n&&n.blur();this.closeWindow()},_onPopupWindowActivated:function(){var n=this.get_mainComponent();n&&Quantumart.QP8.BackendLibrary.isInstanceOfType(n)&&n.resize()},_onExternalCallerContextsUnbinded:function(n){this.get_popupWindowManager().hostExternalCallerContextsUnbinded(n)},_isContentLoaded:function(){var n=jQuery(this._documentWrapperElement);return n&&n.html()!=""},onDocumentError:function(){this.closeWindow()},_isWindow:function(){return!0},dispose:function(){var n,t,i;Quantumart.QP8.BackendPopupWindow.callBaseMethod(this,"dispose");this._detachPopupWindowEventHandlers();this._breadCrumbsWrapperElement=null;this._toolbarWrapperElement=null;this._actionToolbarWrapperElement=null;this._viewToolbarWrapperElement=null;this._searchBlockWrapperElement=null;this._contextBlockWrapperElement=null;this._documentAreaElement=null;this._documentWrapperElement=null;this._loadingLayerElement&&(n=jQuery(this._loadingLayerElement),n.empty(),n.remove(),n=null,this._loadingLayerElement=null);this.destroyPanels();this.destroySearchBlock();this.destroyContextBlock();this._popupWindowManagerComponent&&(t=this._popupWindowId,$q.isNullOrWhiteSpace(t)||this._popupWindowManagerComponent.removePopupWindow(t),this._popupWindowManagerComponent=null);this._popupWindowComponent&&(i=this._popupWindowComponent,$c.destroyPopupWindow(i),i=null,this._popupWindowComponent=null);this._popupWindowElement=null;this._onPopupWindowResizeHandler=null;this._onPopupWindowOpenHandler=null;this._onPopupWindowCloseHandler=null;this._onPopupWindowActivatedHandler=null}};Quantumart.QP8.BackendPopupWindow.registerClass("Quantumart.QP8.BackendPopupWindow",Quantumart.QP8.BackendDocumentHost);