var EVENT_TYPE_EDITING_AREA_DOCUMENT_LOADING="OnEditingAreaDocumentLoading",EVENT_TYPE_EDITING_AREA_DOCUMENT_LOADED="OnEditingAreaDocumentLoaded",EVENT_TYPE_EDITING_AREA_DOCUMENT_CLOSING="OnEditingAreaDocumentClosing",EVENT_TYPE_EDITING_AREA_DOCUMENT_CLOSED="OnEditingAreaDocumentClosed",EVENT_TYPE_EDITING_AREA_DOCUMENT_ERROR="OnEditingAreaDocumentError",EVENT_TYPE_EDITING_AREA_CLOSED="OnEditingAreaClosed",EVENT_TYPE_EDITING_AREA_ACTION_EXECUTING="OnEditingAreaActionExecuting",EVENT_TYPE_EDITING_AREA_ENTITY_READED="OnEditingAreaEntityReaded",EVENT_TYPE_EDITING_AREA_FIND_TAB_IN_TREE="OnEditingAreaFindTabInTree";Quantumart.QP8.BackendEditingArea=function(n,t){Quantumart.QP8.BackendEditingArea.initializeBase(this);this._hostStateStorage=new Quantumart.QP8.BackendDocumentHostStateStorage({currentCustomerCode:t.currentCustomerCode,currentUserId:t.currentUserId});this._editingAreaElementId=n;this._documents={};this._customVars={};this._customScripts={};$q.isObject(t)&&(t.documentsContainerElementId&&(this._documentsContainerElementId=t.documentsContainerElementId),t.breadCrumbsContainerElementId&&(this._breadCrumbsContainerElementId=t.breadCrumbsContainerElementId),t.actionToolbarContainerElementId&&(this._actionToolbarContainerElementId=t.actionToolbarContainerElementId),t.viewToolbarContainerElementId&&(this._viewToolbarContainerElementId=t.viewToolbarContainerElementId),t.searchBlockContainerElementId&&(this._searchBlockContainerElementId=t.searchBlockContainerElementId),t.contextBlockContainerElementId&&(this._contextBlockContainerElementId=t.contextBlockContainerElementId),t.documentsContainerHeightDifference&&(this._documentsContainerHeightDifference=t.documentsContainerHeightDifference),t.tabStrip&&(this._tabStrip=t.tabStrip,this._onTabStripCloseRequestHandler=jQuery.proxy(this.onTabStripCloseRequest,this),this._onTabStripSelectRequestHandler=jQuery.proxy(this.onTabStripSelectRequest,this),this._tabStrip.attachObserver(EVENT_TYPE_TAB_STRIP_TAB_CLOSE_REQUEST,this._onTabStripCloseRequestHandler),this._tabStrip.attachObserver(EVENT_TYPE_TAB_STRIP_TAB_SELECT_REQUEST,this._onTabStripSelectRequestHandler),this._tabStrip.attachObserver(EVENT_TYPE_TAB_STRIP_TAB_SAVE_CLOSE_REQUEST,jQuery.proxy(this.onTabStripSaveAndCloseRequest,this)),this._tabStrip.attachObserver(EVENT_TYPE_TAB_STRIP_FIND_IN_TREE_REQUEST,jQuery.proxy(this.onFindTabInTreeRequest,this))));this._onWindowResizedHandler=jQuery.proxy(this.onWindowResized,this)};Quantumart.QP8.BackendEditingArea.prototype={_editingAreaElementId:"",_editingAreaElement:null,_documentsContainerElementId:"",_documentsContainerElement:null,_loadingLayerElement:null,_documentsContainerHeightDifference:0,_selectedDocumentId:"",_breadCrumbsContainerElementId:"",_breadCrumbsContainerElement:null,_actionToolbarContainerElementId:"",_actionToolbarContainerElement:null,_viewToolbarContainerElementId:"",_viewToolbarContainerElement:null,_searchBlockContainerElementId:"",_searchBlockContainerElement:null,_contextBlockContainerElementId:"",_contextBlockContainerElement:null,_documents:null,_tabStrip:null,_hostStateStorage:null,_customVars:null,_customScripts:null,_onWindowResizedHandler:null,get_editingAreaElementId:function(){return this._editingAreaElementId},set_editingAreaElementId:function(n){this._editingAreaElementId=n},get_documentsContainerElementId:function(){return this._documentsContainerElementId},set_documentsContainerElementId:function(n){this._documentsContainerElementId=n},get_documentsContainerElement:function(){return this._documentsContainerElement},get_documentsContainerHeightDifference:function(){return this._documentsContainerHeightDifference},set_documentsContainerHeightDifference:function(n){this._documentsContainerHeightDifference=n},get_breadCrumbsContainerElementId:function(){return this._breadCrumbsContainerElementId},set_breadCrumbsContainerElementId:function(n){this._breadCrumbsContainerElementId=n},get_breadCrumbsContainerElement:function(){return this._breadCrumbsContainerElement},get_actionToolbarContainerElementId:function(){return this._actionToolbarContainerElementId},set_actionToolbarContainerElementId:function(n){this._actionToolbarContainerElementId=n},get_actionToolbarContainerElement:function(){return this._actionToolbarContainerElement},get_viewToolbarContainerElementId:function(){return this._viewToolbarContainerElementId},set_viewToolbarContainerElementId:function(n){this._viewToolbarContainerElementId=n},get_viewToolbarContainerElement:function(){return this._viewToolbarContainerElement},get_searchBlockContainerElementId:function(){return this._searchBlockContainerElementId},set_searchBlockContainerElementId:function(n){this._searchBlockContainerElementId=n},get_searchBlockContainerElement:function(){return this._searchBlockContainerElement},get_tabStrip:function(){return this._tabStrip},set_tabStrip:function(n){this._tabStrip=n},get_contextBlockContainerElementId:function(){return this._contextBlockContainerElementId},set_contextBlockContainerElementId:function(n){this._contextBlockContainerElementId=n},get_contextBlockContainerElement:function(){return this._contextBlockContainerElement},set_contextBlockContainerElement:function(n){this._contextBlockContainerElement=n},get_documents:function(){return this._documents},initialize:function(){if(!this._documentsContainerElementId)throw new Error($l.EditingArea.documentsContainerElementIdNotSpecified);if(!this._breadCrumbsContainerElementId)throw new Error($l.EditingArea.breadCrumbsContainerElementIdNotSpecified);if(!this._actionToolbarContainerElementId)throw new Error($l.EditingArea.actionToolbarContainerElementIdNotSpecified);if(!this._viewToolbarContainerElementId)throw new Error($l.EditingArea.viewToolbarContainerElementIdNotSpecified);if(!this._searchBlockContainerElementId)throw new Error($l.EditingArea.searchBlockContainerElementIdNotSpecified);if(!this._contextBlockContainerElementId)throw new Error($l.EditingArea.contextBlockContainerElementIdNotSpecified);var i=jQuery("#"+this._editingAreaElementId),n=jQuery("#"+this._documentsContainerElementId),t=jQuery("<div />",{"class":"loadingLayer",css:{display:"none"}}),r=jQuery(this._breadCrumbsContainerElementId),u=jQuery("#"+this._actionToolbarContainerElementId),f=jQuery("#"+this._viewToolbarContainerElementId),e=jQuery("#"+this._searchBlockContainerElementId),o=jQuery("#"+this._contextBlockContainerElementId);n.prepend(t);this._editingAreaElement=i.get(0);this._documentsContainerElement=n.get(0);this._breadCrumbsContainerElement=r.get(0);this._actionToolbarContainerElement=u.get(0);this._viewToolbarContainerElement=f.get(0);this._searchBlockContainerElement=e.get(0);this._contextBlockContainerElement=o.get(0);this._loadingLayerElement=t.get(0);jQuery(window).resize(this._onWindowResizedHandler)},fixDocumentsContainerHeight:function(n){if(!n||n.bySplitter!=!0){var i=jQuery(this._documentsContainerElement),r=parseInt(i.height()),t=parseInt(jQuery(window).height())-this._documentsContainerHeightDifference;r!=t&&(t<300&&(t=300),i.css("height",t+"px"));i=null}},openArea:function(){var n=jQuery(this._editingAreaElement);n.css("display","block");n=null},closeArea:function(){var t=jQuery(this._editingAreaElement),n;t.css("display","none");t=null;n=jQuery(this._documentsContainerElement);n.find("DIV.documentWrapper").empty().remove();n=null;this._selectedDocumentId="";this.notify(EVENT_TYPE_EDITING_AREA_CLOSED,new Quantumart.QP8.BackendEditingAreaEventArgs)},getDocumentIdByTabId:function(n){return String.format("{0}_document",n)},getExistingTabId:function(n){return this._tabStrip.getExistingTabId(n)},getSelectedDocument:function(){return this.getDocument(this._selectedDocumentId)},getSelectedDocumentId:function(){return this._selectedDocumentId},getDocument:function(n){return $q.isNullOrWhiteSpace(n)?null:this._documents[n]},getDocumentByEventArgs:function(n){var t=this.getExistingTabId(n),i=this.getDocumentIdByTabId(t);return this.getDocument(i)},addDocument:function(n){var u,t,i,r,f,e;if(!n.get_isWindow())if(t=this.getExistingTabId(n),t!=0){if((jQuery.isEmptyObject(n.get_context())||!n.get_context().ctrlKey)&&(u=this.selectDocument(t),u))u.onSelectedThroughExecution(n)}else this.onDocumentLoading(),this._tabStrip.getAllTabsCount()==0&&this.openArea(),t=this._tabStrip.addNewTab(n),i=this.getSelectedDocument(),i&&(i.hidePanels(),i.hideDocumentWrapper()),r=new Quantumart.QP8.BackendEditingDocument(t,this,n,{hostStateStorage:this._hostStateStorage}),f=r.get_id(),this._documents[f]=r,this._selectedDocumentId=f,e=this,r.initialize(function(){e.onDocumentLoaded(e._selectedDocumentId)}),n.get_context()&&n.get_context().ctrlKey&&this.selectDocument(this._tabStrip._previousSelectedTabId)},selectDocument:function(n){var i=this.getDocumentIdByTabId(n),t=this.getDocument(i),r=this.getSelectedDocument();if(t!=null){this.onDocumentLoading(i);r!=null&&(r.hidePanels(),r.hideDocumentWrapper());this._tabStrip.selectTab(n);this._selectedDocumentId=i;t.showPanels();t.showDocumentWrapper();t.onSelectMainComponent();this.onDocumentLoaded(i);return t}},removeDocument:function(n){this._selectedDocumentId==n&&(this._selectedDocumentId="");$q.removeProperty(this._documents,n)},destroyDocument:function(n){var t=this._documents[n];t!=null&&(t.dispose&&t.dispose(),t=null)},updateTab:function(n,t){this._tabStrip.updateTab(n,t)},showAjaxLoadingLayer:function(){var n=jQuery(this._loadingLayerElement);n.show()},hideAjaxLoadingLayer:function(){var n=jQuery(this._loadingLayerElement);n.hide()},raiseEvent:function(n,t){var i=new Quantumart.QP8.BackendEditingAreaEventArgs,r=this.getDocument(t);$q.isObject(r)&&(Quantumart.QP8.BackendEventArgs.fillEventArgsFromOtherEventArgs(i,r.getEventArgs()),i.set_documentId(t),i.set_isSelected(r.isSelected()));this.notify(n,i);i=null},markAsBusy:function(){this._tabStrip.markAsBusy();for(var n in this._documents)this._documents[n].markPanelsAsBusy()},unmarkAsBusy:function(){this._tabStrip.unmarkAsBusy();for(var n in this._documents)this._documents[n].unmarkPanelsAsBusy()},onDocumentError:function(n){this.unmarkAsBusy();this.raiseEvent(EVENT_TYPE_EDITING_AREA_DOCUMENT_ERROR,n)},onDocumentLoading:function(n,t){this.markAsBusy();t||this.raiseEvent(EVENT_TYPE_EDITING_AREA_DOCUMENT_LOADING,n)},onDocumentLoaded:function(n,t){this.unmarkAsBusy();t||this.raiseEvent(EVENT_TYPE_EDITING_AREA_DOCUMENT_LOADED,n)},onDocumentClosing:function(n){this.markAsBusy();this.raiseEvent(EVENT_TYPE_EDITING_AREA_DOCUMENT_CLOSING,n)},onDocumentClosed:function(n){this.unmarkAsBusy();this.raiseEvent(EVENT_TYPE_EDITING_AREA_DOCUMENT_CLOSED,n)},onActionExecuting:function(n){this.notify(EVENT_TYPE_EDITING_AREA_ACTION_EXECUTING,n)},onEntityReaded:function(n){this.notify(EVENT_TYPE_EDITING_AREA_ENTITY_READED,n)},onActionExecuted:function(n){var i,r,t;if(n.get_entityTypeCode()==ENTITY_TYPE_CODE_FIELD&&(i=n.get_context()&&n.get_context().viewInListAffected,n.get_isRemoving()||i&&(n.get_isUpdated()||n.get_isSaved())))for(r in this._documents)t=this._documents[r],t.get_entityTypeCode()==ENTITY_TYPE_CODE_ARTICLE&&t.get_actionTypeCode()==ACTION_TYPE_CODE_LIST&&t.get_parentEntityId()==n.get_parentEntityId()&&t.refresh();(n.get_isRemoving()||n.get_isArchiving()||n.get_isRestoring())&&this.closeNonExistentDocuments();n.get_isUpdated()?this._tabStrip.updateParentInfo(n.get_entityTypeCode(),n.get_entityId()):n.get_isRestored()&&n.get_entityTypeCode()==ENTITY_TYPE_CODE_ARTICLE_VERSION?this._tabStrip.updateParentInfo(ENTITY_TYPE_CODE_ARTICLE,n.get_parentEntityId()):n.get_actionTypeCode()==ACTION_TYPE_SIMPLE_UPDATE&&this.getSelectedDocument().refresh()},onTabStripCloseRequest:function(n,t,i){this.closeDocument(i.get_tabId(),!1)},onTabStripSaveAndCloseRequest:function(n,t,i){var u=this.getDocumentIdByTabId(i.get_tabId()),r=this.getDocument(u);!r||r.saveAndCloseRequest(i)},onTabStripSelectRequest:function(n,t,i){this.selectDocument(i.get_tabId())},onFindTabInTreeRequest:function(n,t,i){n===EVENT_TYPE_TAB_STRIP_FIND_IN_TREE_REQUEST&&this.notify(EVENT_TYPE_EDITING_AREA_FIND_TAB_IN_TREE,i)},onWindowResized:function(n,t){this.fixDocumentsContainerHeight(t)},closeNonExistentDocuments:function(){var n=this,t=this._tabStrip.getAllTabs();t.each(function(i){var r=t.eq(i);n._tabStrip.tabEntityExists(r)||n.closeDocument(n._tabStrip.getTabId(r),!0)});t=null},closeDocument:function(n,t,i){var e=this._tabStrip.getTab(n),u=this.getDocumentIdByTabId(n),r=this.getDocument(u),f,o;if(t||r.allowClose()){this.onDocumentClosing(u);f=this._tabStrip.getAnotherTabToSelect(e);o=r.isSelected();r.markMainComponentAsBusy();i||r.cancel();r.onDocumentUnloaded();this._tabStrip.closeTab(n);this._tabStrip.getAllTabsCount()==0&&this.closeArea();r.unbindExternalCallerContexts("closed");this.onDocumentClosed(u);this.destroyDocument(u);o&&!$q.isNullOrEmpty(f)&&this.selectDocument(this._tabStrip.getTabId(f))}e=null},onCloseHostMessageReceived:function(n){var i=this.get_documents(),r,t;for(r in i)t=i[r],jQuery.grep(t.get_externalCallerContexts(),function(t){return t.hostUID==n.hostUID&&t.data.actionUID==n.data.actionUID}).length>0&&this.closeDocument(t.get_tabId())},hostExternalCallerContextsUnbinded:function(n){this.notify(EVENT_TYPE_HOST_EXTERNAL_CALLER_CONTEXTS_UNBINDED,n)},getGlobal:function(n){return this._customVars[n]},setGlobal:function(n,t){this._customVars[n]=t},getCustomScriptState:function(n){return this._customScripts[n]},setCustomScriptState:function(n,t){this._customScripts[n]=t},dispose:function(){var i,n,t;if(Quantumart.QP8.BackendEditingArea.callBaseMethod(this,"dispose"),this._documents)for(i in this._documents)this.destroyDocument(i);this._loadingLayerElement&&(n=jQuery(this._loadingLayerElement),n.empty(),n.remove(),n=null,this._loadingLayerElement=null);this._documentsContainerElement!=null&&(t=jQuery(this._documentsContainerElement),t.empty(),t=null,this._documentsContainerElement=null);this._breadCrumbsContainerElement=null;this._actionToolbarContainerElement=null;this._viewToolbarContainerElement=null;this._searchBlockContainerElement=null;this._contextBlockContainerElement=null;this._editingAreaElement=null;this._tabStrip!=null&&(this._tabStrip.detachObserver(EVENT_TYPE_TAB_STRIP_TAB_CLOSE_REQUEST),this._tabStrip.detachObserver(EVENT_TYPE_TAB_STRIP_TAB_SELECT_REQUEST),this._tabStrip.detachObserver(EVENT_TYPE_TAB_STRIP_TAB_SAVE_CLOSE_REQUEST),this._tabStrip.detachObserver(EVENT_TYPE_TAB_STRIP_FIND_IN_TREE_REQUEST));this._tabStrip=null;jQuery(window).unbind("resize",this._onWindowResizedHandler);this._onWindowResizedHandler=null;this._hostStateStorage&&(this._hostStateStorage.dispose(),this._hostStateStorage=null);Quantumart.QP8.BackendEditingArea._instance=null;$q.collectGarbageInIE()}};Quantumart.QP8.BackendEditingArea._instance=null;Quantumart.QP8.BackendEditingArea.getInstance=function(n,t){if(Quantumart.QP8.BackendEditingArea._instance==null){var i=new Quantumart.QP8.BackendEditingArea(n,t);i.initialize();Quantumart.QP8.BackendEditingArea._instance=i}return Quantumart.QP8.BackendEditingArea._instance};Quantumart.QP8.BackendEditingArea.destroyInstance=function(){Quantumart.QP8.BackendEditingArea._instance&&Quantumart.QP8.BackendEditingArea._instance.dispose()};Quantumart.QP8.BackendEditingArea.registerClass("Quantumart.QP8.BackendEditingArea",Quantumart.QP8.Observable);Quantumart.QP8.BackendEditingAreaEventArgs=function(){Quantumart.QP8.BackendEditingAreaEventArgs.initializeBase(this)};Quantumart.QP8.BackendEditingAreaEventArgs.prototype={_documentId:null,_isSelected:!1,get_documentId:function(){return _documentId},set_documentId:function(n){_documentId=n},get_isSelected:function(){return _isSelected},set_isSelected:function(n){_isSelected=n}};Quantumart.QP8.BackendEditingAreaEventArgs.registerClass("Quantumart.QP8.BackendEditingAreaEventArgs",Quantumart.QP8.BackendEventArgs);