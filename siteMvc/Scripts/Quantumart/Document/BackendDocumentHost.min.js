var DOCUMENT_HOST_TYPE_EDITING_DOCUMENT=1,DOCUMENT_HOST_TYPE_POPUP_WINDOW=2,EVENT_TYPE_HOST_EXTERNAL_CALLER_CONTEXTS_UNBINDED="onHostExternalCallerContextsUnbinded";Quantumart.QP8.BackendDocumentHost=function(n,t){Quantumart.QP8.BackendDocumentHost.initializeBase(this);$q.isObject(n)&&(this._startedByExternal=n.get_startedByExternal());$q.isObject(t)&&t.hostStateStorage&&(this._hostStateStorage=t.hostStateStorage);this._externalCallerContexts=[];this._onSearchHandler=jQuery.proxy(this.onSearch,this);this._onContextSwitchingHandler=jQuery.proxy(this.onContextSwitching,this);this._onSearchBlockResizeHandler=jQuery.proxy(this.onSearchBlockResize,this);this._onGeneralEventHandler=jQuery.proxy(this.onGeneralEvent,this)};Quantumart.QP8.BackendDocumentHost.prototype={_documentWrapperElementId:"",_documentWrapperElement:null,_documentUrl:"",_documentPostParams:null,_documentContext:null,_entityTypeCode:"",_entityId:0,_entityName:"",_parentEntityId:0,_isMultipleEntities:!1,_entities:null,_actionCode:"",_actionTypeCode:"",_isCustomAction:!1,_breadCrumbsComponent:null,_actionToolbarComponent:null,_useCustomActionToolbar:!1,_viewToolbarComponent:null,_searchBlockComponent:null,_oldSearchBlockHeight:0,_isContextBlockVisible:!1,_selectedEntities:null,_selectedParentEntityId:0,_filter:"",_hostStateStorage:null,_callerContext:null,_externalCallerContexts:null,_eventArgsAdditionalData:null,_selectedEntitiesContext:null,_onSearchHandler:null,_onContextSwitchingHandler:null,_onSearchBlockResizeHandler:null,_onGeneralEventHandler:null,_startedByExternal:!1,_isCloseForced:!1,_unnamedEntitiesLimit:1e3,get_documentWrapperElementId:function(){return this._documentWrapperElementId},get_documentWrapperElement:function(){return this._documentWrapperElement},get_documentUrl:function(){return this._documentUrl},get_selectedEntities:function(){return this._selectedEntities},get_filter:function(){return this._filter},get_hostType:$c.notImplemented,get_zIndex:$c.notImplemented,get_documentContext:function(){return this._documentContext},set_documentContext:function(n){this._documentContext=n},get_entityTypeCode:function(){return this._entityTypeCode},set_entityTypeCode:function(n){this._entityTypeCode=n},get_entityId:function(){return this._entityId},set_entityId:function(n){this._entityId=n},get_entityName:function(){return this._entityName},set_entityName:function(n){this._entityName=n},get_parentEntityId:function(){return this._parentEntityId},set_parentEntityId:function(n){this._parentEntityId=n},get_isMultipleEntities:function(){return this._isMultipleEntities},set_isMultipleEntities:function(n){this._isMultipleEntities=n},get_isCustomAction:function(){return this._isCustomAction},set_isCustomAction:function(n){this._isCustomAction=n},get_entities:function(){return this._entities},set_entities:function(n){this._entities=n},get_actionCode:function(){return this._actionCode},set_actionCode:function(n){this._actionCode=n},get_actionTypeCode:function(){return this._actionTypeCode},set_actionTypeCode:function(n){this._actionTypeCode=n},get_externalCallerContexts:function(){return this._externalCallerContexts},get_eventArgsAdditionalData:function(){return this._eventArgsAdditionalData},set_eventArgsAdditionalData:function(n){this._eventArgsAdditionalData=n},_applyEventArgs:function(n,t){$q.isObject(n)&&(this.set_entityTypeCode(n.get_entityTypeCode()),this.set_entityId(n.get_entityId()),this.set_entityName(n.get_entityName()),this.set_parentEntityId(n.get_parentEntityId()),this.set_isMultipleEntities(n.get_isMultipleEntities()),this.set_isCustomAction(n.get_isCustomAction()),this.set_entities(n.get_entities()),this.set_actionCode(n.get_actionCode()),this.set_actionTypeCode(n.get_actionTypeCode()),this.set_eventArgsAdditionalData(n.get_additionalData()),t&&(this._callerContext=n.get_callerContext()))},_getAppliedEventArgs:function(){var n=new Quantumart.QP8.BackendEventArgs;return n.set_entityTypeCode(this.get_entityTypeCode()),n.set_entityId(this.get_entityId()),n.set_entityName(this.get_entityName()),n.set_parentEntityId(this.get_parentEntityId()),n.set_isMultipleEntities(this.get_isMultipleEntities()),n.set_isCustomAction(this.get_isCustomAction()),n.set_entities(this.get_entities()),n.set_actionCode(this.get_actionCode()),n.set_actionTypeCode(this.get_actionTypeCode()),n.set_additionalData(this.get_eventArgsAdditionalData()),n},bindExternalCallerContext:function(n){if(n){var t=n.get_externalCallerContext();t&&jQuery.grep(this._externalCallerContexts,function(n){return n.hostUID==t.hostUID}).length==0&&this._externalCallerContexts.push(t)}},unbindExternalCallerContexts:function(n){var t=this._externalCallerContexts;this._externalCallerContexts=[];$q.isNullOrEmpty(t)||this._onExternalCallerContextsUnbinded({reason:n,externalCallerContexts:t});n!="close"&&$q.isFunction(this._actionToolbarComponent.getDisabledActionCodes)&&!$q.isNullOrEmpty(this._actionToolbarComponent.getDisabledActionCodes())&&(this.hidePanels(),this._actionToolbarComponent.setDisabledActionCodes(null),this.renderPanels());t=null},get_isBindToExternal:function(){return!$q.isNullOrEmpty(this._externalCallerContexts)},_onExternalCallerContextsUnbinded:$c.notImplemented,loadHostState:function(){if(this._hostStateStorage)return this._hostStateStorage.loadHostState({entityId:this.get_entityId(),parentEntityId:this.get_parentEntityId(),actionCode:this.get_actionCode()})},getHostStateProp:function(n){var t=this.loadHostState();if(t&&t.hasOwnProperty(n))return t[n]},saveHostState:function(n){this._hostStateStorage&&this._hostStateStorage.saveHostState({entityId:this.get_entityId(),parentEntityId:this.get_parentEntityId(),actionCode:this.get_actionCode()},n)},fixActionToolbarWidth:function(){var n=jQuery(this._actionToolbarComponent.get_toolbarElement()).parents("#actionToolbar"),t=jQuery(this._viewToolbarComponent.get_toolbarElement()).parents("#viewToolbar");n.width(n.parents("#toolbar").width()-t.width()-t.paddingLeft()-n.paddingRight()-1)},restoreHostState:function(){var n=this.loadHostState();$q.isNullOrEmpty(n)||jQuery.isEmptyObject(n.searchBlockState)&&this.get_isSearchBlockVisible()!==!0||(this._searchBlockComponent||(this.createSearchBlock(),this._searchBlockComponent.renderSearchBlock()),this.get_isSearchBlockVisible()===!0&&this.documentWrapperIsVisible()?this._searchBlockComponent.showSearchBlock():this._searchBlockComponent.hideSearchBlock())},_loadDefaultSearchBlockState:function(){var n,t,i;if($q.isNullOrEmpty(this.loadHostState())&&(t=this.get_actionTypeCode(),i=this.get_entityTypeCode(),(t==ACTION_TYPE_CODE_LIST||t==ACTION_TYPE_CODE_SELECT||t==ACTION_TYPE_CODE_MULTIPLE_SELECT)&&(i==ENTITY_TYPE_CODE_ARTICLE||i==ENTITY_TYPE_CODE_VIRTUAL_ARTICLE)&&$q.getJsonFromUrl("GET",CONTROLLER_URL_ARTICLE_SEARCH_BLOCK+"DefaultFilterStates",{actionCode:this.get_actionCode(),contentId:this.get_parentEntityId()},!1,!1,function(t){t.success?n=t.filterStates:alert(t.message)},function(t){n=null;$q.processGenericAjaxError(t)}),!$q.isNullOrEmpty(n)&&$q.isArray(n))){var r=jQuery.map(n,function(n){return new Quantumart.QP8.BackendArticleSearchBlock.FieldSearchState(n.SearchType,n.FieldId,n.ContentId,n.FieldColumnName,n.FieldName,n.FieldGroup,{entities:n.SelectedEntities})}),f=jQuery.map(n,function(n){var t=jQuery.map(n.SelectedEntities,function(n){return n.Id});return new Quantumart.QP8.BackendArticleSearchBlock.createFieldSearchQuery(n.SearchType,n.FieldId,n.FieldColumnName,null,t,!1,!1)}),u={searchBlockState:{fieldSearchBlockState:r,defaultFieldSearchBlockState:r},searchQuery:JSON.stringify(f)};return this.saveHostState(u),u}},showDocumentWrapper:function(){var n=jQuery(this._documentWrapperElement);n.show();n=null},hideDocumentWrapper:function(){var n=jQuery(this._documentWrapperElement);n.hide();n=null},documentWrapperIsVisible:function(){var n=jQuery(this._documentWrapperElement),t=n.is(":visible");return n=null,t},executeAction:function(n){var t=$a.getBackendActionByCode(n),s,r,e,w,b,o,a,v,u,h,c;if(t==null)alert($l.Common.ajaxDataReceivingErrorMessage);else{var y=this._entityId,p=this._entityName,l=t.ActionType.IsMultiple,k=Quantumart.QP8.BackendEntityEditor.isInstanceOfType(this.get_mainComponent()),d=Quantumart.QP8.BackendCustomActionHost.isInstanceOfType(this.get_mainComponent()),g=!k&&!d?this._selectedEntities:[{Id:this._entityId,Name:this._entityName}],i=l?this._isMultipleEntities?Array.clone(this._entities):g:null,f=t.ActionType.Code;if(l){if(s=this._filterEntities(i),s.length!=i.length&&(i=s),s=null,i.length==0){alert($l.DocumentHost.noEntitiesToExecuteActionErrorMessage);this.refresh();return}if(r=jQuery.grep(i,function(n){return!n.Name}),r.length>0&&r.length<=this._unnamedEntitiesLimit)e=this._entityTypeCode,e==ENTITY_TYPE_CODE_CONTENT_PERMISSION?e=ENTITY_TYPE_CODE_CONTENT:e==ENTITY_TYPE_CODE_ARTICLE_PERMISSION&&(e=ENTITY_TYPE_CODE_ARTICLE),w=$o.getSimpleEntityList(e,this._parentEntityId,0,0,Quantumart.QP8.Enums.ListSelectionMode.OnlySelectedItems,$o.getEntityIDsFromEntities(r)),b=jQuery.map(w,function(n){return{Id:$q.toInt(n.Value),Name:n.Text}}),jQuery.each(b,function(n,t){for(var u,r=0;r<i.length;r++)if(u=i[r],u.Id==t.Id){u.Name=t.Name;break}});else if(r.length>this._unnamedEntitiesLimit)for(o=0;o<r.length;o++)r[o].Name=r[o].Id}if(l||this._actionTypeCode!=ACTION_TYPE_CODE_LIST&&this._actionTypeCode!=ACTION_TYPE_CODE_LIBRARY||this._selectedEntities.length!=1||(y=this._selectedEntities[0].Id,p=this._selectedEntities[0].Name),a=t.IsCustom,v=t.IsMultistep,a||v||f!=ACTION_TYPE_CODE_REFRESH)if(a||v||f!=ACTION_TYPE_CODE_SAVE&&f!=ACTION_TYPE_CODE_UPDATE&&f!=ACTION_TYPE_CHILD_ENTITY_PERMISSION_SAVE&&f!=ACTION_TYPE_CODE_SAVE_AND_UP&&f!=ACTION_TYPE_CODE_UPDATE_AND_UP&&(f!=ACTION_TYPE_CODE_RESTORE||t.EntityType.Code!=ENTITY_TYPE_CODE_ARTICLE_VERSION)){h=new Quantumart.QP8.BackendActionParameters({entityTypeCode:this._entityTypeCode,parentEntityId:this._selectedParentEntityId||this._parentEntityId,entities:i,entityId:y,entityName:p,forceOpenWindow:this._isWindow()});h.correct(t);c=$a.getEventArgsFromActionWithParams(t,h);c.set_startedByExternal(this._startedByExternal);this.onActionExecuting(c);h=null;c=null}else u=this.get_mainComponent(),u!=null&&Quantumart.QP8.BackendEntityEditor.isInstanceOfType(u)&&u.saveEntity(n);else u=this.get_mainComponent(),(u==null||!Quantumart.QP8.BackendEntityEditor.isInstanceOfType(u)||u.confirmRefresh())&&this.refresh()}},_filterEntities:function(n){var i,t;if(this._selectedEntitiesContext){for(i=jQuery.extend({page:1,size:0,onlyIds:!0},this._selectedEntitiesContext.dataQueryParams),t=0;t<n.length;t++)i["filterIds["+t+"]"]=n[t].Id;return rowsData=null,eventArgs=null,$q.postDataToUrl(this._selectedEntitiesContext.url,i,!1,function(n){rowsData=n},function(n){$q.processGenericAjaxError(n)}),jQuery.map(rowsData.data,function(n){return{Id:n.CONTENT_ITEM_ID}})}return n},get_mainComponent:function(){return $q.isObject(this._documentContext)?this._documentContext.get_mainComponent():null},get_viewTypeCode:function(){return this._viewToolbarComponent?this._viewToolbarComponent.getSelectedViewTypeCode():""},get_searchQuery:function(){var t="",n;return this._searchBlockComponent?t=this._searchBlockComponent.get_searchQuery():(n=this.loadHostState(),$q.isNullOrEmpty(n)||$q.isNullOrWhiteSpace(n.searchQuery)||(t=n.searchQuery)),t},get_contextQuery:function(){var n="";return this._contextBlockComponent?n=this._contextBlockComponent.get_searchQuery():this._eventArgsAdditionalData&&(n=this._eventArgsAdditionalData.contextQuery),n},get_contextState:function(){var n=this.get_contextQuery();return $q.isNullOrEmpty(n)?null:JSON.parse(n)},get_currentPage:function(){var t=this.get_mainComponent(),n;return t&&Quantumart.QP8.BackendEntityGrid.isInstanceOfType(t)?t.get_currentPage():(n=this.loadHostState(),!$q.isNullOrEmpty(n)&&!$q.isNullOrWhiteSpace(n.gridCurrentPage))?n.gridCurrentPage:void 0},get_orderBy:function(){var t=this.get_mainComponent(),n;return t&&Quantumart.QP8.BackendEntityGrid.isInstanceOfType(t)?t.get_orderBy():(n=this.loadHostState(),!$q.isNullOrEmpty(n)&&!$q.isNullOrWhiteSpace(n.gridOrderBy))?n.gridOrderBy:void 0},markPanelsAsBusy:function(){this.showLoadingLayer();this._breadCrumbsComponent&&this._breadCrumbsComponent.markBreadCrumbsAsBusy();this._actionToolbarComponent&&this._actionToolbarComponent.markToolbarAsBusy();this._viewToolbarComponent&&this._viewToolbarComponent.markToolbarAsBusy()},unmarkPanelsAsBusy:function(n){this._breadCrumbsComponent&&this._breadCrumbsComponent.unmarkBreadCrumbsAsBusy();this._actionToolbarComponent&&this._actionToolbarComponent.unmarkToolbarAsBusy();this._viewToolbarComponent&&this._viewToolbarComponent.unmarkToolbarAsBusy();this.hideLoadingLayer(n)},showLoadingLayer:$c.notImplemented,hideLoadingLayer:$c.notImplemented,onChangeContent:$c.notImplemented,onActionExecuting:$c.notImplemented,onEntityReaded:$c.notImplemented,onNeedUp:$c.notImplemented,htmlLoadingMethod:$c.notImplemented,resetSelectedEntities:$c.notImplemented,saveSelectionContext:$c.notImplemented,showErrorMessageInDocumentWrapper:$c.notImplemented,_onLibraryResized:$c.notImplemented,loadHtmlContentToDocumentWrapper:function(n,t){var i=this,r=!0;t&&(r=t.asyncReq);$q.getJsonFromUrl(this.htmlLoadingMethod(),this._documentUrl,this._documentPostParams,r,!1,function(t){i.loadReadyHtmlContent(t);Quantumart.QP8.Utils.isFunction(n)&&n(t.success);t=null},function(t){i.onDocumentError();Quantumart.QP8.Utils.isFunction(n)&&n(!1);$q.processGenericAjaxError(t);i.showErrorMessageInDocumentWrapper(t.status)})},_saveSelectedEntitiesContext:function(n){this._selectedEntitiesContext=n.get_context()},refresh:function(){this.onDocumentChanging();this.resetSelectedEntities();this.refreshPanels();this.generateDocumentUrl();var n=this;this.loadHtmlContentToDocumentWrapper(function(){jQuery(n._documentWrapperElement).scrollTo(0);n.onDocumentChanged()})},changeView:function(n){this.onDocumentChanging();this.generateDocumentUrl({controllerActionUrl:n});var t=this;this.loadHtmlContentToDocumentWrapper(function(){jQuery(t._documentWrapperElement).scrollTo(0);t.onDocumentChanged()})},changeViewForSettings:function(n){this.onDocumentChanging();this.generateDocumentUrl(n);var t=this;this.loadHtmlContentToDocumentWrapper(function(){jQuery(t._documentWrapperElement).scrollTo(0);t.onDocumentChanged()})},changeContent:function(n,t){var r,u,i;this.allowChange()&&(this.onDocumentChanging(),this.markMainComponentAsBusy(),t||this.cancel(),this._copyContextQueryToEventArgs(n),r=this._getAppliedEventArgs(),u=this._externalCallerContexts,this._externalCallerContexts=[],this.updateDocument(n),this._externalCallerContexts=u,i=this,this._loadDefaultSearchBlockState(),this.loadHtmlContentToDocumentWrapper(function(n){i.unmarkMainComponentAsBusy();n?i.unbindExternalCallerContexts("changed"):i.updateDocument(r);jQuery(i._documentWrapperElement).scrollTo(0);i.onDocumentChanged()}))},updateDocument:function(n){var t=this.get_actionCode(),i=n.get_actionCode();this._applyEventArgs(n);this.generateDocumentUrl();this.updateTitle(n);t!=i&&(this.hidePanels(),this.destroySearchBlock(),this.destroyContextBlock(),this.renderPanels())},_fixDocumentWrapperHeight:function(n){var r=jQuery(this._documentWrapperElement),f=parseInt(r.height(),10),i=this._oldSearchBlockHeight,t=i,u;$q.isNull(n)||(t=n);u=0;u=t>i?f-(t-i):f+(i-t);r.height(u);this._oldSearchBlockHeight=t;r=null},loadReadyHtmlContent:function(n){var t=jQuery(this._documentWrapperElement),i=t.is(":visible"),r;n.success?(r=t.data("scroll_position"),this.onDocumentUnloaded(),t.data("scroll_position",r),i&&t.hide(),t.empty().html(n.view),i&&t.show(),this.onDocumentLoaded()):(alert(n.message),this.onDocumentError())},onLoadMainComponent:function(){var n=this.get_mainComponent();n&&(Quantumart.QP8.BackendEntityEditor.isInstanceOfType(n)?n.onLoad():Quantumart.QP8.BackendLibrary.isInstanceOfType(n)?(n.attachObserver(EVENT_TYPE_LIBRARY_RESIZED,jQuery.proxy(this._onLibraryResized,this)),n.onLoad()):Quantumart.QP8.BackendEntityGrid.isInstanceOfType(n)&&n.onLoad())},onSelectMainComponent:function(){var n=this.get_mainComponent();n&&(Quantumart.QP8.BackendEntityEditor.isInstanceOfType(n)?n.onSelect():Quantumart.QP8.BackendLibrary.isInstanceOfType(n)?n.resize():Quantumart.QP8.BackendCustomActionHost.isInstanceOfType(n)&&n.onSelect())},onSelectedThroughExecution:function(n){this.bindExternalCallerContext(n);this.renderPanels();this._documentContext&&this._documentContext.execSelect(n)},unmarkMainComponentAsBusy:function(){var n=this.get_mainComponent();n&&Quantumart.QP8.BackendEntityGrid.isInstanceOfType(n)&&n.unmarkGridAsBusy()},markMainComponentAsBusy:function(){var n=this.get_mainComponent();n&&Quantumart.QP8.BackendEntityGrid.isInstanceOfType(n)&&n.markGridAsBusy()},onSearchBlockResize:function(n,t,i){this._fixDocumentWrapperHeight(i.get_searchBlockHeight())},onContextSwitching:function(n,t,i){var r=this.get_mainComponent();r&&(Quantumart.QP8.BackendEntityGrid.isInstanceOfType(r)?r.resetGrid({contextQuery:i.get_searchQuery()}):Quantumart.QP8.BackendEntityEditor.isInstanceOfType(r)&&r.applyContext(i.get_searchBlockState()))},_getComponentSearchProcessor:function(n){var t=this.get_mainComponent(),i=Quantumart.QP8.BackendEntityGrid.isInstanceOfType(t),r=Quantumart.QP8.BackendEntityTree.isInstanceOfType(t);if(t&&(i||r)){if($q.isNullOrEmpty(n.state.searchBlockState)?$q.removeProperty(n.state,"searchQuery"):n.state.searchQuery=n.searchQuery(),i)return{process:function(){t.resetGrid({searchQuery:n.searchQuery()})}};if(r)return{process:function(){t.searchByTerm({searchQuery:n.searchQuery()})}};throw new Error("Undefined search processor");}},onSearch:function(n,t,i){var r=this.loadHostState()||{},u=i.get_searchBlockState();$q.isNullOrEmpty(u)?$q.removeProperty(r,"searchBlockState"):r.searchBlockState=u;this._getComponentSearchProcessor({state:r,searchQuery:i.get_searchQuery.bind(i)}).process();this.saveHostState(r)},onViewChanging:function(n,t,i){var r=this.loadHostState(),f,u;$q.isNullOrEmpty(r)&&(r={});f=i.get_code();r.viewTypeCode=f;this.saveHostState(r);u=this.get_mainComponent();u&&Quantumart.QP8.BackendLibrary.isInstanceOfType(u)?u.changeViewType(f):this.changeView(i.get_controllerActionUrl())},onEntityLoaded:function(n){if(n.get_entityId()!=0){this.updateDocument(n);this.onEntityReaded(n);if(n.get_isRestored()&&n.get_entityTypeCode()==ENTITY_TYPE_CODE_ARTICLE_VERSION){var t=String.format($l.EntityEditor.versionSuccessfullyRestoredMessage,n.get_entityId());alert(t)}}else if(n.get_actionTypeCode()==ACTION_TYPE_CHILD_ENTITY_PERMISSION_SAVE)this.onEntityReaded(n)},onEntitySubmitting:function(){this.onDocumentChanging()},onEntitySubmitted:function(n){this.loadReadyHtmlContent(n.get_data());this.onDocumentChanged();this.saveAndUp();this.onSaveAndClose()},onEntitySubmittedError:function(){this._isCloseForced=!1;this.onDocumentChanged()},saveAndCloseRequest:function(){},onSaveAndClose:function(){},saveAndUp:function(){var n=this.get_documentContext();if(n&&n.needUp())this.onNeedUp(n.get_eventArgs())},onDocumentUnloaded:function(){this.destroyAllActionLinks();var n=this.get_mainComponent();n&&Quantumart.QP8.BackendLibrary.isInstanceOfType(n)&&n.detachObserver(EVENT_TYPE_LIBRARY_RESIZED);n=null;this._documentContext&&(this._documentContext.dispose(),this._documentContext=null)},onDocumentLoaded:function(){var t,n,i,r,u;if(this.initAllActionLinks(),this.restoreHostState(),this.onLoadMainComponent(),this.get_eventArgsAdditionalData()&&this.get_eventArgsAdditionalData().restoring===!0&&(t=this.get_eventArgsAdditionalData(),t.restoring=!1,t.initFieldValues=null),n=this.get_documentContext(),n){if(i=n.get_state(),r=n.get_mainComponentType(),r==$e.MainComponentType.Editor&&i!=$e.DocumentContextState.Error){u=n.get_eventArgs();this._copyContextQueryToEventArgs(u);this.onEntityLoaded(n.get_eventArgs())}n.onHostLoaded()}},onDocumentError:function(){this._isCloseForced=!1},onSelectionChanged:function(n){var t=Array.clone(n.get_entities());this._selectedEntities=t;this.saveSelectionContext(n);this._saveSelectedEntitiesContext(n);this.refreshPanels()},onDataBinding:function(){this.onDocumentChanging(!0)},onDataBound:function(n,t,i){var u=this.get_mainComponent(),r;u&&Quantumart.QP8.BackendEntityGrid.isInstanceOfType(u)&&(r=this.loadHostState(),$q.isNullOrEmpty(r)&&(r={}),$q.isNullOrEmpty(t.get_currentPage())?$q.removeProperty(r,"gridCurrentPage"):r.gridCurrentPage=u.get_currentPage(),$q.isNullOrEmpty(t.get_orderBy())?$q.removeProperty(r,"gridOrderBy"):r.gridOrderBy=u.get_orderBy(),this.saveHostState(r));this.onSelectionChanged(i);this.onDocumentChanged(!0)},onGeneralEvent:function(n,t,i){if(n==EVENT_TYPE_ENTITY_GRID_ACTION_EXECUTING||n==EVENT_TYPE_ENTITY_TREE_ACTION_EXECUTING||n==EVENT_TYPE_LIBRARY_ACTION_EXECUTING||n==EVENT_TYPE_ENTITY_EDITOR_ACTION_EXECUTING||n==EVENT_TYPE_BREAD_CRUMBS_ITEM_CTRL_CLICK||n==EVENT_TYPE_ACTION_LINK_CLICK||n==EVENT_TYPE_ACTION_PERMISSIONS_VIEW_EXECUTING||n==EVENT_TYPE_LIBRARY_ALL_FILES_UPLOADED)this.onActionExecuting(i);else if(n==EVENT_TYPE_EXTERNAL_ACTION_EXECUTING)if(i.get_externalCallerContext().data.changeCurrentTab&&i.get_isInterface())this.onChangeContent(n,t,i);else this.onActionExecuting(i);else if(n==EVENT_TYPE_ENTITY_GRID_DATA_BINDING)this.onDataBinding(i);else if(n==EVENT_TYPE_ENTITY_GRID_DATA_BOUND||n==EVENT_TYPE_LIBRARY_DATA_BOUND||n==EVENT_TYPE_ENTITY_TREE_DATA_BOUND)this.onDataBound(n,t,i);else if(n==EVENT_TYPE_ENTITY_GRID_ENTITY_SELECTED||n==EVENT_TYPE_LIBRARY_ENTITY_SELECTED||n==EVENT_TYPE_ENTITY_TREE_ENTITY_SELECTED)this.onSelectionChanged(i);else if(n==EVENT_TYPE_ENTITY_GRID_TITLE_LINK_CLICK||n==EVENT_TYPE_BREAD_CRUMBS_ITEM_CLICK||n==EVENT_TYPE_ACTION_LINK_SELF_CLICK)this.onChangeContent(n,t,i);else if(n==EVENT_TYPE_ENTITY_EDITOR_ENTITY_SUBMITTING)this.onEntitySubmitting();else if(n==EVENT_TYPE_ENTITY_EDITOR_ENTITY_SUBMITTED)this.onEntitySubmitted(i);else if(n==EVENT_TYPE_ENTITY_EDITOR_ENTITY_SUBMITTED_ERROR)this.onEntitySubmittedError();else if(n==EVENT_TYPE_ENTITY_EDITOR_ENTITY_REFRESH_STARTING)this.refresh();else if(n==EVENT_TYPE_VIEW_TOOLBAR_VIEWS_DROPDOWN_SELECTED_INDEX_CHANGED)this.onViewChanging(n,t,i);else if(n==EVENT_TYPE_ACTION_TOOLBAR_BUTTON_CLICKED)this.onActionToolbarButtonClicked(n,t,i);else if(n==EVENT_TYPE_VIEW_TOOLBAR_SEARCH_BUTTON_CLICKED)this.onSearchViewToolbarButtonClicked(n,t,i);else if(n==EVENT_TYPE_VIEW_TOOLBAR_CONTEXT_BUTTON_CLICKED)this.onContextViewToolbarButtonClicked(n,t,i);else n==EVENT_TYPE_CLASSIFIER_FIELD_ARTICLE_LOADED?this.initAllActionLinks(i.articleWrapper):n==EVENT_TYPE_CLASSIFIER_FIELD_ARTICLE_UNLOADING&&this.destroyAllActionLinks(i.articleWrapper)},getCurrentAction:function(){return $a.getBackendActionByCode(this._actionCode)},cancel:function(){var n=this.getCurrentAction(),t=n?n.EntityType.CancelActionCode:"";!$q.isNullOrWhiteSpace(t)&&n.ActionType.Code==ACTION_TYPE_CODE_READ&&$o.checkEntityExistence(this._entityTypeCode,this._entityId)&&this.executeAction(t)},allowChange:function(){var n=this.get_mainComponent();return n==null||!Quantumart.QP8.BackendEntityEditor.isInstanceOfType(n)||n.confirmChange()},allowClose:function(){var n=this.get_mainComponent();return n==null||!Quantumart.QP8.BackendEntityEditor.isInstanceOfType(n)||n.confirmClose()},selectAllEntities:function(){var n=this.get_mainComponent();n&&Quantumart.QP8.BackendEntityGrid.isInstanceOfType(n)?n.selectAllRows():alert($l.Toolbar.selectAllIsNotAllowed)},deselectAllEntities:function(){var n=this.get_mainComponent();n&&Quantumart.QP8.BackendEntityGrid.isInstanceOfType(n)?n.deselectAllRows():alert($l.Toolbar.selectAllIsNotAllowed)},getAllActionLinks:function(n){var t=$q.toJQuery(n);return t?t.find(".actionLink"):[]},initAllActionLinks:function(n){var t=this;$q.isNull(n)&&(n=this._documentWrapperElement);this.getAllActionLinks(n).each(function(n,i){var r=$q.toJQuery(i);if(!$q.isNullOrEmpty(r)&&$q.isNull(r.data("action_link_component"))){var f=r.attr("id"),e=$q.toInt(r.data("entity_id"),0),o=r.data("entity_name"),s=$q.toInt(r.data("parent_entity_id"),null),h=r.data("action_type_code"),c=r.data("action_code"),l=$q.toInt(r.data("action_target_type"),null),a=r.data("context"),u=new Quantumart.QP8.BackendActionLink(f,{entityId:e,entityName:o,parentEntityId:s,actionTypeCode:h,actionCode:c,actionTargetType:l,context:a});u.initialize();u.attachObserver(EVENT_TYPE_ACTION_LINK_SELF_CLICK,t._onGeneralEventHandler);u.attachObserver(EVENT_TYPE_ACTION_LINK_CLICK,t._onGeneralEventHandler);r.data("action_link_component",u)}})},destroyAllActionLinks:function(n){var t=this;$q.isNull(n)&&(n=this._documentWrapperElement);this.getAllActionLinks(n).each(function(n,i){var u=$q.toJQuery(i),r;$q.isNullOrEmpty(u)||(r=u.data("action_link_component"),$q.isObject(r)&&(r.detachObserver(EVENT_TYPE_ACTION_LINK_SELF_CLICK,t._onGeneralEventHandler),r.detachObserver(EVENT_TYPE_ACTION_LINK_CLICK,t._onGeneralEventHandler),r.dispose(),r=null),u.removeData("action_link_component"))})},onActionToolbarButtonClicked:function(n,t,i){var r=this._actionToolbarComponent.getToolbarItemValue(i.get_value());this.executeAction(r)},onSearchViewToolbarButtonClicked:function(){this.get_isSearchBlockVisible()==!1?(this._searchBlockComponent||this.createSearchBlock(),this._searchBlockComponent.renderSearchBlock(),this._searchBlockComponent.showSearchBlock(),this.set_isSearchBlockVisible(!0)):this._searchBlockComponent&&(this._searchBlockComponent.hideSearchBlock(),this.set_isSearchBlockVisible(!1))},get_isSearchBlockVisible:function(){var n=this.loadHostState();return $q.isNullOrEmpty(n)?!1:$q.toBoolean(n.isSearchBlockVisible,!1)},set_isSearchBlockVisible:function(n){var t=this.loadHostState();$q.isNullOrEmpty(t)&&(t={});t.isSearchBlockVisible=$q.toBoolean(n,!1);this.saveHostState(t)},onContextViewToolbarButtonClicked:function(){this._isContextBlockVisible==!1?(this._contextBlockComponent||this.createContextBlock(),this._contextBlockComponent.renderSearchBlock(),this._contextBlockComponent.showSearchBlock(),this._isContextBlockVisible=!0):this._contextBlockComponent&&(this._contextBlockComponent.hideSearchBlock(),this._isContextBlockVisible=!1)},getEventArgs:function(){var t=this.getCurrentAction(),n=null;return $q.isObject(t)?(n=$a.getEventArgsFromAction(t),n.set_entityTypeCode(this._entityTypeCode),n.set_entityId(this._entityId),n.set_entityName(this._entityName),n.set_parentEntityId(this._parentEntityId)):n=new Quantumart.QP8.BackendEventArgs,n},renderPanels:function(){this._breadCrumbsComponent&&this._breadCrumbsComponent.addItemsToBreadCrumbs();var n=this._getSelectedEntities();this._actionToolbarComponent&&!this._useCustomActionToolbar&&(this._actionToolbarComponent.set_actionCode(this._actionCode),this._actionToolbarComponent.set_entityId(this._entityId),this._actionToolbarComponent.set_parentEntityId(this._parentEntityId),this._actionToolbarComponent.set_isBindToExternal(this.get_isBindToExternal()),this._actionToolbarComponent.addToolbarItemsToToolbar(n.length));this._viewToolbarComponent&&(this._viewToolbarComponent.set_actionCode(this._actionCode),this._viewToolbarComponent.set_parentEntityId(this._parentEntityId),this._viewToolbarComponent.addToolbarItemsToToolbar(n.length));this.showPanels()},refreshPanels:function(){var n=this._getSelectedEntities();this._actionToolbarComponent&&(n.length==1&&n.Id!=this._entityId?this._actionToolbarComponent.tuneToolbarItems(n[0].Id,this._parentEntityId):(this._actionToolbarComponent.setVisibleStateForAll(!0),this._actionToolbarComponent.setEnableStateForAll(!0)),this._actionToolbarComponent.refreshToolbarItems(n.length));this._viewToolbarComponent&&this._viewToolbarComponent.refreshToolbarItems(n.length);this.fixActionToolbarWidth()},_getSelectedEntities:function(){return this._actionTypeCode==ACTION_TYPE_CODE_LIST||this._actionTypeCode==ACTION_TYPE_CODE_LIBRARY?this._selectedEntities:[{Id:this._entityId,Name:this._entityName}]},getCurrentViewActionUrl:function(){var n=this.loadHostState();return n&&n.viewTypeCode?$a.getActionViewByViewTypeCode(this.getCurrentAction(),n.viewTypeCode).ControllerActionUrl:""},_copyCurrentContextToEventArgs:function(n){var t=this.get_documentContext();t&&n.set_context(t.modifyEventArgsContext(n.get_context()));n.set_callerContext({eventArgs:this._getAppliedEventArgs()});this._copyContextQueryToEventArgs(n)},_copyContextQueryToEventArgs:function(n){var t=this.get_contextQuery(),i;t&&(i=n.get_additionalData(),i?i.contextQuery=t:n.set_additionalData({contextQuery:t}))},dispose:function(){}};Quantumart.QP8.BackendDocumentHost.generateTitle=function(n,t){var r=n.get_actionCode(),s=$a.getBackendAction(r),u=s.ShortName?s.ShortName:s.Name,f=s.ActionType.Code,y=n.get_isMultipleEntities(),b=n.get_entities(),i=n.get_entityTypeCode(),h=n.get_entityId(),l=n.get_parentEntityId(),p=!1,a=0,k,c,e,v,o,w;if(($q.isObject(t)&&($q.isBoolean(t.isTab)&&(p=t.isTab),$q.isInt(t.tabNumber)&&(a=t.tabNumber)),k=p?$l.Common.untitledTabText:$l.Common.untitledWindowTitle,f==ACTION_TYPE_CODE_LIST&&(i==ENTITY_TYPE_CODE_SITE||i==ENTITY_TYPE_CODE_USER||i==ENTITY_TYPE_CODE_USER_GROUP))||f==ACTION_TYPE_CODE_READ&&(i==ENTITY_TYPE_CODE_CUSTOMER_CODE||i==ENTITY_TYPE_CODE_SITE_FILE||i==ENTITY_TYPE_CODE_CONTENT_FILE)||r==ACTION_CODE_CHILD_CONTENT_PERMISSIONS||r==ACTION_CODE_CHILD_ARTICLE_PERMISSIONS||r==ACTION_CODE_SELECT_USER_GROUP||r==ACTION_CODE_SELECT_USER||r==ACTION_CODE_MULTIPLE_SELECT_USER)return u;if(i==ENTITY_TYPE_CODE_ENTITY_TYPE_PERMISSION&&(c=Quantumart.QP8.BackendEntityType.getEntityTypeById(l),c)){if(f==ACTION_TYPE_CODE_LIST)return String.format($l.BackendPermission.entityPermissionListTitleFormat,c.Name);if(r==ACTION_CODE_CHANGE_ENTITY_TYPE_PERMISSION_NODE||r==ACTION_CODE_NEW_ENTITY_TYPE_PERMISSION)return String.format($l.BackendPermission.entityPermissionPropertyTitleFormat,c.Name,u)}if(i==ENTITY_TYPE_CODE_ACTION_PERMISSION&&(e=$a.getBackendActionById(l),e)){if(f==ACTION_TYPE_CODE_LIST)return String.format($l.BackendPermission.actionPermissionListTitleFormat,e.ShortName?e.ShortName:e.Name);if(r==ACTION_CODE_CHANGE_ACTION_PERMISSION_NODE||r==ACTION_CODE_NEW_ACTION_PERMISSION)return String.format($l.BackendPermission.actionPermissionPropertyTitleFormat,e.Name,u)}return(v=Quantumart.QP8.BackendDocumentHost.generateTitleTemplate(f,i,y,a>1),o=$o.getParentInfo(i,h,l),f==ACTION_TYPE_CODE_READ&&(i==ENTITY_TYPE_CODE_SITE_PERMISSION||i==ENTITY_TYPE_CODE_CONTENT_PERMISSION||i==ENTITY_TYPE_CODE_ARTICLE_PERMISSION||i==ENTITY_TYPE_CODE_WORKFLOW_PERMISSION||i==ENTITY_TYPE_CODE_SITE_FODER_TYPE_PERMISSION||i==ENTITY_TYPE_CODE_ENTITY_TYPE_PERMISSION||i==ENTITY_TYPE_CODE_ACTION_PERMISSION))?String.format("{0} {1} - {2}","("+h+")",o[0].EntityTypeName,u):$q.isNullOrEmpty(v)?u:(($q.isNull(h)||f==ACTION_TYPE_CODE_SELECT)&&(h=0),!$q.isArray(o)||o.length==0)?u:(w=y?$o.getEntityNamesStringFromEntities(b):"",String.format(v,o[0].EntityTypeName,o[0].Title,u,a,w))};Quantumart.QP8.BackendDocumentHost.generateTitleTemplate=function(n,t,i,r){var u="";return n==ACTION_TYPE_CODE_ADD_NEW?u=r?'{0} "{1}" - {2}-{3}':'{0} "{1}" - {2}':n==ACTION_TYPE_CODE_LIST||n==ACTION_TYPE_CODE_LIBRARY||n==ACTION_TYPE_CODE_READ||n==ACTION_TYPE_CODE_SEARCH||n==ACTION_TYPE_CODE_SELECT||n==ACTION_TYPE_CODE_MULTIPLE_SELECT||n==ACTION_TYPE_ACTION_PERMISSION_TREE?u='{0} "{1}" - {2}':i&&(u='{0} "{1}" - {2} {4}'),u};Quantumart.QP8.BackendDocumentHost.registerClass("Quantumart.QP8.BackendDocumentHost",Quantumart.QP8.Observable);