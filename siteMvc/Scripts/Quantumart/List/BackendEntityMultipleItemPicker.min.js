Quantumart.QP8.BackendEntityMultipleItemPicker=function(n,t,i,r,u,f,e){Quantumart.QP8.BackendEntityMultipleItemPicker.initializeBase(this,[n,t,i,r,u,f,e]);this._allowMultipleItemSelection=!0;this._selectionMode=Quantumart.QP8.Enums.ListSelectionMode.OnlySelectedItems};Quantumart.QP8.BackendEntityMultipleItemPicker.prototype={_pickButtonElement:null,_clearButtonElement:null,_copyButtonElement:null,_pasteButtonElement:null,_countOverflowElement:null,OVERFLOW_HIDDEN_CLASS:"overflowHiddenValue",get_maxListWidth:function(){return this._maxListWidth},set_maxListWidth:function(n){this._maxListWidth=n},get_maxListHeight:function(){return this._maxListHeight},set_maxListHeight:function(n){this._maxListHeight=n},initialize:function(){var n,f,e,o,t,i,r,u;Quantumart.QP8.BackendEntityMultipleItemPicker.callBaseMethod(this,"initialize");n=jQuery(this._listElement);f=n.find("."+this.OVERFLOW_HIDDEN_CLASS);f.length>0&&(this._countOverflowElement=f.get(0));this._fixListOverflow();e=this.getSelectedEntities().length;o=e<=1||this._isCountOverflow();this._addCountDiv(e,!1);this._addGroupCheckbox(o);this._syncGroupCheckbox();t=this._createToolbarButton(this._listElementId+"_PickButton",$l.EntityDataList.pickLinkButtonText,"pick");this._addButtonToToolbar(t);i=this._createToolbarButton(this._listElementId+"_ClearButton",$l.EntityDataList.clearUnmarkedLinkButtonText,"deselectAll");this._addButtonToToolbar(i);this._enableCopy&&(r=this._createToolbarButton(this._listElementId+"_CopyButton",$l.EntityDataList.copyLinkButtonText,"copy"),this._addButtonToToolbar(r),u=this._createToolbarButton(this._listElementId+"_PasteButton",$l.EntityDataList.pasteLinkButtonText,"paste"),this._addButtonToToolbar(u));this._addNewButtonToToolbar();this._pickButtonElement=t.get(0);t.bind("click",jQuery.proxy(this._onPickButtonClickHandler,this));this._clearButtonElement=i.get(0);i.bind("click",jQuery.proxy(this._onClearButtonClickHandler,this));this._refreshClearButton();this._enableCopy&&(this._copyButtonElement=r.get(0),r.bind("click",jQuery.proxy(this._onCopyButtonClickHandler,this)),this._pasteButtonElement=u.get(0),u.bind("click",jQuery.proxy(this._onPasteButtonClickHandler,this)));n.delegate("LI INPUT:checkbox","change",jQuery.proxy(this._onSelectedItemChangeHandler,this));n.delegate("LI A","click",jQuery.proxy(this._onItemClickHandler,this));n.delegate("LI A","mouseup",jQuery.proxy(this._onItemClickHandler,this));t=null;i=null;n=null},getListItems:function(){return jQuery(this._listElement).find("UL LI")},getSelectedListItems:function(){return jQuery(this._listElement).find("UL LI:has(INPUT:checkbox:checked)")},getSelectedEntities:function(){var n,t,i;return this._isCountOverflow()?(i=jQuery(this._countOverflowElement).val().split(","),n=jQuery.map(i,function(n){return{Id:n,Name:""}})):(t=this.getSelectedListItems(),n=t.map(function(n,t){var i=jQuery(t),r=$q.toInt(i.find("INPUT:checkbox").val(),0),u=$q.toString(i.find("LABEL").text());return{Id:r,Name:u}}).get()),n||[]},_isCountOverflow:function(){return this._countOverflowElement!=null},_refreshListInner:function(n,t){var i=jQuery.map(jQuery.grep(n,function(n){return n.Value}),function(n){return $q.toInt(n.Value)}),e=this.getSelectedEntityIDs(),h=i.length!=e.length||i.length!=_.union(i,e).length,f,o,s;if(h){var c=this.getSelectedEntities().length,r=jQuery(this._listElement),u=r.find("UL");i.length<this._countLimit?(u.empty().html(this._getCheckBoxListHtml(n)),jQuery(this._countOverflowElement).remove(),this._countOverflowElement=null):(u.empty(),f=i.join(),this._countOverflowElement?jQuery(this._countOverflowElement).val(f):(o=r.data("list_item_name"),s='<input type="hidden" class="'+this.OVERFLOW_HIDDEN_CLASS+'" name="'+o+'" value = "'+f+'" />',u.before(s),this._countOverflowElement=r.find("."+this.OVERFLOW_HIDDEN_CLASS).get(0)));this._setAsChanged(t);this._refreshGroupCheckbox(n.length);this._syncCountSpan(n.length);this._refreshClearButton()}},selectAllListItems:function(){this._changeAllListItemsSelection(!0);this._refreshClearButton()},selectEntities:function(n){if(this.deselectAllListItems(),!$q.isNullOrEmpty(n)&&$q.isArray(n)){var t=jQuery.map(n,function(n){return{Id:n}});this._loadSelectedItems(t);t=null}},deselectAllListItems:function(){this._changeAllListItemsSelection(!1);this._refreshClearButton()},removeAllListItems:function(){this.deselectAllListItems();this._onClearButtonClickHandler()},_changeAllListItemsSelection:function(n){this.getListItems().find("INPUT:checkbox").prop("checked",n);this._setAsChanged()},enableList:function(){jQuery(this._listElement).removeClass(this.LIST_DISABLED_CLASS_NAME);this.getListItems().find("INPUT:checkbox").prop("disabled",!1);this._getGroupCheckbox().prop("disabled",!1);this._enableAllToolbarButtons();this._refreshClearButton()},disableList:function(){jQuery(this._listElement).addClass(this.LIST_DISABLED_CLASS_NAME);this.getListItems().find("INPUT:checkbox").prop("disabled",!0);this._getGroupCheckbox().prop("disabled",!0);this._disableAllToolbarButtons()},makeReadonly:function(){this.disableList();var n=this.getListItems().find("INPUT:checkbox:checked");n.each(function(n,t){var i=jQuery(t);i.siblings('input[name="'+i.prop("name")+'"]:hidden').val(i.val())})},isListChanged:function(){var n=jQuery(this._listElement),t=n.hasClass(CHANGED_FIELD_CLASS_NAME);return n=null,t},_setAsChanged:function(n){var t=jQuery(this._listElement),i,r;t.addClass(CHANGED_FIELD_CLASS_NAME);i=n?"addClass":"removeClass";t[i](REFRESHED_FIELD_CLASS_NAME);r=this.getSelectedEntityIDs();t.trigger(JQ_CUSTOM_EVENT_ON_FIELD_CHANGED,{fieldName:t.data("list_item_name"),value:r})},_getCheckBoxListHtml:function(n){for(var r,i=new $.telerik.stringBuilder,t=0;t<n.length;t++)r=n[t],this._getCheckBoxListItemHtml(i,r,t);return i.string()},_getCheckBoxListItemHtml:function(n,t,i){var r=this._listItemName,u=String.format("{0}_{1}",this._listElementId,i),f=t.Value,e=t.Text;n.cat("<li>").cat('<input type="checkbox"').cat(' name="'+$q.htmlEncode(r)+'"').cat(' id="'+$q.htmlEncode(u)+'"').cat(' value="'+$q.htmlEncode(f)+'"').cat(' class="checkbox multi-picker-item qp-notChangeTrack"').cat(' checked="checked"').catIf(" disabled ",this.isListDisabled()).cat("/> ").cat('<input type="hidden" value="false" name="'+$q.htmlEncode(r)+'"/>').cat(this._getIdLinkCode(f)).cat('<label for="'+$q.htmlEncode(u)+'">'+e+"<\/label>").cat("<\/li>")},_onPickButtonClickHandler:function(){this.isListDisabled()||this._openPopupWindow()},_onClearButtonClickHandler:function(){jQuery(this._listElement).find("LI:has(INPUT:checkbox:not(:checked))").remove();var n=this.getListItemCount();this._refreshGroupCheckbox(n);this._syncCountSpan(n);this._refreshClearButton();this._fixListOverflow()},_checkAllowShowingToolbar:function(){return this._selectActionCode!=ACTION_CODE_NONE},_onSelectedItemChangeHandler:function(){this._syncGroupCheckbox();this._syncCountSpan();this._refreshClearButton();this._setAsChanged();var n=new Quantumart.QP8.BackendEventArgs;this.notify(EVENT_TYPE_ENTITY_LIST_SELECTION_CHANGED,n)},_refreshClearButton:function(){if(this._clearButtonElement){var n=jQuery(this._clearButtonElement);this._changeToolbarButtonState(n,!this._isCountOverflow()&&this.getSelectedListItemCount()!=this.getListItemCount());n=null}},dispose:function(){this._stopDeferredOperations=!0;jQuery(this._pickButtonElement).unbind("click");jQuery(this._clearButtonElement).unbind("click");this._enableCopy&&(jQuery(this._copyButtonElement).unbind("click"),jQuery(this._pasteButtonElement).unbind("click"));jQuery(this._listElement).undelegate("LI INPUT:checkbox","change");jQuery(this._listElement).undelegate("LI A","click");jQuery(this._listElement).undelegate("LI A","mouseup");this._pickButtonElement=null;this._clearButtonElement=null;this._copyButtonElement=null;this._pasteButtonElement=null;this._listElement=null;Quantumart.QP8.BackendEntityMultipleItemPicker.callBaseMethod(this,"dispose")}};Quantumart.QP8.BackendEntityMultipleItemPicker.registerClass("Quantumart.QP8.BackendEntityMultipleItemPicker",Quantumart.QP8.BackendEntityDataListBase);