var EVENT_TYPE_ENTITY_LIST_ACTION_EXECUTING="OnEntityListActionExecuting",EVENT_TYPE_ENTITY_LIST_SELECTION_CHANGED="OnEntityListSelectionChanged";Quantumart.QP8.Enums.DataListType=function(){};Quantumart.QP8.Enums.DataListType.prototype={None:0,DropDownList:1,RadioButtonList:2,CheckBoxList:3,BulletedList:4,SingleItemPicker:5,MultipleItemPicker:6};Quantumart.QP8.Enums.DataListType.registerEnum("Quantumart.QP8.Enums.DataListType");Quantumart.QP8.BackendEntityDataListBase=function(n,t,i,r,u,f,e){Quantumart.QP8.BackendEntityDataListBase.initializeBase(this);this._listGroupCode=n;this._listElementId=t;this._entityTypeCode=i;this._parentEntityId=r;this._entityId=u;this._listType=f;$q.isObject(e)&&(this._listId=e.listId,this._listItemName=e.listItemName,this._addNewActionCode=e.addNewActionCode,this._readActionCode=e.readActionCode,this._selectActionCode=e.selectActionCode,this._maxListWidth=e.maxListWidth,this._maxListHeight=e.maxListHeight,this._showIds=e.showIds,this._filter=e.filter,this._initFilter=this._filter,this._hostIsWindow=e.hostIsWindow,this._isCollapsable=e.isCollapsable,this._enableCopy=e.enableCopy,this._readDataOnInsert=e.readDataOnInsert,this._countLimit=e.countLimit)};Quantumart.QP8.BackendEntityDataListBase.prototype={_listGroupCode:"",_listElementId:"",_listElement:null,_expandLinkElement:null,_collapseLinkElement:null,_listWrapperElement:null,_toolbarElement:null,_entityTypeCode:"",_entityId:0,_parentEntityId:0,_listType:0,_listId:0,_listItemName:"",_allowMultipleItemSelection:!1,_selectionMode:null,_maxListWidth:0,_maxListHeight:0,_addNewActionCode:"",_readActionCode:"",_selectActionCode:"",_addNewButtonElement:null,_readButtonElement:null,_stopDeferredOperations:!1,_listManagerComponent:null,_selectPopupWindowComponent:null,_showIds:!1,_filter:"",_initFilter:"",_hostIsWindow:!1,_isCollapsable:!1,_enableCopy:!0,_readDataOnInsert:!1,TOOLBAR_BUTTON_DISABLED_CLASS_NAME:"disabled",LIST_WRAPPER_CLASS_NAME:"dataListWrapper",LINK_BUTTON_CLASS_NAME:"linkButton",ACTION_LINK_CLASS_NAME:"actionLink",LINK_BUTTON_LIST_CLASS_NAME:"linkButtons",OVERFLOW_LIST_CLASS_NAME:"overflow",LIST_DISABLED_CLASS_NAME:"disabled",SELF_CLEAR_FLOATS_CLASS_NAME:"group",get_listElementId:function(){return this._listElementId},set_listElementId:function(n){this._listElementId=n},get_entityTypeCode:function(){return this._entityTypeCode},set_entityTypeCode:function(n){this._entityTypeCode=n},get_parentEntityId:function(){return this._parentEntityId},set_parentEntityId:function(n){this._parentEntityId=n},get_entityId:function(){return this._entityId},set_entityId:function(n){this._entityId=n},get_listType:function(){return this._listType},set_listType:function(n){this._listType=n},get_listId:function(){return this._listId},set_listId:function(n){this._listId=n},get_addNewActionCode:function(){return this._addNewActionCode},set_addNewActionCode:function(n){this._addNewActionCode=n},get_readActionCode:function(){return this._readActionCode},set_readActionCode:function(n){this._readActionCode=n},get_selectActionCode:function(){return this._selectActionCode},set_selectActionCode:function(n){this._selectActionCode=n},get_listGroupCode:function(){return this._listGroupCode},get_listManagerComponent:function(){return this._listManagerComponent},set_listManagerComponent:function(n){this._listManagerComponent=n},initialize:function(){var t,n,i;this._listElementId||alert("_listElementId");t=jQuery("#"+this._listElementId);t.wrap("<div />");n=t.parent();n.addClass(this.LIST_WRAPPER_CLASS_NAME);i=jQuery("<ul />",{"class":this.LINK_BUTTON_LIST_CLASS_NAME});i.addClass(this.SELF_CLEAR_FLOATS_CLASS_NAME);i.prependTo(n);n.wrap("<div />");this._isCollapsable&&this._createCollapsingToolbar(n.parent());this._listElement=t.get(0);this._listWrapperElement=n.get(0);this._toolbarElement=i.get(0);this._checkAllowShowingToolbar()?this._showToolbar():this._hideToolbar()},_createCollapsingToolbar:function(n){var r,i,t;n&&(r=new $.telerik.stringBuilder,r.cat("<div class='collapsingToolbar'>").cat("<ul class='linkButtons group'>").cat("<li style='display: block;' class='expand'>").cat("<span class='linkButton actionLink'>").cat("<a href='javascript:void(0);'>").cat("<span class='icon expand'><img src='/Backend/Content/Common/0.gif'><\/span>").cat("<span class='text'>").cat($l.EntityDataList.showListLinkButtonText).cat("<\/span>").cat("<\/a>").cat("<\/span>").cat("<\/li>").cat("<li style='display: none;' class='collapse'>").cat("<span class='linkButton actionLink'>").cat("<a href='javascript:void(0);'>").cat("<span class='icon collapse'><img src='/Backend/Content/Common/0.gif'><\/span>").cat("<span class='text'>").cat($l.EntityDataList.hideListLinkButtonText).cat("<\/span>").cat("<\/a>").cat("<\/span>").cat("<\/li>").cat("<\/ul>").cat("<\/div>"),i=jQuery(r.string()),t=this,this._expandLinkElement=i.find("LI.expand").click(function(n){jQuery(this).hide();jQuery(t._listWrapperElement).show();t._fixListOverflow();jQuery(t._collapseLinkElement).show();n.preventDefault()}).get(0),this._collapseLinkElement=i.find("LI.collapse").click(function(n){jQuery(this).hide();jQuery(t._listWrapperElement).hide();jQuery(t._expandLinkElement).show();n.preventDefault()}).get(0),jQuery(n).prepend(i).find("."+this.LIST_WRAPPER_CLASS_NAME).hide(),i=null)},_fixListOverflow:function(){var n=jQuery(this._listElement),t,i;n.removeClass(this.OVERFLOW_LIST_CLASS_NAME);t=jQuery("UL",n);t.length>0&&(n.height(t.height()),i=n.get(0).scrollHeight,i>n.height()&&(this._maxListHeight>0&&i>this._maxListHeight?(n.height(this._maxListHeight),n.addClass(this.OVERFLOW_LIST_CLASS_NAME)):n.height(i)));t=null;n=null},getListItems:function(){throw new Error($l.Common.methodNotImplemented);},getListItemCount:function(){var n=this.getListItems(),t=n.length;return n=null,t},getSelectedListItems:function(){throw new Error($l.Common.methodNotImplemented);},getSelectedListItemCount:function(){var n=this.getSelectedListItems(),t=n.length;return n=null,t},getSelectedEntities:function(){throw new Error($l.Common.methodNotImplemented);},getSelectedEntityIDs:function(){return jQuery.grep(jQuery.map(this.getSelectedEntities(),function(n){return $q.toInt(n.Id)}),function(n){return n})},selectEntities:function(n){Sys.Debug.trace(n)},refreshList:function(n){var i=$o.getEntityIDsFromEntities(this.getSelectedEntities()),t=$o.getSimpleEntityList(this._entityTypeCode,this._parentEntityId,this._entityId,this._listId,this._selectionMode,i,this._filter,n);t&&(this._refreshListInner(t,!0),this._fixListOverflow())},_refreshListInner:function(){throw new Error($l.Common.methodNotImplemented);},selectAllListItems:function(){throw new Error($l.Common.methodNotImplemented);},deselectAllListItems:function(){throw new Error($l.Common.methodNotImplemented);},enableList:function(){throw new Error($l.Common.methodNotImplemented);},disableList:function(){throw new Error($l.Common.methodNotImplemented);},makeReadonly:function(){},isListChanged:function(){throw new Error($l.Common.methodNotImplemented);},isListOverflow:function(){throw new Error($l.Common.methodNotImplemented);},isListDisabled:function(){return jQuery(this._listElement).hasClass(this.LIST_DISABLED_CLASS_NAME)},_showToolbar:function(){jQuery(this._toolbarElement).css("display","block")},_hideToolbar:function(){jQuery(this._toolbarElement).css("display","none")},_checkAllowShowingToolbar:function(){return!0},_getToolbarButtons:function(){return jQuery("."+this.LINK_BUTTON_CLASS_NAME,this._toolbarElement)},_createToolbarButton:function(n,t,i){return this._createLinkButton(n,t,i)},_isToolbarButtonDisabled:function(n){var r=!1,t=$q.toJQuery(n),i=t.data("action_link_component");return r=i?i.isActionLinkDisabled():t.find("A:first").hasClass(this.TOOLBAR_BUTTON_DISABLED_CLASS_NAME),i=null,t=null,r},_changeToolbarButtonState:function(n,t){var i=$q.toJQuery(n),r=i.data("action_link_component");r?t?r.enableActionLink():r.disableActionLink():t?i.find("A:first").removeClass(this.TOOLBAR_BUTTON_DISABLED_CLASS_NAME):i.find("A:first").addClass(this.TOOLBAR_BUTTON_DISABLED_CLASS_NAME);r=null;i=null},_createLinkButton:function(n,t,i){var u=jQuery("<span />",{id:n,"class":this.LINK_BUTTON_CLASS_NAME+" "+this.ACTION_LINK_CLASS_NAME}),r=new $.telerik.stringBuilder;return r.cat('<a href="javascript:void(0);">').cat('<span class="icon'+($q.isNullOrWhiteSpace(i)?"":" "+$q.htmlEncode(i))+'">').cat('<img src="'+COMMON_IMAGE_FOLDER_URL_ROOT+'0.gif" />').cat("<\/span>").cat('<span class="text">'+t+"<\/span>").cat("<\/a>"),u.html(r.string()),r=null,u},_extendLink:function(n,t){var i,f,h;if(!$q.isNullOrEmpty(n)){var e=this._entityTypeCode,r=0,o="",s=this._parentEntityId,u=Quantumart.QP8.BackendActionType.getActionTypeCodeByActionCode(t);u==ACTION_TYPE_CODE_READ&&(i=this.getSelectedEntities(),i.length>0&&(f=i[0],r=f.Id,o=$o.getEntityName(e,r,s),f=null),$q.clearArray(i));n.data("entity_id",r);n.data("entity_name",o);n.data("parent_entity_id",s);n.data("action_type_code",u);n.data("action_code",t);u==ACTION_TYPE_CODE_ADD_NEW&&e==ENTITY_TYPE_CODE_ARTICLE&&n.data("context",{additionalUrlParameters:{fieldId:this._listId,articleId:this._entityId}});h=this._hostIsWindow?Quantumart.QP8.Enums.ActionTargetType.NewWindow:Quantumart.QP8.Enums.ActionTargetType.NewTab;n.data("action_target_type",h)}},_addButtonToToolbar:function(n){var t=$q.toJQuery(n),i=jQuery(this._toolbarElement);i.append(t);t.wrap("<li />");i=null},_addLinkToToolbar:function(n,t){var i=$q.toJQuery(n);this._addButtonToToolbar(i);this._extendLink(i,t)},_addNewButtonToToolbar:function(){if(this._addNewActionCode!=ACTION_CODE_NONE){var n=this._createToolbarButton(this._listElementId+"_AddNewButton",$l.EntityDataList.addNewActionLinkButtonText,"add");this._addLinkToToolbar(n,this._addNewActionCode);this._addNewButtonElement=n.get(0)}},_addReadButtonToToolbar:function(){if(this._readActionCode!=ACTION_CODE_NONE){var n=this._createToolbarButton(this._listElementId+"_ReadButton",$l.EntityDataList.readActionLinkButtonText,"edit");this._changeToolbarButtonState(n,this.getSelectedListItemCount()>0);this._addLinkToToolbar(n,this._readActionCode);this._readButtonElement=n.get(0)}},_refreshReadToolbarButton:function(n){var t,i,f;if($q.isNull(n)&&(n=!1),this._readButtonElement){if(t=jQuery(this._readButtonElement),this._changeToolbarButtonState(t,this.getSelectedListItemCount()>0),n&&(i=t.data("action_link_component"),i)){var r=0,e="",u=this.getSelectedEntities();u.length>0&&(f=u[0],r=f.Id,e=$o.getEntityName(this._entityTypeCode,r,this._parentEntityId),f=null);$q.clearArray(u);i.set_entityId(r);i.set_entityName(e)}t=null}},_enableAllToolbarButtons:function(){for(var i,n=this._getToolbarButtons(),r=n.length,t=0;t<r;t++)i=n.eq(t),this._changeToolbarButtonState(i,!0);n=null;this._refreshReadToolbarButton()},_disableAllToolbarButtons:function(){for(var i,n=this._getToolbarButtons(),r=n.length,t=0;t<r;t++)i=n.eq(t),i.data("action_code")!=this._readActionCode&&this._changeToolbarButtonState(i,!1);n=null},_openPopupWindow:function(){var n=new Quantumart.QP8.BackendEventArgs,t;n.set_isMultipleEntities(this._allowMultipleItemSelection);n.set_parentEntityId(this._parentEntityId);n.set_entityTypeCode(this._entityTypeCode);n.set_actionCode(this._selectActionCode);t=this.getSelectedEntities();t.length>0&&(this._allowMultipleItemSelection?n.set_entities(t):(n.set_entityId(t[0].Id),n.set_entityName(t[0].Name)));this._selectPopupWindowComponent=new Quantumart.QP8.BackendSelectPopupWindow(n,{filter:this._filter});this._selectPopupWindowComponent.attachObserver(EVENT_TYPE_SELECT_POPUP_WINDOW_RESULT_SELECTED,jQuery.proxy(this._popupWindowSelectedHandler,this));this._selectPopupWindowComponent.attachObserver(EVENT_TYPE_SELECT_POPUP_WINDOW_CLOSED,jQuery.proxy(this._popupWindowClosedHandler,this));this._selectPopupWindowComponent.openWindow();n=null},_popupWindowSelectedHandler:function(n,t,i){this._loadSelectedItems(i.entities);this._destroyPopupWindow();var r=new Quantumart.QP8.BackendEventArgs;this.notify(EVENT_TYPE_ENTITY_LIST_SELECTION_CHANGED,r)},_loadSelectedItems:function(n){if(($o.checkEntitiesForPresenceEmptyNames(n)||this._readDataOnInsert)&&n.length<=this._countLimit){var t=$o.getEntityIDsFromEntities(n);dataItems=$o.getSimpleEntityList(this._entityTypeCode,this._parentEntityId,this._entityId,this._listId,this._selectionMode,t,this._filter,0)}else dataItems=Quantumart.QP8.ControlHelpers.getListItemCollectionFromEntities(n);dataItems&&(this._refreshListInner(dataItems,!1),this._fixListOverflow());$q.clearArray(dataItems)},_popupWindowClosedHandler:function(){this._destroyPopupWindow()},_destroyPopupWindow:function(){this._selectPopupWindowComponent&&(this._selectPopupWindowComponent.detachObserver(EVENT_TYPE_SELECT_POPUP_WINDOW_RESULT_SELECTED),this._selectPopupWindowComponent.detachObserver(EVENT_TYPE_SELECT_POPUP_WINDOW_CLOSED),this._selectPopupWindowComponent.closeWindow(),this._selectPopupWindowComponent.dispose(),this._selectPopupWindowComponent=null)},_getGroupCheckboxHtml:function(n){var t="{0}_{1}",i="group",f=String.format(t,i,this._listItemName),r=String.format(t,i,this._listElementId),e=$l.EntityDataList.selectDeselectAllText,o=n?'style="display:none"':"",u=new $.telerik.stringBuilder;return u.cat('<div class="groupCheckbox" '+o+">").cat('<input type="checkbox"').cat(' name="'+$q.htmlEncode(f)+'"').cat(' id="'+$q.htmlEncode(r)+'"').cat(' value="1"').cat(' class="checkbox group qp-notChangeTrack"').cat("/>").cat(" ").cat('<label for="'+$q.htmlEncode(r)+'">'+e+"<\/label>").cat("<\/div>"),u.string()},_getCountDivHtml:function(n,t){var i=new $.telerik.stringBuilder,r=t?'style="display:none"':"",u=String.format($l.EntityDataList.countText,'<span class="countItems">'+n+"<\/span>"),f='<span class="overflowText">'+this._getOverflowText()+"<\/span>";return i.cat('<div class="countItemsBlock" '+r+">").cat(u).cat(f).cat("<\/div>"),i.string()},_refreshGroupCheckbox:function(n){n>1&&!this._isCountOverflow()?this._showGroupCheckbox():this._hideGroupCheckbox();this._syncGroupCheckbox()},_addGroupCheckbox:function(n){jQuery(this._toolbarElement).after(this._getGroupCheckboxHtml(n));this._getGroupCheckbox().bind("click",jQuery.proxy(this._groupCheckboxClickHandler,this))},_showGroupCheckbox:function(){this._getGroupCheckbox().parent().show()},_hideGroupCheckbox:function(){this._getGroupCheckbox().parent().hide()},_destroyGroupCheckbox:function(){this._getGroupCheckbox().unbind("click").parent().remove()},_addCountDiv:function(n,t){jQuery(this._toolbarElement).after(this._getCountDivHtml(n,t))},_destroyCountDiv:function(){this._getCountSpan().parent().remove()},_getGroupCheckbox:function(){return jQuery(this._listWrapperElement).find(".groupCheckbox INPUT:checkbox")},_getCountSpan:function(){return jQuery(this._listWrapperElement).find(".countItems")},_getOverflowSpan:function(){return jQuery(this._listWrapperElement).find(".overflowText")},_groupCheckboxClickHandler:function(){this._getGroupCheckbox().is(":checked")?this.selectAllListItems():this.deselectAllListItems();this._syncCountSpan()},_syncGroupCheckbox:function(){this._getGroupCheckbox().prop("checked",this.getListItemCount()==this.getSelectedListItemCount())},_syncCountSpan:function(n){this._getCountSpan().html(""+(n||this.getSelectedEntities().length));this._getOverflowSpan().html(this._getOverflowText())},_getOverflowText:function(){return this._isCountOverflow()?". "+String.format($l.EntityDataList.overFlowText,this._countLimit):""},_onItemClickHandler:function(n){var f,i,r,t,u;if(n.preventDefault(),f=n.type=="click"&&(n.which==1||n.which==0),i=n.type=="mouseup"&&n.which==2,!(f||i))return!1;r=jQuery(n.target);t=new Quantumart.QP8.BackendEventArgs;t.set_actionCode(this._readActionCode);t.set_entityId(r.html());t.set_entityName(r.closest("LI").children("LABEL").html());t.set_entityTypeCode(this._entityTypeCode);t.set_parentEntityId(this._parentEntityId);this._hostIsWindow?(u=Quantumart.QP8.Backend.getInstance().checkOpenDocumentByEventArgs(t),u?alert(u):(t.set_isWindow(!0),this.notify(EVENT_TYPE_ENTITY_LIST_ACTION_EXECUTING,t))):(t.set_context({ctrlKey:n.ctrlKey||i}),this.notify(EVENT_TYPE_ENTITY_LIST_ACTION_EXECUTING,t))},_getIdLinkCode:function(n){return this._showIds?'<span class="idLink">(<a class="js" href="javascript:void(0)">'+$q.htmlEncode(n)+"<\/a>)<\/span>":""},_getValueStorage:function(){return this._listManagerComponent.getValueStorage()},_onCopyButtonClickHandler:function(){var n=this._getValueStorage();n.parentEntityId=this._parentEntityId;n.entityTypeCode=this._entityTypeCode;n.filter=this._filter;n.entities=this.getSelectedEntities()},_onPasteButtonClickHandler:function(){var n=this._getValueStorage();n.entities&&(n.entityTypeCode!=this._entityTypeCode?alert($l.EntityDataList.typesDoesNotMatchMessage):n.parentEntityId!=this._parentEntityId?alert($l.EntityDataList.parentsDoesNotMatchMessage):n.filter!=this._filter?alert($l.EntityDataList.filtersDoesNotMatchMessage):this._loadSelectedItems(n.entities))},_isCountOverflow:function(){return!1},setFilter:function(n){this._filter=n},applyFilter:function(n){var t=this._initFilter;n&&(t=t&&t.trim()?t+" and "+n:n);t!=this._filter&&(this._filter=t,this.getListItemCount()>0&&this.refreshList())},getFilter:function(){return this._filter},dispose:function(){var n,t;Quantumart.QP8.BackendEntityDataListBase.callBaseMethod(this,"dispose");this._destroyPopupWindow();this._addNewButtonElement&&(this._addNewButtonElement=null);this._readButtonElement&&(this._readButtonElement=null);this._toolbarElement&&(n=jQuery(this._toolbarElement),n.empty().remove(),n=null,this._toolbarElement=null);this._destroyGroupCheckbox();this._destroyCountDiv();this._listWrapperElement&&(jQuery(this._listElement).unwrap(this._listWrapperElement),this._listWrapperElement=null);this._listManagerComponent&&(t=this._listElementId,$q.isNullOrWhiteSpace(t)||this._listManagerComponent.removeList(t),this._listManagerComponent=null);this._expandLinkElement&&(jQuery(this._expandLinkElement).off(),this._expandLinkElement=null);this._collapseLinkElement&&(jQuery(this._collapseLinkElement).off(),this._collapseLinkElement=null);this._listElement=null;$q.collectGarbageInIE()}};Quantumart.QP8.BackendEntityDataListBase.registerClass("Quantumart.QP8.BackendEntityDataListBase",Quantumart.QP8.Observable);