(function(n){var t,i;jeegoocontext=function(r,u){var f=this;this._id=u.menuElementId;this._menuElement=n("#"+this._id).get(0);this._targetElement=r;t||(t={});i||(i={});this._onDocumentClickingHandler=function(n){f.hide(n)};this._onDocumentHoveringHandler=function(r){var o=f._id,u=i[o],e;if(!u)return!1;n(r.relatedTarget).parents("#"+o).length>0&&(window.clearTimeout(u.show),e=n(r.relatedTarget).parent().find("LI"),e.add(e.find("> *")).removeClass(u.hoverClass),i[t.activeId].currentHover=null,u.hide=window.setTimeout(function(){e.find("UL").hide()},u.delay))};this._onDocumentKeyDownHandler=function(r){var s=t.activeId,u=i[s],e,o;switch(r.which){case 38:return t.keyUpDownStop?!1:(f._onDocumentKeyUpDownInnerHandler(),t.keyUpDown=window.setInterval(f._onDocumentKeyUpDownInnerHandler,u.keyDelay),t.keyUpDownStop=!0,!1);case 39:return u.currentHover?u.currentHover.find("UL:visible:first LI:visible:first").trigger("mouseover"):(e=n("#"+s+", #"+s+" UL:visible"),e.length>0&&n(e[e.length-1]).find(":visible:first").trigger("mouseover"),e=null),!1;case 40:return t.keyUpDownStop?!1:(f._onDocumentKeyUpDownInnerHandler(!0),t.keyUpDown=window.setInterval(function(){f._onDocumentKeyUpDownInnerHandler(!0)},u.keyDelay),t.keyUpDownStop=!0,!1);case 37:return u.currentHover?n(u.currentHover.parents("LI")[0]).trigger("mouseover"):(o=n("#"+s+" LI."+u.hoverClass),o.length>0&&n(o[o.length-1]).trigger("mouseover"),o=null),!1;case 13:u.currentHover?u.currentHover.trigger("click"):n(document).trigger("click");break;case 27:n(document).trigger("click")}};this._onDocumentKeyUpHandler=function(){window.clearInterval(t.keyUpDown);t.keyUpDownStop=!1};this._onContextMenuShowingHandler=function(n){return f.show(n,this),n.stopPropagation(),!1};this._onContextMenuItemHoveringHandler=function(t){var v=f._id,r=i[v],u,h,c,e;if(!r)return!1;if(u=r.currentHover=n(this),window.clearTimeout(r.show),window.clearTimeout(r.hide),jQuery(f._menuElement).find("*").removeClass(r.hoverClass),h=u.parents("LI"),u.add(u.find("> *")).add(h).add(h.find("> *")).addClass(r.hoverClass),c=!0,r.onHover&&r.onHover.apply(this,[t,r.context])==!1&&(c=!1),!r.proceed)return r.show=window.setTimeout(function(){r.proceed=!0;u.trigger("mouseover")},r.delay),t.stopPropagation(),!1;if(r.proceed=!1,u.parent().find("UL").not(u.find("> UL")).hide(),!c)return t.preventDefault(),!1;if(e=u.find("> UL"),e.length!=0){var o=u.offset(),s=f._getOverflow(o.left+u.parent().width()+r.submenuLeftOffset+e.width()+r.widthOverflowOffset,o.top+r.submenuTopOffset+e.height()+r.heightOverflowOffset),l=e.parent().parent().width(),a=o.top-u.parent().offset().top;e.css({left:s.width>0?-l-r.submenuLeftOffset+"px":l+r.submenuLeftOffset+"px",top:s.height>0?a-s.height+r.submenuTopOffset+"px":a+r.submenuTopOffset+"px"});s=null;o=null;e.fadeIn(r.fadeIn)}e=null;u=null;t.stopPropagation()};this._onContextMenuItemClickingHandler=function(n){var r=f._id,t=i[r];if(!t)return!1;if(t.onSelect&&t.onSelect.apply(this,[n,t.context])==!1)return n.stopPropagation(),!1;f.hide(n);n.stopPropagation()};this.initialize(u)};jeegoocontext.prototype={_id:"",_menuElement:null,_targetElement:null,_onDocumentClickingHandler:null,_onDocumentHoveringHandler:null,_onDocumentKeyDownHandler:null,_onDocumentKeyUpHandler:null,_onDocumentKeyUpDownInnerHandler:function(r){var h=t.activeId,o=i[h],f,u,e,s;o.currentHover?(f=o.currentHover,u=r?f.nextAll(":not(."+o.separatorClass+"):visible:first"):f.prevAll(":not(."+o.separatorClass+"):visible:first"),u.length==0&&(u=f.parent().find("> LI:visible"),u=r?n(u[0]):n(u[u.length-1])),u.trigger("mouseover"),f=null,u=null):(e=n("#"+h+", #"+h+" UL").filter(function(){return n(this).is(":visible")&&n(this).parents(":hidden").length==0}),e.length>0&&(s=n(e[e.length-1]).find("> LI:visible"),n(s[r?0:s.length-1]).trigger("mouseover"),s=null),e=null)},_onContextMenuShowingHandler:null,_onContextMenuItemHoveringHandler:null,_onContextMenuItemClickingHandler:null,initialize:function(r){var f=this._id,u;r&&r.menuClass&&(t.menuClass=r.menuClass);t.menuClass||(t.menuClass="jeegoocontext");r&&r.activeClass&&(t.activeClass=r.activeClass);t.activeClass||(t.activeClass="active");u=i[f]=n.extend({},n.fn.jeegoocontext.defaults,r);u.allContext=this._targetElement.selector;u.autoAddSubmenuArrows&&n(this._menuElement).find("LI:has(UL)").not(":has(."+u.submenuClass+")").prepend('<span class="'+u.submenuClass+'"><\/span>');this.detachContextMenuClickedItemsEventHandlers();this.attachContextMenuClickedItemsEventHandlers();u.allowManualShowing||this._attachContextMenuEventHandlers()},show:function(t,r){var h=this._id,f=i[h];if(!f)return!1;var e=n(this._menuElement),o=t.pageX,s=t.pageY,u=this._getOverflow(t.pageX+e.width()+f.widthOverflowOffset,t.pageY+e.height()+f.heightOverflowOffset);u.width>0&&(o-=u.width);u.height>0&&(s-=u.height);u=null;this.showAt(t,r,o,s)},showAt:function(r,u,f,e){var h=this._id,o=i[h],s;if(!o||(o.context=u,s=n(this._menuElement),o.onShow&&o.onShow.apply(s,[r,o.context])==!1)||(this._resetMenu(),t.activeId=h,n("#"+t.activeId).add("#"+t.activeId+" UL").hide(),this._clearActive(),n(o.context).addClass(t.activeClass),s.find("LI, LI > *").removeClass(o.hoverClass),o.onTune&&o.onTune.apply(s,[r,o.context])==!1))return!1;s.css({left:f+"px",top:e+"px"}).fadeIn(o.fadeIn);this._attachDocumentEventHandlers()},hide:function(r){var f=t.activeId,u=null;if(f&&(u=i[f]),u&&u.onHide&&u.onHide.apply(n("#"+f),[r,u.context])==!1)return!1;this._clearActive();this._resetMenu();u&&u.onHid&&u.onHid.apply(n("#"+f),[r,u.context])},getContextMenuEventType:function(){var u=this._id,r=i[u],t=r.event;return t||(t=n.browser.opera?r.operaEvent:"contextmenu"),t},_getContextMenuItemClickedSelectors:function(){var n=this._id,t=i[n];return"LI:not(."+t.separatorClass+")"},_getOverflow:function(t,i){return{width:t&&parseInt(t)?t-n(window).width()-n(window).scrollLeft():0,height:i&&parseInt(i)?i-n(window).height()-n(window).scrollTop():0}},_clearActive:function(){for(menuId in i)n(i[menuId].allContext).removeClass(t.activeClass)},_resetMenu:function(){var r=t.activeId;r&&n("#"+r).add("#"+r+" UL").hide();window.clearInterval(t.keyUpDown);t.keyUpDownStop=!1;i[r]&&(i[r].currentHover=null);t.activeId=null;this._detachDocumentEventHandlers()},_attachContextMenuEventHandlers:function(){n(this._targetElement).bind(this.getContextMenuEventType(),this._onContextMenuShowingHandler)},_detachContextMenuEventHandlers:function(){n(this._targetElement).bind(this.getContextMenuEventType(),this._onContextMenuShowingHandler)},attachContextMenuClickedItemsEventHandlers:function(){var t=jQuery(this._menuElement),n=this._getContextMenuItemClickedSelectors();t.delegate(n,"mouseover",this._onContextMenuItemHoveringHandler).delegate(n,"click",this._onContextMenuItemClickingHandler)},detachContextMenuClickedItemsEventHandlers:function(){var t=jQuery(this._menuElement),n=this._getContextMenuItemClickedSelectors();t.undelegate(n,"mouseover",this._onContextMenuItemHoveringHandler).undelegate(n,"click",this._onContextMenuItemClickingHandler)},_attachDocumentEventHandlers:function(){n(document).bind("mouseover",this._onDocumentHoveringHandler).bind("click",this._onDocumentClickingHandler).bind("keydown",this._onDocumentKeyDownHandler).bind("keyup",this._onDocumentKeyUpHandler)},_detachDocumentEventHandlers:function(){n(document).unbind("mouseover",this._onDocumentHoveringHandler).unbind("click",this._onDocumentClickingHandler).unbind("keydown",this._onDocumentKeyDownHandler).unbind("keyup",this._onDocumentKeyUpHandler)},dispose:function(){var n=this._id;t.activeId==n&&(t.activeId="");this._detachDocumentEventHandlers();this.detachContextMenuClickedItemsEventHandlers();this._detachContextMenuEventHandlers();n&&i[n]instanceof Object&&delete i[n];this._menuElement=null;this._targetElement=null;this._onDocumentClickingHandler=null;this._onDocumentHoveringHandler=null;this._onDocumentKeyDownHandler=null;this._onDocumentKeyUpHandler=null;this._onContextMenuShowingHandler=null;this._onContextMenuItemHoveringHandler=null;this._onContextMenuItemClickingHandler=null}};n.fn.jeegoocontext=function(t){var i="jeegoocontext_"+t.menuElementId;return this.each(function(){var r=n(this),u;r.data(i)||(u=new jeegoocontext(this,t),r.data(i,u))})};n.fn.jeegoocontext.defaults={menuElementId:"",hoverClass:"hover",submenuClass:"submenu",separatorClass:"separator",operaEvent:"dblclick",fadeIn:100,delay:300,keyDelay:100,widthOverflowOffset:0,heightOverflowOffset:0,submenuLeftOffset:0,submenuTopOffset:0,autoAddSubmenuArrows:!0,allowManualShowing:!1};n.fn.jeegoocontext.getContextMenuEventType=function(){var t=n.fn.jeegoocontext.defaults,i=n.browser.opera?t.operaEvent:"contextmenu";return t=null,i}})(jQuery);