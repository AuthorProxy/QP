/*
Copyright (c) 2003-2010, CKSource - Frederico Knabben. All rights reserved.
For licensing, see LICENSE.html or http://ckeditor.com/license
*/

(function(){window.spellChecker=function(a){var b=this;b.popUpUrl='/speller/spellchecker.html';b.popUpName='spellchecker';b.popUpProps='menu=no,width=440,height=350,top=70,left=120,resizable=no,status=no';b.spellCheckScript='/Backend/VisualEditorConfig/AspellCheck';b.replWordFlag='R';b.ignrWordFlag='I';b.replAllFlag='RA';b.ignrAllFlag='IA';b.fromReplAll='~RA';b.fromIgnrAll='~IA';b.wordFlags=[];b.currentTextIndex=0;b.currentWordIndex=0;b.spellCheckerWin=null;b.controlWin=null;b.wordWin=null;b.textArea=a;b.textInputs=arguments;window.speller=b;};window.spellChecker.prototype={checkTextBoxes:function(){this.textInputs=this._getFormInputs('^text$');this.openChecker();},checkTextAreas:function(){this.textInputs=this._getFormInputs('^textarea$');this.openChecker();},checkTextAreas:function(){this.textInputs=this._getFormInputs('^text(area)?$');this.openChecker();},openChecker:function(){var a=this;a.spellCheckerWin=window.open(a.popUpUrl,a.popUpName,a.popUpProps);if(!a.spellCheckerWin.opener)a.spellCheckerWin.opener=window;},startCheck:function(a,b){var d=this;d.wordWin=a;d.controlWin=b;d.wordWin.resetForm();d.controlWin.resetForm();d.currentTextIndex=0;d.currentWordIndex=0;d.wordFlags=new Array(d.wordWin.textInputs.length);for(var c=0;c<d.wordFlags.length;c++)d.wordFlags[c]=[];d._spellcheck();return true;},ignoreWord:function(){var c=this;var a=c.currentWordIndex,b=c.currentTextIndex;if(!c.wordWin){alert('Error: Word frame not available.');return false;}if(!c.wordWin.getTextVal(b,a)){alert('Error: "Not in dictionary" text is missing.');return false;}if(c._setAsIgnored(b,a,c.ignrWordFlag)){c.currentWordIndex++;c._spellcheck();}return true;},ignoreAll:function(){var f=this;var a=f.currentWordIndex,b=f.currentTextIndex;if(!f.wordWin){alert('Error: Word frame not available.');return false;}var c=f.wordWin.getTextVal(b,a);if(!c){alert('Error: "Not in dictionary" text is missing');return false;}f._setAsIgnored(b,a,f.ignrAllFlag);for(var d=b;d<f.wordWin.textInputs.length;d++)for(var e=0;e<f.wordWin.totalWords(d);e++){if(d==b&&e>a||d>b)if(f.wordWin.getTextVal(d,e)==c&&!f.wordFlags[d][e])f._setAsIgnored(d,e,f.fromIgnrAll);}f.currentWordIndex++;f._spellcheck();return true;},replaceWord:function(){var e=this;var a=e.currentWordIndex,b=e.currentTextIndex;if(!e.wordWin){alert('Error: Word frame not available.');return false;}if(!e.wordWin.getTextVal(b,a)){alert('Error: "Not in dictionary" text is missing');return false;}if(!e.controlWin.replacementText)return false;var c=e.controlWin.replacementText;
if(c.value){var d=new String(c.value);if(e._setWordText(b,a,d,e.replWordFlag)){e.currentWordIndex++;e._spellcheck();}}return true;},replaceAll:function(){var h=this;var a=h.currentTextIndex,b=h.currentWordIndex;if(!h.wordWin){alert('Error: Word frame not available.');return false;}var c=h.wordWin.getTextVal(a,b);if(!c){alert('Error: "Not in dictionary" text is missing');return false;}var d=h.controlWin.replacementText;if(!d.value)return false;var e=new String(d.value);h._setWordText(a,b,e,h.replAllFlag);for(var f=a;f<h.wordWin.textInputs.length;f++)for(var g=0;g<h.wordWin.totalWords(f);g++){if(f==a&&g>b||f>a)if(h.wordWin.getTextVal(f,g)==c&&!h.wordFlags[f][g])h._setWordText(f,g,e,h.fromReplAll);}h.currentWordIndex++;h._spellcheck();return true;},terminateSpell:function(){var d=this;var a='',b=d._getTotalReplaced();if(b==0){if(!d.wordWin)a='';else if(d.wordWin.totalMisspellings())a+=FCKLang.DlgSpellNoChanges;else a+=FCKLang.DlgSpellNoMispell;}else if(b==1)a+=FCKLang.DlgSpellOneChange;else a+=FCKLang.DlgSpellManyChanges.replace(/%1/g,b);if(a)alert(a);if(b>0)for(var c=0;c<d.textInputs.length;c++){if(d.wordWin)if(d.wordWin.textInputs[c])d.textInputs[c].value=d.wordWin.textInputs[c];}if(typeof d.OnFinished=='function')d.OnFinished(b);return true;},undo:function(){var i=this;var a=i.currentTextIndex,b=i.currentWordIndex;if(i.wordWin.totalPreviousWords(a,b)>0){i.wordWin.removeFocus(a,b);do{if(i.currentWordIndex==0&&i.currentTextIndex>0){i.currentTextIndex--;i.currentWordIndex=i.wordWin.totalWords(i.currentTextIndex)-1;if(i.currentWordIndex<0)i.currentWordIndex=0;}else if(i.currentWordIndex>0)i.currentWordIndex--;}while(i.wordWin.totalWords(i.currentTextIndex)==0||i.wordFlags[i.currentTextIndex][i.currentWordIndex]==i.fromIgnrAll||i.wordFlags[i.currentTextIndex][i.currentWordIndex]==i.fromReplAll)var c=i.currentTextIndex,d=i.currentWordIndex,e=i.wordWin.originalSpellings[c][d];if(i.wordWin.totalPreviousWords(c,d)==0)i.controlWin.disableUndo();var f,g,h;switch(i.wordFlags[c][d]){case i.replAllFlag:for(f=c;f<i.wordWin.textInputs.length;f++)for(g=0;g<i.wordWin.totalWords(f);g++){if(f==c&&g>=d||f>c){h=i.wordWin.originalSpellings[f][g];if(h==e)i._setWordText(f,g,h,undefined);}}break;case i.ignrAllFlag:for(f=c;f<i.wordWin.textInputs.length;f++)for(g=0;g<i.wordWin.totalWords(f);g++){if(f==c&&g>=d||f>c){h=i.wordWin.originalSpellings[f][g];if(h==e)i.wordFlags[f][g]=undefined;}}break;case i.replWordFlag:i._setWordText(c,d,e,undefined);break;}i.wordFlags[c][d]=undefined;i._spellcheck();
}},_spellcheck:function(){var c=this;var a=c.wordWin;if(c.currentWordIndex==a.totalWords(c.currentTextIndex)){c.currentTextIndex++;c.currentWordIndex=0;if(c.currentTextIndex<c.wordWin.textInputs.length){c._spellcheck();return;}else{c.terminateSpell();return;}}if(c.currentWordIndex>0)c.controlWin.enableUndo();if(c.wordFlags[c.currentTextIndex][c.currentWordIndex]){c.currentWordIndex++;c._spellcheck();}else{var b=a.getTextVal(c.currentTextIndex,c.currentWordIndex);if(b){c.controlWin.evaluatedText.value=b;a.setFocus(c.currentTextIndex,c.currentWordIndex);c._getSuggestions(c.currentTextIndex,c.currentWordIndex);}}},_getSuggestions:function(a,b){var e=this;e.controlWin.clearSuggestions();var c=e.wordWin.suggestions[a][b];if(c)for(var d=0;d<c.length;d++)e.controlWin.addSuggestion(c[d]);e.controlWin.selectDefaultSuggestion();},_setAsIgnored:function(a,b,c){this.wordWin.removeFocus(a,b);this.wordFlags[a][b]=c;return true;},_getTotalReplaced:function(){var d=this;var a=0;for(var b=0;b<d.wordFlags.length;b++)for(var c=0;c<d.wordFlags[b].length;c++){if(d.wordFlags[b][c]==d.replWordFlag||d.wordFlags[b][c]==d.replAllFlag||d.wordFlags[b][c]==d.fromReplAll)a++;}return a;},_setWordText:function(a,b,c,d){this.wordWin.setText(a,b,c);this.wordFlags[a][b]=d;return true;},_getFormInputs:function(a){var b=[];for(var c=0;c<document.forms.length;c++)for(var d=0;d<document.forms[c].elements.length;d++){if(document.forms[c].elements[d].type.match(a))b[b.length]=document.forms[c].elements[d];}return b;}};})();
